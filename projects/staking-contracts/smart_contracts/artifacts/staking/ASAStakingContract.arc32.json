{
    "hints": {
        "getUserStakeInfo(account)(uint64,uint64,uint64,uint64,uint64)": {
            "call_config": {
                "no_op": "CALL"
            },
            "structs": {
                "output": {
                    "name": "UserStakeInfo",
                    "elements": [
                        [
                            "stakedAmount",
                            "uint64"
                        ],
                        [
                            "firstStakeTime",
                            "uint64"
                        ],
                        [
                            "lastStakeTime",
                            "uint64"
                        ],
                        [
                            "totalRewardsEarned",
                            "uint64"
                        ],
                        [
                            "rewardDebt",
                            "uint64"
                        ]
                    ]
                }
            }
        },
        "storeUserStakeInfo(account,(uint64,uint64,uint64,uint64,uint64))void": {
            "call_config": {
                "no_op": "CALL"
            },
            "structs": {
                "stakeInfo": {
                    "name": "UserStakeInfo",
                    "elements": [
                        [
                            "stakedAmount",
                            "uint64"
                        ],
                        [
                            "firstStakeTime",
                            "uint64"
                        ],
                        [
                            "lastStakeTime",
                            "uint64"
                        ],
                        [
                            "totalRewardsEarned",
                            "uint64"
                        ],
                        [
                            "rewardDebt",
                            "uint64"
                        ]
                    ]
                }
            }
        },
        "initialize(asset,account,uint64,uint64,uint64)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "optInToAsset()void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "stake()void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "withdraw(uint64)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "claimRewards()void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "addRewards()void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "getCurrentAPY()uint64": {
            "read_only": true,
            "call_config": {
                "no_op": "CALL"
            }
        },
        "getPendingRewards(account)uint64": {
            "read_only": true,
            "call_config": {
                "no_op": "CALL"
            }
        },
        "triggerRewardDistribution()void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "updateAdmin(account)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "getUserStats(account)uint64[]": {
            "read_only": true,
            "call_config": {
                "no_op": "CALL"
            }
        },
        "getContractStats()uint64[]": {
            "read_only": true,
            "call_config": {
                "no_op": "CALL"
            }
        },
        "emergencyWithdrawRewards(uint64)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "deleteUserBox(account)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "updateWeeklyRewards(uint64)void": {
            "call_config": {
                "no_op": "CALL"
            }
        },
        "updateRewardPeriod(uint64)void": {
            "call_config": {
                "no_op": "CALL"
            }
        }
    },
    "source": {
        "approval": "I3ByYWdtYSB2ZXJzaW9uIDEwCiNwcmFnbWEgdHlwZXRyYWNrIGZhbHNlCgovLyBAYWxnb3JhbmRmb3VuZGF0aW9uL2FsZ29yYW5kLXR5cGVzY3JpcHQvYXJjNC9pbmRleC5kLnRzOjpDb250cmFjdC5hcHByb3ZhbFByb2dyYW0oKSAtPiB1aW50NjQ6Cm1haW46CiAgICBpbnRjYmxvY2sgMCAxIDQgMjQgMTAwMAogICAgYnl0ZWNibG9jayAicmV3YXJkUG9vbCIgImFzc2V0IiAidG90YWxTdGFrZWQiICJhZG1pbkFkZHJlc3MiICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIgInByZWNpc2lvbiIgImxhc3RSZXdhcmRUaW1lIiAibWluaW11bVN0YWtlIiAid2Vla2x5UmV3YXJkcyIgInJld2FyZFBlcmlvZCIgMHgxNTFmN2M3NSAic3Rha2VycyIKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBibnogbWFpbl9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTIKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBpbnRjXzAgLy8gMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTMKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIGdsb2JhbCBaZXJvQWRkcmVzcwogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzIgLy8gInRvdGFsU3Rha2VkIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU1CiAgICAvLyBwdWJsaWMgbGFzdFJld2FyZFRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA2IC8vICJsYXN0UmV3YXJkVGltZSIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NgogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDcgLy8gIm1pbmltdW1TdGFrZSIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU4CiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MQogICAgLy8gcHVibGljIHdlZWtseVJld2FyZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA4IC8vICJ3ZWVrbHlSZXdhcmRzIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYyCiAgICAvLyBwdWJsaWMgcmV3YXJkUGVyaW9kID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgOSAvLyAicmV3YXJkUGVyaW9kIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYzCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNSAvLyAicHJlY2lzaW9uIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CgptYWluX2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNTEKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG4gTnVtQXBwQXJncwogICAgYnogbWFpbl9iYXJlX3JvdXRpbmdAMjUKICAgIHB1c2hieXRlc3MgMHg1ZDc4OTUyMSAweDA4MGY2ZWNkIDB4NjY3YzVkMzAgMHg5ZmZkM2U1MyAweDA4OTBiZDU4IDB4MjFmMWRkZmYgMHhhNWFlNmJkMSAweGIzYjcwMTQ2IDB4YmY4Yjc2NmQgMHgxODM4MzhlOSAweDIxYjFiMDIyIDB4ODJhYjFlYzQgMHgxNTc2NmIwOSAweGJmZTMxNTY0IDB4Y2U5NjNiMWQgMHhkYzlhMmEwNSAweDFlMmI1MmFiIDB4MWI4NzRhZDYgLy8gbWV0aG9kICJnZXRVc2VyU3Rha2VJbmZvKGFjY291bnQpKHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQpIiwgbWV0aG9kICJzdG9yZVVzZXJTdGFrZUluZm8oYWNjb3VudCwodWludDY0LHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCkpdm9pZCIsIG1ldGhvZCAiaW5pdGlhbGl6ZShhc3NldCxhY2NvdW50LHVpbnQ2NCx1aW50NjQsdWludDY0KXZvaWQiLCBtZXRob2QgIm9wdEluVG9Bc3NldCgpdm9pZCIsIG1ldGhvZCAic3Rha2UoKXZvaWQiLCBtZXRob2QgIndpdGhkcmF3KHVpbnQ2NCl2b2lkIiwgbWV0aG9kICJjbGFpbVJld2FyZHMoKXZvaWQiLCBtZXRob2QgImFkZFJld2FyZHMoKXZvaWQiLCBtZXRob2QgImdldEN1cnJlbnRBUFkoKXVpbnQ2NCIsIG1ldGhvZCAiZ2V0UGVuZGluZ1Jld2FyZHMoYWNjb3VudCl1aW50NjQiLCBtZXRob2QgInRyaWdnZXJSZXdhcmREaXN0cmlidXRpb24oKXZvaWQiLCBtZXRob2QgInVwZGF0ZUFkbWluKGFjY291bnQpdm9pZCIsIG1ldGhvZCAiZ2V0VXNlclN0YXRzKGFjY291bnQpdWludDY0W10iLCBtZXRob2QgImdldENvbnRyYWN0U3RhdHMoKXVpbnQ2NFtdIiwgbWV0aG9kICJlbWVyZ2VuY3lXaXRoZHJhd1Jld2FyZHModWludDY0KXZvaWQiLCBtZXRob2QgImRlbGV0ZVVzZXJCb3goYWNjb3VudCl2b2lkIiwgbWV0aG9kICJ1cGRhdGVXZWVrbHlSZXdhcmRzKHVpbnQ2NCl2b2lkIiwgbWV0aG9kICJ1cGRhdGVSZXdhcmRQZXJpb2QodWludDY0KXZvaWQiCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAwCiAgICBtYXRjaCBtYWluX2dldFVzZXJTdGFrZUluZm9fcm91dGVANSBtYWluX3N0b3JlVXNlclN0YWtlSW5mb19yb3V0ZUA2IG1haW5faW5pdGlhbGl6ZV9yb3V0ZUA3IG1haW5fb3B0SW5Ub0Fzc2V0X3JvdXRlQDggbWFpbl9zdGFrZV9yb3V0ZUA5IG1haW5fd2l0aGRyYXdfcm91dGVAMTAgbWFpbl9jbGFpbVJld2FyZHNfcm91dGVAMTEgbWFpbl9hZGRSZXdhcmRzX3JvdXRlQDEyIG1haW5fZ2V0Q3VycmVudEFQWV9yb3V0ZUAxMyBtYWluX2dldFBlbmRpbmdSZXdhcmRzX3JvdXRlQDE0IG1haW5fdHJpZ2dlclJld2FyZERpc3RyaWJ1dGlvbl9yb3V0ZUAxNSBtYWluX3VwZGF0ZUFkbWluX3JvdXRlQDE2IG1haW5fZ2V0VXNlclN0YXRzX3JvdXRlQDE3IG1haW5fZ2V0Q29udHJhY3RTdGF0c19yb3V0ZUAxOCBtYWluX2VtZXJnZW5jeVdpdGhkcmF3UmV3YXJkc19yb3V0ZUAxOSBtYWluX2RlbGV0ZVVzZXJCb3hfcm91dGVAMjAgbWFpbl91cGRhdGVXZWVrbHlSZXdhcmRzX3JvdXRlQDIxIG1haW5fdXBkYXRlUmV3YXJkUGVyaW9kX3JvdXRlQDIyCgptYWluX2FmdGVyX2lmX2Vsc2VAMjk6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTUxCiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgaW50Y18wIC8vIDAKICAgIHJldHVybgoKbWFpbl91cGRhdGVSZXdhcmRQZXJpb2Rfcm91dGVAMjI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2NAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNTEKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICBidG9pCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2NAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICBjYWxsc3ViIHVwZGF0ZVJld2FyZFBlcmlvZAogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl91cGRhdGVXZWVrbHlSZXdhcmRzX3JvdXRlQDIxOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NDgKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTUxCiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NDgKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiB1cGRhdGVXZWVrbHlSZXdhcmRzCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2RlbGV0ZVVzZXJCb3hfcm91dGVAMjA6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyNgogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNTEKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICBidG9pCiAgICB0eG5hcyBBY2NvdW50cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MjYKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiBkZWxldGVVc2VyQm94CiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2VtZXJnZW5jeVdpdGhkcmF3UmV3YXJkc19yb3V0ZUAxOToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDk4CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MC01MQogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDk4CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIGNhbGxzdWIgZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2dldENvbnRyYWN0U3RhdHNfcm91dGVAMTg6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ3NwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgZ2V0Q29udHJhY3RTdGF0cwogICAgYnl0ZWMgMTAgLy8gMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fZ2V0VXNlclN0YXRzX3JvdXRlQDE3OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NTcKICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTUxCiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgdHhuYXMgQWNjb3VudHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU3CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIGNhbGxzdWIgZ2V0VXNlclN0YXRzCiAgICBieXRlYyAxMCAvLyAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl91cGRhdGVBZG1pbl9yb3V0ZUAxNjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDQ0CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MC01MQogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ0NAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICBjYWxsc3ViIHVwZGF0ZUFkbWluCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX3RyaWdnZXJSZXdhcmREaXN0cmlidXRpb25fcm91dGVAMTU6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQzMAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgdHJpZ2dlclJld2FyZERpc3RyaWJ1dGlvbgogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9nZXRQZW5kaW5nUmV3YXJkc19yb3V0ZUAxNDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDIxCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MC01MQogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQyMQogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICBjYWxsc3ViIGdldFBlbmRpbmdSZXdhcmRzCiAgICBpdG9iCiAgICBieXRlYyAxMCAvLyAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9nZXRDdXJyZW50QVBZX3JvdXRlQDEzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MDEKICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIGdldEN1cnJlbnRBUFkKICAgIGl0b2IKICAgIGJ5dGVjIDEwIC8vIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2FkZFJld2FyZHNfcm91dGVAMTI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM3NwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgYWRkUmV3YXJkcwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9jbGFpbVJld2FyZHNfcm91dGVAMTE6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMzNAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIGNhbGxzdWIgY2xhaW1SZXdhcmRzCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX3dpdGhkcmF3X3JvdXRlQDEwOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjgKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTUxCiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjgKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiB3aXRoZHJhdwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9zdGFrZV9yb3V0ZUA5OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMDQKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIHN0YWtlCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX29wdEluVG9Bc3NldF9yb3V0ZUA4OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxODIKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIG9wdEluVG9Bc3NldAogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9pbml0aWFsaXplX3JvdXRlQDc6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1MAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNTEKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICBidG9pCiAgICB0eG5hcyBBc3NldHMKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAzCiAgICBidG9pCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA0CiAgICBidG9pCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA1CiAgICBidG9pCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1MAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICBjYWxsc3ViIGluaXRpYWxpemUKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fc3RvcmVVc2VyU3Rha2VJbmZvX3JvdXRlQDY6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjg5CiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MC01MQogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjg5CiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIGNhbGxzdWIgc3RvcmVVc2VyU3Rha2VJbmZvCiAgICBwb3AKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fZ2V0VXNlclN0YWtlSW5mb19yb3V0ZUA1OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo3MAogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MC01MQogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjcwCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgY2FsbHN1YiBnZXRVc2VyU3Rha2VJbmZvCiAgICBieXRlYyAxMCAvLyAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9iYXJlX3JvdXRpbmdAMjU6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTUxCiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuIE9uQ29tcGxldGlvbgogICAgYm56IG1haW5fYWZ0ZXJfaWZfZWxzZUAyOQogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgICEKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gY3JlYXRpbmcKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRVc2VyU3Rha2VJbmZvOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo3MAogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIHByb3RvIDEgMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2NQogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgYnl0ZWMgMTEgLy8gInN0YWtlcnMiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjcxCiAgICAvLyBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjY1CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NzEKICAgIC8vIGNvbnN0IHVzZXJCb3ggPSB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpCiAgICBkdXAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NzMKICAgIC8vIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgYm94X2xlbgogICAgYnVyeSAxCiAgICBieiBnZXRVc2VyU3Rha2VJbmZvX2Vsc2VfYm9keUAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjc0CiAgICAvLyByZXR1cm4gdXNlckJveC52YWx1ZS5jb3B5KCkKICAgIGZyYW1lX2RpZyAwCiAgICBib3hfZ2V0CiAgICBhc3NlcnQgLy8gQm94IG11c3QgaGF2ZSB2YWx1ZQogICAgc3dhcAogICAgcmV0c3ViCgpnZXRVc2VyU3Rha2VJbmZvX2Vsc2VfYm9keUAyOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo3Ni04MgogICAgLy8gcmV0dXJuIG5ldyBVc2VyU3Rha2VJbmZvKHsKICAgIC8vICAgc3Rha2VkQW1vdW50OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICBmaXJzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgbGFzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICByZXdhcmREZWJ0OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gfSkKICAgIHB1c2hieXRlcyAweDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3Quc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBieXRlcywgc3Rha2VJbmZvOiBieXRlcykgLT4gYnl0ZXM6CnN0b3JlVXNlclN0YWtlSW5mbzoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6ODkKICAgIC8vIHB1YmxpYyBzdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQsIHN0YWtlSW5mbzogVXNlclN0YWtlSW5mbyk6IHZvaWQgewogICAgcHJvdG8gMiAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjY1CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBieXRlYyAxMSAvLyAic3Rha2VycyIKICAgIGZyYW1lX2RpZyAtMgogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjkwCiAgICAvLyB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpLnZhbHVlID0gc3Rha2VJbmZvLmNvcHkoKQogICAgZnJhbWVfZGlnIC0xCiAgICBib3hfcHV0CiAgICBmcmFtZV9kaWcgLTEKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC51cGRhdGVSZXdhcmRzKCkgLT4gdm9pZDoKdXBkYXRlUmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OTYKICAgIC8vIHByaXZhdGUgdXBkYXRlUmV3YXJkcygpOiB2b2lkIHsKICAgIHByb3RvIDAgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo5NwogICAgLy8gY29uc3QgY3VycmVudFRpbWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBkdXAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyBsYXN0UmV3YXJkVGltZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA2IC8vICJsYXN0UmV3YXJkVGltZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBzd2FwCiAgICBkdXAKICAgIGNvdmVyIDIKICAgIGNvdmVyIDMKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NjIKICAgIC8vIHB1YmxpYyByZXdhcmRQZXJpb2QgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWMgOSAvLyAicmV3YXJkUGVyaW9kIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIHN3YXAKICAgIGR1cAogICAgY292ZXIgMgogICAgY292ZXIgNAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMDIKICAgIC8vIGlmIChjdXJyZW50VGltZSA+PSBsYXN0UmV3YXJkICsgcmV3YXJkUGVyaW9kICYmIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPiAwKSB7CiAgICArCiAgICA+PQogICAgYnogdXBkYXRlUmV3YXJkc19hZnRlcl9pZl9lbHNlQDMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18yIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEwMgogICAgLy8gaWYgKGN1cnJlbnRUaW1lID49IGxhc3RSZXdhcmQgKyByZXdhcmRQZXJpb2QgJiYgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA+IDApIHsKICAgIGJ6IHVwZGF0ZVJld2FyZHNfYWZ0ZXJfaWZfZWxzZUAzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEwNAogICAgLy8gY29uc3QgcGVyaW9kc1Bhc3NlZDogdWludDY0ID0gKGN1cnJlbnRUaW1lIC0gbGFzdFJld2FyZCkgLyByZXdhcmRQZXJpb2QKICAgIGZyYW1lX2RpZyAwCiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBjb3ZlciAyCiAgICAtCiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBjb3ZlciAyCiAgICAvCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYxCiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA4IC8vICJ3ZWVrbHlSZXdhcmRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTA4CiAgICAvLyBjb25zdCB0b3RhbFJld2FyZHM6IHVpbnQ2NCA9IHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNQYXNzZWQKICAgIGRpZyAxCiAgICAqCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0CiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMiAvLyAidG90YWxTdGFrZWQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MwogICAgLy8gcHVibGljIHByZWNpc2lvbiA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA1IC8vICJwcmVjaXNpb24iCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMTMKICAgIC8vIGNvbnN0IHJld2FyZFBlclNoYXJlOiB1aW50NjQgPSAodG90YWxSZXdhcmRzICogcHJlY2lzaW9uKSAvIHRvdGFsU3Rha2VkCiAgICBkaWcgMgogICAgKgogICAgc3dhcAogICAgLwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1OAogICAgLy8gcHVibGljIGFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDQgLy8gImFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTE1CiAgICAvLyB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSArIHJld2FyZFBlclNoYXJlCiAgICArCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU4CiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTE1CiAgICAvLyB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSArIHJld2FyZFBlclNoYXJlCiAgICBzd2FwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMTgKICAgIC8vIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBsYXN0UmV3YXJkICsgKHBlcmlvZHNQYXNzZWQgKiByZXdhcmRQZXJpb2QpCiAgICBzd2FwCiAgICB1bmNvdmVyIDIKICAgICoKICAgIHVuY292ZXIgMgogICAgKwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIGxhc3RSZXdhcmRUaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNiAvLyAibGFzdFJld2FyZFRpbWUiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjExOAogICAgLy8gdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IGxhc3RSZXdhcmQgKyAocGVyaW9kc1Bhc3NlZCAqIHJld2FyZFBlcmlvZCkKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTIxCiAgICAvLyB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSB0b3RhbFJld2FyZHMKICAgIHN3YXAKICAgIC0KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTcKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWNfMCAvLyAicmV3YXJkUG9vbCIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTIxCiAgICAvLyB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSB0b3RhbFJld2FyZHMKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0Cgp1cGRhdGVSZXdhcmRzX2FmdGVyX2lmX2Vsc2VAMzoKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogYnl0ZXMpIC0+IHVpbnQ2NDoKY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHM6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEyOAogICAgLy8gcHJpdmF0ZSBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICBwcm90byAxIDEKICAgIHB1c2hieXRlcyAiIgogICAgZHVwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEyOQogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIGR1cAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMzEKICAgIC8vIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICBkdXAKICAgIGJueiBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkc19hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTMyCiAgICAvLyByZXR1cm4gMAogICAgaW50Y18wIC8vIDAKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgpjYWxjdWxhdGVQZW5kaW5nUmV3YXJkc19hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU4CiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWMgNCAvLyAiYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMzcKICAgIC8vIGNvbnN0IHVzZXJSZXdhcmREZWJ0ID0gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlCiAgICBmcmFtZV9kaWcgMgogICAgcHVzaGludCAzMiAvLyAzMgogICAgZXh0cmFjdF91aW50NjQKICAgIGR1cAogICAgY292ZXIgMgogICAgZnJhbWVfYnVyeSAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYzCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDUgLy8gInByZWNpc2lvbiIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE0MQogICAgLy8gY29uc3QgdG90YWxFYXJuZWQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBhY2NSZXdhcmRzUGVyU2hhcmUpIC8gcHJlY2lzaW9uCiAgICBmcmFtZV9kaWcgMwogICAgdW5jb3ZlciAyCiAgICAqCiAgICBzd2FwCiAgICAvCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNDIKICAgIC8vIGNvbnN0IHBlbmRpbmdSZXdhcmRzOiB1aW50NjQgPSB0b3RhbEVhcm5lZCA+IHVzZXJSZXdhcmREZWJ0ID8gdG90YWxFYXJuZWQgLSB1c2VyUmV3YXJkRGVidCA6IDAKICAgIDwKICAgIGJ6IGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX3Rlcm5hcnlfZmFsc2VANAogICAgZnJhbWVfZGlnIDAKICAgIGZyYW1lX2RpZyAxCiAgICAtCgpjYWxjdWxhdGVQZW5kaW5nUmV3YXJkc190ZXJuYXJ5X21lcmdlQDU6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE0NAogICAgLy8gcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHNfdGVybmFyeV9mYWxzZUA0OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNDIKICAgIC8vIGNvbnN0IHBlbmRpbmdSZXdhcmRzOiB1aW50NjQgPSB0b3RhbEVhcm5lZCA+IHVzZXJSZXdhcmREZWJ0ID8gdG90YWxFYXJuZWQgLSB1c2VyUmV3YXJkRGVidCA6IDAKICAgIGludGNfMCAvLyAwCiAgICBiIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX3Rlcm5hcnlfbWVyZ2VANQoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5pbml0aWFsaXplKGFzc2V0OiB1aW50NjQsIGFkbWluQWRkcmVzczogYnl0ZXMsIG1pbmltdW1TdGFrZTogdWludDY0LCB3ZWVrbHlSZXdhcmRzOiB1aW50NjQsIHJld2FyZFBlcmlvZDogdWludDY0KSAtPiB2b2lkOgppbml0aWFsaXplOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNTAtMTU3CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBpbml0aWFsaXplKAogICAgLy8gICBhc3NldDogQXNzZXQsCiAgICAvLyAgIGFkbWluQWRkcmVzczogQWNjb3VudCwKICAgIC8vICAgbWluaW11bVN0YWtlOiB1aW50NjQsCiAgICAvLyAgIHdlZWtseVJld2FyZHM6IHVpbnQ2NCwKICAgIC8vICAgcmV3YXJkUGVyaW9kOiB1aW50NjQsCiAgICAvLyApOiB2b2lkIHsKICAgIHByb3RvIDUgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNTkKICAgIC8vIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlID09PSBBc3NldCgpLCAnQWxyZWFkeSBpbml0aWFsaXplZCcpCiAgICAhCiAgICBhc3NlcnQgLy8gQWxyZWFkeSBpbml0aWFsaXplZAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNjIKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgdHhuIFNlbmRlcgogICAgZ2xvYmFsIENyZWF0b3JBZGRyZXNzCiAgICA9PQogICAgYXNzZXJ0IC8vIE9ubHkgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTY1CiAgICAvLyB0aGlzLmFzc2V0LnZhbHVlID0gYXNzZXQKICAgIGZyYW1lX2RpZyAtNQogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTMKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTY2CiAgICAvLyB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IGFkbWluQWRkcmVzcwogICAgZnJhbWVfZGlnIC00CiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWNfMiAvLyAidG90YWxTdGFrZWQiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE2NwogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IDAKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIGxhc3RSZXdhcmRUaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNiAvLyAibGFzdFJld2FyZFRpbWUiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE2OAogICAgLy8gdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2CiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNyAvLyAibWluaW11bVN0YWtlIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNjkKICAgIC8vIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICBmcmFtZV9kaWcgLTMKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3MAogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gMAogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU4CiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTcxCiAgICAvLyB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gMAogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYxCiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDggLy8gIndlZWtseVJld2FyZHMiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3NAogICAgLy8gdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlID0gd2Vla2x5UmV3YXJkcwogICAgZnJhbWVfZGlnIC0yCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MgogICAgLy8gcHVibGljIHJld2FyZFBlcmlvZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDkgLy8gInJld2FyZFBlcmlvZCIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTc1CiAgICAvLyB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZSA9IHJld2FyZFBlcmlvZAogICAgZnJhbWVfZGlnIC0xCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MwogICAgLy8gcHVibGljIHByZWNpc2lvbiA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDUgLy8gInByZWNpc2lvbiIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTc2CiAgICAvLyB0aGlzLnByZWNpc2lvbi52YWx1ZSA9IDFfMDAwXzAwMCAvLyBSZWR1Y2VkIHByZWNpc2lvbiBmcm9tIDFlMTIgdG8gMWU2IHRvIGF2b2lkIG92ZXJmbG93CiAgICBwdXNoaW50IDEwMDAwMDAgLy8gMTAwMDAwMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5vcHRJblRvQXNzZXQoKSAtPiB2b2lkOgpvcHRJblRvQXNzZXQ6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE4Mi0xODMKICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIG9wdEluVG9Bc3NldCgpOiB2b2lkIHsKICAgIHByb3RvIDAgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE4NgogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICB0eG4gU2VuZGVyCiAgICBnbG9iYWwgQ3JlYXRvckFkZHJlc3MKICAgID09CiAgICBibnogb3B0SW5Ub0Fzc2V0X2Jvb2xfdHJ1ZUAyCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgMAogICAgPT0KICAgIGJ6IG9wdEluVG9Bc3NldF9ib29sX2ZhbHNlQDMKCm9wdEluVG9Bc3NldF9ib29sX3RydWVAMjoKICAgIGludGNfMSAvLyAxCgpvcHRJblRvQXNzZXRfYm9vbF9tZXJnZUA0OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxODYKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MgfHwgVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4nKQogICAgYXNzZXJ0IC8vIE9ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyCiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MC0xOTYKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9iZWdpbgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxOTIKICAgIC8vIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgIHN3YXAKICAgIGl0eG5fZmllbGQgWGZlckFzc2V0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MwogICAgLy8gYXNzZXRBbW91bnQ6IDAsCiAgICBpbnRjXzAgLy8gMAogICAgaXR4bl9maWVsZCBBc3NldEFtb3VudAogICAgaXR4bl9maWVsZCBBc3NldFJlY2VpdmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MC0xOTUKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgIH0pCiAgICBpbnRjXzIgLy8gNAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgaW50Y18wIC8vIDAKICAgIGl0eG5fZmllbGQgRmVlCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MC0xOTYKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIHJldHN1YgoKb3B0SW5Ub0Fzc2V0X2Jvb2xfZmFsc2VAMzoKICAgIGludGNfMCAvLyAwCiAgICBiIG9wdEluVG9Bc3NldF9ib29sX21lcmdlQDQKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3Quc3Rha2UoKSAtPiB2b2lkOgpzdGFrZToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjA0LTIwNQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgc3Rha2UoKTogdm9pZCB7CiAgICBwcm90byAwIDAKICAgIHB1c2hieXRlcyAiIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjA4CiAgICAvLyBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSAhPT0gQXNzZXQoKSwgJ0NvbnRyYWN0IG5vdCBpbml0aWFsaXplZCcpCiAgICBhc3NlcnQgLy8gQ29udHJhY3Qgbm90IGluaXRpYWxpemVkCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxMQogICAgLy8gYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgZ2xvYmFsIEdyb3VwU2l6ZQogICAgcHVzaGludCAyIC8vIDIKICAgID09CiAgICBhc3NlcnQgLy8gRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNAogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIGd0eG5zIFR5cGVFbnVtCiAgICBkdXAKICAgIGludGNfMiAvLyBheGZlcgogICAgPT0KICAgIGFzc2VydCAvLyB0cmFuc2FjdGlvbiB0eXBlIGlzIGF4ZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNQogICAgLy8gYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgaW50Y18yIC8vIDQKICAgID09CiAgICBhc3NlcnQgLy8gVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNAogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjE2CiAgICAvLyBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgZ3R4bnMgQXNzZXRSZWNlaXZlcgogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgID09CiAgICBhc3NlcnQgLy8gQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMTQKICAgIC8vIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIGludGNfMCAvLyAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNwogICAgLy8gYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgZ3R4bnMgQXNzZXRBbW91bnQKICAgIGR1cAogICAgY292ZXIgMgogICAgYXNzZXJ0IC8vIE11c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNAogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjE4CiAgICAvLyBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIGd0eG5zIFhmZXJBc3NldAogICAgPT0KICAgIGFzc2VydCAvLyBJbmNvcnJlY3QgYXNzZXQgSUQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjIxCiAgICAvLyB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgY2FsbHN1YiB1cGRhdGVSZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2CiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDcgLy8gIm1pbmltdW1TdGFrZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIyNgogICAgLy8gY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIHR4biBTZW5kZXIKICAgIGR1cAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMjkKICAgIC8vIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgY2FsbHN1YiBnZXRVc2VyU3Rha2VJbmZvCiAgICBkdXBuIDIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjMyCiAgICAvLyBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBzd2FwCiAgICBieiBzdGFrZV9hZnRlcl9pZl9lbHNlQDUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjMzCiAgICAvLyBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAzCiAgICBjYWxsc3ViIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMAogICAgZnJhbWVfZGlnIDQKICAgIGZyYW1lX2J1cnkgNgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMzQKICAgIC8vIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICBieiBzdGFrZV9hZnRlcl9pZl9lbHNlQDUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTcKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMzQKICAgIC8vIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICBmcmFtZV9kaWcgMAogICAgPj0KICAgIGZyYW1lX2RpZyA0CiAgICBmcmFtZV9idXJ5IDYKICAgIGJ6IHN0YWtlX2FmdGVyX2lmX2Vsc2VANQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMzYKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICBmcmFtZV9kaWcgNQogICAgZnJhbWVfZGlnIDAKICAgIGR1cAogICAgY292ZXIgMgogICAgKwogICAgaXRvYgogICAgZnJhbWVfZGlnIDQKICAgIHN3YXAKICAgIHJlcGxhY2UyIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjM3CiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgZHVwCiAgICBpbnRjXzMgLy8gMjQKICAgIGV4dHJhY3RfdWludDY0CiAgICBkaWcgMgogICAgKwogICAgaXRvYgogICAgcmVwbGFjZTIgMjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18yIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIzOAogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBwZW5kaW5nUmV3YXJkcwogICAgZGlnIDIKICAgICsKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzIgLy8gInRvdGFsU3Rha2VkIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMzgKICAgIC8vIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgcGVuZGluZ1Jld2FyZHMKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjM5CiAgICAvLyB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgdW5jb3ZlciAyCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIzOQogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICBmcmFtZV9idXJ5IDYKCnN0YWtlX2FmdGVyX2lmX2Vsc2VANToKICAgIGZyYW1lX2RpZyA2CiAgICBkdXAKICAgIGZyYW1lX2J1cnkgNAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNDQKICAgIC8vIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgZHVwCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIHN3YXAKICAgIGZyYW1lX2J1cnkgNgogICAgYm56IHN0YWtlX2FmdGVyX2lmX2Vsc2VANwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNDUKICAgIC8vIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgZnJhbWVfZGlnIDEKICAgIGZyYW1lX2RpZyAyCiAgICA+PQogICAgYXNzZXJ0IC8vIEluaXRpYWwgc3Rha2UgYmVsb3cgbWluaW11bQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNDcKICAgIC8vIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZSA9IG5ldyBhcmM0LlVpbnRONjQoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCkKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGl0b2IKICAgIGZyYW1lX2RpZyA0CiAgICBzd2FwCiAgICByZXBsYWNlMiA4CiAgICBmcmFtZV9idXJ5IDYKCnN0YWtlX2FmdGVyX2lmX2Vsc2VANzoKICAgIGZyYW1lX2RpZyA2CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI1MQogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIGR1cAogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICBmcmFtZV9kaWcgMQogICAgZHVwCiAgICBjb3ZlciAzCiAgICArCiAgICBpdG9iCiAgICByZXBsYWNlMiAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI1MgogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiAxNgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNTUKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgZHVwCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTgKICAgIC8vIHB1YmxpYyBhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI1NQogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAqCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYzCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDUgLy8gInByZWNpc2lvbiIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI1NQogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvCiAgICBpdG9iCiAgICByZXBsYWNlMiAzMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNTgKICAgIC8vIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIGZyYW1lX2RpZyAzCiAgICBzd2FwCiAgICBjYWxsc3ViIHN0b3JlVXNlclN0YWtlSW5mbwogICAgcG9wCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0CiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMiAvLyAidG90YWxTdGFrZWQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjEKICAgIC8vIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgICsKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzIgLy8gInRvdGFsU3Rha2VkIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjEKICAgIC8vIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3Qud2l0aGRyYXcoYW1vdW50OiB1aW50NjQpIC0+IHZvaWQ6CndpdGhkcmF3OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjgtMjY5CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgcHJvdG8gMSAwCiAgICBwdXNoYnl0ZXMgIiIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjcxCiAgICAvLyB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgY2FsbHN1YiB1cGRhdGVSZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI3MwogICAgLy8gY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIHR4biBTZW5kZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjczLTI3NAogICAgLy8gY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgZHVwbiAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI3NAogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIGR1cAogICAgY292ZXIgMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNzcKICAgIC8vIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICBkdXAKICAgIGludGNfMCAvLyAwCiAgICBleHRyYWN0X3VpbnQ2NAogICAgZHVwCiAgICBhc3NlcnQgLy8gTm8gc3Rha2UgZm91bmQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjc4CiAgICAvLyBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICBmcmFtZV9kaWcgLTEKICAgID49CiAgICBhc3NlcnQgLy8gV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNzkKICAgIC8vIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICBmcmFtZV9kaWcgLTEKICAgIGFzc2VydCAvLyBXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4MgogICAgLy8gY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICBzd2FwCiAgICBjYWxsc3ViIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgc3dhcAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyODMKICAgIC8vIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICBieiB3aXRoZHJhd19hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTcKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyODMKICAgIC8vIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICBmcmFtZV9kaWcgMwogICAgPj0KICAgIGZyYW1lX2RpZyAyCiAgICBmcmFtZV9idXJ5IDQKICAgIGJ6IHdpdGhkcmF3X2FmdGVyX2lmX2Vsc2VANAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyODQKICAgIC8vIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBpbnRjXzMgLy8gMjQKICAgIGV4dHJhY3RfdWludDY0CiAgICBmcmFtZV9kaWcgMwogICAgZHVwCiAgICBjb3ZlciAzCiAgICArCiAgICBpdG9iCiAgICByZXBsYWNlMiAyNAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMCAvLyAicmV3YXJkUG9vbCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4NQogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIGRpZyAyCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4NQogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyCiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4OS0yOTYKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgZmVlOiAxMDAwLAogICAgLy8gICB9KQogICAgLy8gICAuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgWGZlckFzc2V0CiAgICBzd2FwCiAgICBpdHhuX2ZpZWxkIEFzc2V0QW1vdW50CiAgICBmcmFtZV9kaWcgMQogICAgaXR4bl9maWVsZCBBc3NldFJlY2VpdmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4OS0yOTUKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgZmVlOiAxMDAwLAogICAgLy8gICB9KQogICAgaW50Y18yIC8vIDQKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjk0CiAgICAvLyBmZWU6IDEwMDAsCiAgICBpbnRjIDQgLy8gMTAwMAogICAgaXR4bl9maWVsZCBGZWUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjg5LTI5NgogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIGZyYW1lX2J1cnkgNAoKd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUA0OgogICAgZnJhbWVfZGlnIDQKICAgIGR1cAogICAgZnJhbWVfYnVyeSAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMwMQogICAgLy8gaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICBmcmFtZV9kaWcgLTEKICAgID4KICAgIGJ6IHdpdGhkcmF3X2FmdGVyX2lmX2Vsc2VANgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMDIKICAgIC8vIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgZnJhbWVfZGlnIDAKICAgIGZyYW1lX2RpZyAtMQogICAgLQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NgogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA3IC8vICJtaW5pbXVtU3Rha2UiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMDQKICAgIC8vIGFzc2VydChyZW1haW5pbmdTdGFrZSA+PSBtaW5pbXVtU3Rha2UsICdSZW1haW5pbmcgc3Rha2Ugd291bGQgYmUgYmVsb3cgbWluaW11bScpCiAgICA+PQogICAgYXNzZXJ0IC8vIFJlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtCgp3aXRoZHJhd19hZnRlcl9pZl9lbHNlQDY6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMwOAogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICBmcmFtZV9kaWcgMAogICAgZnJhbWVfZGlnIC0xCiAgICAtCiAgICBpdG9iCiAgICBmcmFtZV9kaWcgMgogICAgc3dhcAogICAgcmVwbGFjZTIgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMTEKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgZHVwCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTgKICAgIC8vIHB1YmxpYyBhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMxMQogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAqCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYzCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDUgLy8gInByZWNpc2lvbiIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMxMQogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvCiAgICBpdG9iCiAgICByZXBsYWNlMiAzMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMTQKICAgIC8vIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIGZyYW1lX2RpZyAxCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgY2FsbHN1YiBzdG9yZVVzZXJTdGFrZUluZm8KICAgIHBvcAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzIgLy8gInRvdGFsU3Rha2VkIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzE3CiAgICAvLyB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgZnJhbWVfZGlnIC0xCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0CiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18yIC8vICJ0b3RhbFN0YWtlZCIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzE3CiAgICAvLyB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTIKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzIxLTMyOAogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgZmVlOiAxMDAwLAogICAgLy8gICB9KQogICAgLy8gICAuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgWGZlckFzc2V0CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0eG5fZmllbGQgQXNzZXRBbW91bnQKICAgIGl0eG5fZmllbGQgQXNzZXRSZWNlaXZlcgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMjEtMzI3CiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICBpbnRjXzIgLy8gNAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMjYKICAgIC8vIGZlZTogMTAwMCwKICAgIGludGMgNCAvLyAxMDAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMjEtMzI4CiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5jbGFpbVJld2FyZHMoKSAtPiB2b2lkOgpjbGFpbVJld2FyZHM6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMzNwogICAgLy8gdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIGNhbGxzdWIgdXBkYXRlUmV3YXJkcwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMzkKICAgIC8vIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICB0eG4gU2VuZGVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM0MAogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICBkdXAKICAgIGNhbGxzdWIgZ2V0VXNlclN0YWtlSW5mbwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNDMKICAgIC8vIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICBkdXAKICAgIGludGNfMCAvLyAwCiAgICBleHRyYWN0X3VpbnQ2NAogICAgYXNzZXJ0IC8vIE5vIHN0YWtlIGZvdW5kCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM0NgogICAgLy8gY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICBkaWcgMQogICAgY2FsbHN1YiBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNDcKICAgIC8vIGFzc2VydChwZW5kaW5nUmV3YXJkcyA+IDAsICdObyBwZW5kaW5nIHJld2FyZHMnKQogICAgZHVwCiAgICBhc3NlcnQgLy8gTm8gcGVuZGluZyByZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzQ4CiAgICAvLyBhc3NlcnQodGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzLCAnSW5zdWZmaWNpZW50IHJld2FyZCBwb29sJykKICAgIGRpZyAxCiAgICA+PQogICAgYXNzZXJ0IC8vIEluc3VmZmljaWVudCByZXdhcmQgcG9vbAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNTEKICAgIC8vIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICBkaWcgMQogICAgaW50Y18zIC8vIDI0CiAgICBleHRyYWN0X3VpbnQ2NAogICAgZGlnIDEKICAgICsKICAgIGl0b2IKICAgIHVuY292ZXIgMgogICAgc3dhcAogICAgcmVwbGFjZTIgMjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzUyCiAgICAvLyBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIGR1cAogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU4CiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWMgNCAvLyAiYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNTIKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgKgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MwogICAgLy8gcHVibGljIHByZWNpc2lvbiA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA1IC8vICJwcmVjaXNpb24iCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNTIKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLwogICAgaXRvYgogICAgcmVwbGFjZTIgMzIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzU1CiAgICAvLyB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICBkaWcgMgogICAgc3dhcAogICAgY2FsbHN1YiBzdG9yZVVzZXJTdGFrZUluZm8KICAgIHBvcAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMCAvLyAicmV3YXJkUG9vbCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM1OAogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIGRpZyAxCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM1OAogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyCiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM2Mi0zNjkKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgZmVlOiAxMDAwLAogICAgLy8gICB9KQogICAgLy8gICAuc3VibWl0KCkKICAgIGl0eG5fYmVnaW4KICAgIGl0eG5fZmllbGQgWGZlckFzc2V0CiAgICBpdHhuX2ZpZWxkIEFzc2V0QW1vdW50CiAgICBpdHhuX2ZpZWxkIEFzc2V0UmVjZWl2ZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzYyLTM2OAogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICBpbnRjXzIgLy8gNAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNjcKICAgIC8vIGZlZTogMTAwMCwKICAgIGludGMgNCAvLyAxMDAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNjItMzY5CiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIGZlZTogMTAwMCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX3N1Ym1pdAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmFkZFJld2FyZHMoKSAtPiB2b2lkOgphZGRSZXdhcmRzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM4MQogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzJykKICAgIHR4biBTZW5kZXIKICAgID09CiAgICBhc3NlcnQgLy8gT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzg0CiAgICAvLyBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICBnbG9iYWwgR3JvdXBTaXplCiAgICBwdXNoaW50IDIgLy8gMgogICAgPT0KICAgIGFzc2VydCAvLyBFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTIKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzg4CiAgICAvLyBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICBpbnRjXzAgLy8gMAogICAgZ3R4bnMgVHlwZUVudW0KICAgIGR1cAogICAgaW50Y18yIC8vIGF4ZmVyCiAgICA9PQogICAgYXNzZXJ0IC8vIHRyYW5zYWN0aW9uIHR5cGUgaXMgYXhmZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzg5CiAgICAvLyBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICBpbnRjXzIgLy8gNAogICAgPT0KICAgIGFzc2VydCAvLyBUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzg4CiAgICAvLyBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICBpbnRjXzAgLy8gMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozOTAKICAgIC8vIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICBndHhucyBBc3NldFJlY2VpdmVyCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgPT0KICAgIGFzc2VydCAvLyBBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM4OAogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzkxCiAgICAvLyBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICBndHhucyBBc3NldEFtb3VudAogICAgZHVwCiAgICBhc3NlcnQgLy8gTXVzdCBwcm92aWRlIG5vbi16ZXJvIHJld2FyZHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzg4CiAgICAvLyBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICBpbnRjXzAgLy8gMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozOTIKICAgIC8vIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgZ3R4bnMgWGZlckFzc2V0CiAgICB1bmNvdmVyIDIKICAgID09CiAgICBhc3NlcnQgLy8gSW5jb3JyZWN0IGFzc2V0IElECiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mzk1CiAgICAvLyB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgKyB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICArCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM5NQogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5nZXRDdXJyZW50QVBZKCkgLT4gdWludDY0OgpnZXRDdXJyZW50QVBZOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MDEtNDAyCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDdXJyZW50QVBZKCk6IHVpbnQ2NCB7CiAgICBwcm90byAwIDEKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18yIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBzd2FwCiAgICBkdXAKICAgIHVuY292ZXIgMgogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MDUKICAgIC8vIGlmICh0b3RhbFN0YWtlZCA9PT0gMCkgewogICAgYm56IGdldEN1cnJlbnRBUFlfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQwNgogICAgLy8gcmV0dXJuIDAgLy8gUmV0dXJuIDAgaWYgbm8gdG9rZW5zIHN0YWtlZAogICAgaW50Y18wIC8vIDAKICAgIHN3YXAKICAgIHJldHN1YgoKZ2V0Q3VycmVudEFQWV9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYxCiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA4IC8vICJ3ZWVrbHlSZXdhcmRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDEwCiAgICAvLyBjb25zdCBhbm51YWxSZXdhcmRzOiB1aW50NjQgPSA1MiAqIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgcHVzaGludCA1MiAvLyA1MgogICAgKgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MTMKICAgIC8vIGNvbnN0IGFweTogdWludDY0ID0gKGFubnVhbFJld2FyZHMgKiAxMDAwMCkgLyB0b3RhbFN0YWtlZAogICAgcHVzaGludCAxMDAwMCAvLyAxMDAwMAogICAgKgogICAgZnJhbWVfZGlnIDAKICAgIC8KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDE1CiAgICAvLyByZXR1cm4gYXB5CiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QuZ2V0UGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IGJ5dGVzKSAtPiB1aW50NjQ6CmdldFBlbmRpbmdSZXdhcmRzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MjEtNDIyCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICBwcm90byAxIDEKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDIzCiAgICAvLyByZXR1cm4gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcwogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LnRyaWdnZXJSZXdhcmREaXN0cmlidXRpb24oKSAtPiB2b2lkOgp0cmlnZ2VyUmV3YXJkRGlzdHJpYnV0aW9uOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQzNAogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uJykKICAgIHR4biBTZW5kZXIKICAgID09CiAgICBhc3NlcnQgLy8gT25seSBhZG1pbiBjYW4gdHJpZ2dlciBkaXN0cmlidXRpb24KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDM3CiAgICAvLyB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgY2FsbHN1YiB1cGRhdGVSZXdhcmRzCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QudXBkYXRlQWRtaW4obmV3QWRtaW5BZGRyZXNzOiBieXRlcykgLT4gdm9pZDoKdXBkYXRlQWRtaW46CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ0NC00NDUKICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFkbWluKG5ld0FkbWluQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgcHJvdG8gMSAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMyAvLyAiYWRtaW5BZGRyZXNzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDQ4CiAgICAvLyBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIHR4biBTZW5kZXIKICAgID09CiAgICBhc3NlcnQgLy8gT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBieXRlY18zIC8vICJhZG1pbkFkZHJlc3MiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1MQogICAgLy8gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBuZXdBZG1pbkFkZHJlc3MKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5nZXRVc2VyU3RhdHModXNlckFkZHJlc3M6IGJ5dGVzKSAtPiBieXRlczoKZ2V0VXNlclN0YXRzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NTctNDU4CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRVc2VyU3RhdHModXNlckFkZHJlc3M6IEFjY291bnQpOiBBcnJheTx1aW50NjQ+IHsKICAgIHByb3RvIDEgMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NTkKICAgIC8vIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBnZXRVc2VyU3Rha2VJbmZvCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2MAogICAgLy8gY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2MwogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICBkaWcgMQogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2NAogICAgLy8gc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIGRpZyAyCiAgICBwdXNoaW50IDggLy8gOAogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDY1CiAgICAvLyBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICBkaWcgMwogICAgcHVzaGludCAxNiAvLyAxNgogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDY2CiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIGRpZyA0CiAgICBpbnRjXzMgLy8gMjQKICAgIGV4dHJhY3RfdWludDY0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2OAogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlLAogICAgdW5jb3ZlciA1CiAgICBwdXNoaW50IDMyIC8vIDMyCiAgICBleHRyYWN0X3VpbnQ2NAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjMKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgdW5jb3ZlciA0CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2NAogICAgLy8gc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIHVuY292ZXIgNAogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjMtNDY4CiAgICAvLyBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2NQogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgdW5jb3ZlciAzCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2My00NjgKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gcGVuZGluZ1Jld2FyZHMsCiAgICAvLyBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUsCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDY2CiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIHVuY292ZXIgMgogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjMtNDY4CiAgICAvLyBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2NwogICAgLy8gcGVuZGluZ1Jld2FyZHMsCiAgICB1bmNvdmVyIDIKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYzLTQ2OAogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyBwZW5kaW5nUmV3YXJkcywKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjgKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIHN3YXAKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYzLTQ2OAogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyBwZW5kaW5nUmV3YXJkcywKICAgIC8vIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIGNvbmNhdAogICAgZHVwCiAgICBsZW4KICAgIHB1c2hpbnQgOCAvLyA4CiAgICAvCiAgICBpdG9iCiAgICBleHRyYWN0IDYgMgogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ3MQogICAgLy8gcmV0dXJuIHJlc3VsdAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmdldENvbnRyYWN0U3RhdHMoKSAtPiBieXRlczoKZ2V0Q29udHJhY3RTdGF0czoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDc5CiAgICAvLyBjb25zdCBjdXJyZW50QVBZID0gdGhpcy5nZXRDdXJyZW50QVBZKCkKICAgIGNhbGxzdWIgZ2V0Q3VycmVudEFQWQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzIgLy8gInRvdGFsU3Rha2VkIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyBsYXN0UmV3YXJkVGltZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA2IC8vICJsYXN0UmV3YXJkVGltZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYyCiAgICAvLyBwdWJsaWMgcmV3YXJkUGVyaW9kID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDkgLy8gInJld2FyZFBlcmlvZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2CiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDcgLy8gIm1pbmltdW1TdGFrZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTgKICAgIC8vIHB1YmxpYyBhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA0IC8vICJhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyCiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIHVuY292ZXIgNgogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciA2CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0LTQ4NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3RSZXdhcmRUaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyAvLyBDb25zdGFudHMgZm9yIGZpeGVkIHJld2FyZCBzeXN0ZW0gLSBub3cgYXMgR2xvYmFsU3RhdGUgZm9yIGZsZXhpYmlsaXR5CiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQZXJpb2QgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHJlYWQgdXNlciBzdGFrZSBpbmZvIGZyb20gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIC8vICAgY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAodXNlckJveC5leGlzdHMpIHsKICAgIC8vICAgICByZXR1cm4gdXNlckJveC52YWx1ZS5jb3B5KCkKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICByZXR1cm4gbmV3IFVzZXJTdGFrZUluZm8oewogICAgLy8gICAgICAgc3Rha2VkQW1vdW50OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgZmlyc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgcmV3YXJkRGVidDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICB9KQogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHN0b3JlIHVzZXIgc3Rha2UgaW5mbyBpbiBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIC8vICAgdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKS52YWx1ZSA9IHN0YWtlSW5mby5jb3B5KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcmV3YXJkIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgdXBkYXRlUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgY29uc3QgY3VycmVudFRpbWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIGNvbnN0IGxhc3RSZXdhcmQgPSB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlcmlvZCA9IHRoaXMucmV3YXJkUGVyaW9kLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQ2hlY2sgaWYgYSBmdWxsIHJld2FyZCBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICBpZiAoY3VycmVudFRpbWUgPj0gbGFzdFJld2FyZCArIHJld2FyZFBlcmlvZCAmJiB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID4gMCkgewogICAgLy8gICAgIC8vIENhbGN1bGF0ZSBob3cgbWFueSBjb21wbGV0ZSBwZXJpb2RzIGhhdmUgcGFzc2VkCiAgICAvLyAgICAgY29uc3QgcGVyaW9kc1Bhc3NlZDogdWludDY0ID0gKGN1cnJlbnRUaW1lIC0gbGFzdFJld2FyZCkgLyByZXdhcmRQZXJpb2QKICAgIC8vIAogICAgLy8gICAgIC8vIFVwZGF0ZSBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gICAgIGNvbnN0IHRvdGFsUmV3YXJkczogdWludDY0ID0gcmV3YXJkUGVyUGVyaW9kICogcGVyaW9kc1Bhc3NlZAogICAgLy8gCiAgICAvLyAgICAgLy8gQXZvaWQgb3ZlcmZsb3cgYnkgY2FsY3VsYXRpbmc6ICh0b3RhbFJld2FyZHMgLyB0b3RhbFN0YWtlZCkgKiBwcmVjaXNpb24KICAgIC8vICAgICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbi52YWx1ZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclNoYXJlOiB1aW50NjQgPSAodG90YWxSZXdhcmRzICogcHJlY2lzaW9uKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgICB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSArIHJld2FyZFBlclNoYXJlCiAgICAvLyAKICAgIC8vICAgICAvLyBVcGRhdGUgbGFzdCByZXdhcmQgdGltZSB0byB0aGUgbW9zdCByZWNlbnQgY29tcGxldGUgcGVyaW9kCiAgICAvLyAgICAgdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IGxhc3RSZXdhcmQgKyAocGVyaW9kc1Bhc3NlZCAqIHJld2FyZFBlcmlvZCkKICAgIC8vIAogICAgLy8gICAgIC8vIERlZHVjdCByZXdhcmRzIGZyb20gcG9vbAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHRvdGFsUmV3YXJkcwogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGFjY1Jld2FyZHNQZXJTaGFyZSA9IHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUKICAgIC8vICAgY29uc3QgdXNlclJld2FyZERlYnQgPSBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUKICAgIC8vICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24udmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBBdm9pZCBvdmVyZmxvdzogY2FsY3VsYXRlIHRvdGFsIGVhcm5lZCBjYXJlZnVsbHkKICAgIC8vICAgY29uc3QgdG90YWxFYXJuZWQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBhY2NSZXdhcmRzUGVyU2hhcmUpIC8gcHJlY2lzaW9uCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzOiB1aW50NjQgPSB0b3RhbEVhcm5lZCA+IHVzZXJSZXdhcmREZWJ0ID8gdG90YWxFYXJuZWQgLSB1c2VyUmV3YXJkRGVidCA6IDAKICAgIC8vIAogICAgLy8gICByZXR1cm4gcGVuZGluZ1Jld2FyZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBJbml0aWFsaXplIHRoZSBjb250cmFjdCB3aXRoIHRoZSBBU0EgdG9rZW4gSUQgYW5kIG90aGVyIHBhcmFtZXRlcnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgaW5pdGlhbGl6ZSgKICAgIC8vICAgYXNzZXQ6IEFzc2V0LAogICAgLy8gICBhZG1pbkFkZHJlc3M6IEFjY291bnQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gICB3ZWVrbHlSZXdhcmRzOiB1aW50NjQsCiAgICAvLyAgIHJld2FyZFBlcmlvZDogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSA9IDAKICAgIC8vIAogICAgLy8gICAvLyBTZXQgcmV3YXJkIHN5c3RlbSBwYXJhbWV0ZXJzIHdpdGggZGVmYXVsdHMKICAgIC8vICAgdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlID0gd2Vla2x5UmV3YXJkcwogICAgLy8gICB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZSA9IHJld2FyZFBlcmlvZAogICAgLy8gICB0aGlzLnByZWNpc2lvbi52YWx1ZSA9IDFfMDAwXzAwMCAvLyBSZWR1Y2VkIHByZWNpc2lvbiBmcm9tIDFlMTIgdG8gMWU2IHRvIGF2b2lkIG92ZXJmbG93CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgb3B0SW5Ub0Fzc2V0KCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSB0aGUgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MgfHwgVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogMCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBTdGFrZSB0b2tlbnMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIHByb2Nlc3Npbmcgc3Rha2UKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHN0YWtlIGFtb3VudCBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgLy8gICBjb25zdCBzdGFrZUFtb3VudCA9IHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgdXNlciBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIENsYWltIHBlbmRpbmcgcmV3YXJkcyBpZiB1c2VyIGhhcyBleGlzdGluZyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgICAgaWYgKHBlbmRpbmdSZXdhcmRzID4gMCAmJiB0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICAgIC8vIEF1dG8tY29tcG91bmQgcmV3YXJkcyB0byBzdGFrZQogICAgLy8gICAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIElmIHRoaXMgaXMgYSBuZXcgc3Rha2UsIGVuc3VyZSBpdCBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICAgIC8vIFNldCB0aGUgZmlyc3Qgc3Rha2UgdGltZSAodGhpcyBuZXZlciBjaGFuZ2VzIGFmdGVyIGluaXRpYWwgc3Rha2UpCiAgICAvLyAgICAgc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBwcm9jZXNzaW5nIHdpdGhkcmF3YWwKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gQ2xhaW0gcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICBpZiAocGVuZGluZ1Jld2FyZHMgPiAwICYmIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICAgIGl0eG4KICAgIC8vICAgICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgICB9KQogICAgLy8gICAgICAgLnN1Ym1pdCgpCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBJZiB3aXRoZHJhd2luZyBhbGwsIG5vIG5lZWQgdG8gY2hlY2sgbWluaW11bSByZW1haW5pbmcKICAgIC8vICAgLy8gSWYgcGFydGlhbCB3aXRoZHJhd2FsLCBlbnN1cmUgcmVtYWluaW5nIHN0YWtlIG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICAvLyAgICAgY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgICBhc3NlcnQocmVtYWluaW5nU3Rha2UgPj0gbWluaW11bVN0YWtlLCAnUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDbGFpbSBwZW5kaW5nIHJld2FyZHMgd2l0aG91dCBjaGFuZ2luZyBzdGFrZQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBjbGFpbVJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBjbGFpbWluZwogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBzdGFrZQogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgIGFzc2VydChwZW5kaW5nUmV3YXJkcyA+IDAsICdObyBwZW5kaW5nIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQodGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzLCAnSW5zdWZmaWNpZW50IHJld2FyZCBwb29sJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgdXNlciBzdGF0cwogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQWRkIHJld2FyZHMgdG8gdGhlIHJld2FyZCBwb29sCiAgICAvLyAgKiBPbmx5IHRoZSBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCB0aGUgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBhZGRSZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCByZXdhcmRzCiAgICAvLyAgIGFzc2VydChHbG9iYWwuZ3JvdXBTaXplID09PSAyLCAnRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIEFTQSB0cmFuc2ZlciBkZXRhaWxzCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBwcm92aWRlIG5vbi16ZXJvIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBBZGQgcmV3YXJkcyB0byB0aGUgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgKyB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIGN1cnJlbnQgQVBZIGJhc2VkIG9uIHRvdGFsIHN0YWtlZCBhbW91bnQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudEFQWSgpOiB1aW50NjQgewogICAgLy8gICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vIAogICAgLy8gICBpZiAodG90YWxTdGFrZWQgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMCAvLyBSZXR1cm4gMCBpZiBubyB0b2tlbnMgc3Rha2VkCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgYW5udWFsIHJld2FyZHM6IDUyIHdlZWtzICogd2Vla2x5UmV3YXJkcwogICAgLy8gICBjb25zdCBhbm51YWxSZXdhcmRzOiB1aW50NjQgPSA1MiAqIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIEFQWSA9IChhbm51YWxSZXdhcmRzIC8gdG90YWxTdGFrZWQpICogMTAwMDAgKGluIGJhc2lzIHBvaW50cykKICAgIC8vICAgY29uc3QgYXB5OiB1aW50NjQgPSAoYW5udWFsUmV3YXJkcyAqIDEwMDAwKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIGFweQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBwZW5kaW5nIHJld2FyZHMgZm9yIGEgc3BlY2lmaWMgdXNlcgogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFRyaWdnZXIgcmV3YXJkIGRpc3RyaWJ1dGlvbiBtYW51YWxseSAoYWRtaW4gb25seSkKICAgIC8vICAqIFVwZGF0ZXMgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdHJpZ2dlclJld2FyZERpc3RyaWJ1dGlvbigpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB0cmlnZ2VyIGRpc3RyaWJ1dGlvbicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gICAgIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIC8vICAgXQogICAgLy8gCiAgICAvLyAgIHJldHVybiByZXN1bHQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgY29udHJhY3QgZ2xvYmFsIHN0YXRpc3RpY3MKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q29udHJhY3RTdGF0cygpOiBBcnJheTx1aW50NjQ+IHsKICAgIC8vICAgY29uc3QgY3VycmVudEFQWSA9IHRoaXMuZ2V0Q3VycmVudEFQWSgpCiAgICAvLyAKICAgIC8vICAgY29uc3QgcmVzdWx0OiB1aW50NjRbXSA9IFsKICAgIC8vICAgICB0aGlzLmFzc2V0LnZhbHVlLmlkLAogICAgLy8gICAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUsCiAgICAvLyAgICAgY3VycmVudEFQWSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0ODQKICAgIC8vIGN1cnJlbnRBUFksCiAgICB1bmNvdmVyIDYKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQtNDg0CiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbGFzdFJld2FyZFRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIC8vIENvbnN0YW50cyBmb3IgZml4ZWQgcmV3YXJkIHN5c3RlbSAtIG5vdyBhcyBHbG9iYWxTdGF0ZSBmb3IgZmxleGliaWxpdHkKICAgIC8vIHB1YmxpYyB3ZWVrbHlSZXdhcmRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBlcmlvZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBwcmVjaXNpb24gPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBmaXJzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGxhc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICB0b3RhbFJld2FyZHNFYXJuZWQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICByZXdhcmREZWJ0OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgIH0pCiAgICAvLyAgIH0KICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gc3RvcmUgdXNlciBzdGFrZSBpbmZvIGluIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBzdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQsIHN0YWtlSW5mbzogVXNlclN0YWtlSW5mbyk6IHZvaWQgewogICAgLy8gICB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpLnZhbHVlID0gc3Rha2VJbmZvLmNvcHkoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZSBpZiByZXdhcmQgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAqLwogICAgLy8gcHJpdmF0ZSB1cGRhdGVSZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICBjb25zdCBjdXJyZW50VGltZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vICAgY29uc3QgbGFzdFJld2FyZCA9IHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUKICAgIC8vICAgY29uc3QgcmV3YXJkUGVyaW9kID0gdGhpcy5yZXdhcmRQZXJpb2QudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiBhIGZ1bGwgcmV3YXJkIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgIGlmIChjdXJyZW50VGltZSA+PSBsYXN0UmV3YXJkICsgcmV3YXJkUGVyaW9kICYmIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPiAwKSB7CiAgICAvLyAgICAgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IGNvbXBsZXRlIHBlcmlvZHMgaGF2ZSBwYXNzZWQKICAgIC8vICAgICBjb25zdCBwZXJpb2RzUGFzc2VkOiB1aW50NjQgPSAoY3VycmVudFRpbWUgLSBsYXN0UmV3YXJkKSAvIHJld2FyZFBlcmlvZAogICAgLy8gCiAgICAvLyAgICAgLy8gVXBkYXRlIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlCiAgICAvLyAgICAgY29uc3QgcmV3YXJkUGVyUGVyaW9kID0gdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlCiAgICAvLyAgICAgY29uc3QgdG90YWxSZXdhcmRzOiB1aW50NjQgPSByZXdhcmRQZXJQZXJpb2QgKiBwZXJpb2RzUGFzc2VkCiAgICAvLyAKICAgIC8vICAgICAvLyBBdm9pZCBvdmVyZmxvdyBieSBjYWxjdWxhdGluZzogKHRvdGFsUmV3YXJkcyAvIHRvdGFsU3Rha2VkKSAqIHByZWNpc2lvbgogICAgLy8gICAgIGNvbnN0IHRvdGFsU3Rha2VkID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZQogICAgLy8gICAgIGNvbnN0IHByZWNpc2lvbiA9IHRoaXMucHJlY2lzaW9uLnZhbHVlCiAgICAvLyAgICAgY29uc3QgcmV3YXJkUGVyU2hhcmU6IHVpbnQ2NCA9ICh0b3RhbFJld2FyZHMgKiBwcmVjaXNpb24pIC8gdG90YWxTdGFrZWQKICAgIC8vIAogICAgLy8gICAgIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgPSB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlICsgcmV3YXJkUGVyU2hhcmUKICAgIC8vIAogICAgLy8gICAgIC8vIFVwZGF0ZSBsYXN0IHJld2FyZCB0aW1lIHRvIHRoZSBtb3N0IHJlY2VudCBjb21wbGV0ZSBwZXJpb2QKICAgIC8vICAgICB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlID0gbGFzdFJld2FyZCArIChwZXJpb2RzUGFzc2VkICogcmV3YXJkUGVyaW9kKQogICAgLy8gCiAgICAvLyAgICAgLy8gRGVkdWN0IHJld2FyZHMgZnJvbSBwb29sCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gdG90YWxSZXdhcmRzCiAgICAvLyAgIH0KICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gcHJpdmF0ZSBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgY29uc3QgdXNlclN0YWtlID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUKICAgIC8vICAgY29uc3QgYWNjUmV3YXJkc1BlclNoYXJlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZQogICAgLy8gICBjb25zdCB1c2VyUmV3YXJkRGVidCA9IHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZQogICAgLy8gICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbi52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIEF2b2lkIG92ZXJmbG93OiBjYWxjdWxhdGUgdG90YWwgZWFybmVkIGNhcmVmdWxseQogICAgLy8gICBjb25zdCB0b3RhbEVhcm5lZDogdWludDY0ID0gKHVzZXJTdGFrZSAqIGFjY1Jld2FyZHNQZXJTaGFyZSkgLyBwcmVjaXNpb24KICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHM6IHVpbnQ2NCA9IHRvdGFsRWFybmVkID4gdXNlclJld2FyZERlYnQgPyB0b3RhbEVhcm5lZCAtIHVzZXJSZXdhcmREZWJ0IDogMAogICAgLy8gCiAgICAvLyAgIHJldHVybiBwZW5kaW5nUmV3YXJkcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEluaXRpYWxpemUgdGhlIGNvbnRyYWN0IHdpdGggdGhlIEFTQSB0b2tlbiBJRCBhbmQgb3RoZXIgcGFyYW1ldGVycwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBpbml0aWFsaXplKAogICAgLy8gICBhc3NldDogQXNzZXQsCiAgICAvLyAgIGFkbWluQWRkcmVzczogQWNjb3VudCwKICAgIC8vICAgbWluaW11bVN0YWtlOiB1aW50NjQsCiAgICAvLyAgIHdlZWtseVJld2FyZHM6IHVpbnQ2NCwKICAgIC8vICAgcmV3YXJkUGVyaW9kOiB1aW50NjQsCiAgICAvLyApOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgaXMgb25seSBjYWxsZWQgZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlID09PSBBc3NldCgpLCAnQWxyZWFkeSBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3IgY2FuIGluaXRpYWxpemUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcywgJ09ubHkgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZScpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdGhlIGluaXRpYWwgcGFyYW1ldGVycwogICAgLy8gICB0aGlzLmFzc2V0LnZhbHVlID0gYXNzZXQKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBhZG1pbkFkZHJlc3MKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUgPSBtaW5pbXVtU3Rha2UKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gMAogICAgLy8gICB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gMAogICAgLy8gCiAgICAvLyAgIC8vIFNldCByZXdhcmQgc3lzdGVtIHBhcmFtZXRlcnMgd2l0aCBkZWZhdWx0cwogICAgLy8gICB0aGlzLndlZWtseVJld2FyZHMudmFsdWUgPSB3ZWVrbHlSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUGVyaW9kLnZhbHVlID0gcmV3YXJkUGVyaW9kCiAgICAvLyAgIHRoaXMucHJlY2lzaW9uLnZhbHVlID0gMV8wMDBfMDAwIC8vIFJlZHVjZWQgcHJlY2lzaW9uIGZyb20gMWUxMiB0byAxZTYgdG8gYXZvaWQgb3ZlcmZsb3cKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKiBBdXRvbWF0aWNhbGx5IGNsYWltcyBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgc3Rha2UoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGUgY29udHJhY3QgaGFzIG9wdGVkIGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgIT09IEFzc2V0KCksICdDb250cmFjdCBub3QgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgcHJvY2Vzc2luZyBzdGFrZQogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgc3Rha2UgYW1vdW50IGZyb20gdGhlIHRyYW5zYWN0aW9uCiAgICAvLyAgIGNvbnN0IHN0YWtlQW1vdW50ID0geGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gICBjb25zdCBtaW5pbXVtU3Rha2UgPSB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZQogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgY3VycmVudCB1c2VyIHN0YWtlIGluZm8KICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gQ2xhaW0gcGVuZGluZyByZXdhcmRzIGlmIHVzZXIgaGFzIGV4aXN0aW5nIHN0YWtlCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDApIHsKICAgIC8vICAgICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgICBpZiAocGVuZGluZ1Jld2FyZHMgPiAwICYmIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgICAgLy8gQXV0by1jb21wb3VuZCByZXdhcmRzIHRvIHN0YWtlCiAgICAvLyAgICAgICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgICAgfQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gSWYgdGhpcyBpcyBhIG5ldyBzdGFrZSwgZW5zdXJlIGl0IG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgYXNzZXJ0KHN0YWtlQW1vdW50ID49IG1pbmltdW1TdGFrZSwgJ0luaXRpYWwgc3Rha2UgYmVsb3cgbWluaW11bScpCiAgICAvLyAgICAgLy8gU2V0IHRoZSBmaXJzdCBzdGFrZSB0aW1lICh0aGlzIG5ldmVyIGNoYW5nZXMgYWZ0ZXIgaW5pdGlhbCBzdGFrZSkKICAgIC8vICAgICBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgc3Rha2UgaW5mbwogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHN0YWtlQW1vdW50KQogICAgLy8gICBzdGFrZUluZm8ubGFzdFN0YWtlVGltZSA9IG5ldyBhcmM0LlVpbnRONjQoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIGRlYnQKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBXaXRoZHJhdyBzdGFrZWQgdG9rZW5zCiAgICAvLyAgKiBBdXRvbWF0aWNhbGx5IGNsYWltcyBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgd2l0aGRyYXcoYW1vdW50OiB1aW50NjQpOiB2b2lkIHsKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIHByb2Nlc3Npbmcgd2l0aGRyYXdhbAogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBlbm91Z2ggc3Rha2VkCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPD0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsICdXaXRoZHJhd2FsIGFtb3VudCBleGNlZWRzIHN0YWtlJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA+IDAsICdXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlJykKICAgIC8vIAogICAgLy8gICAvLyBDbGFpbSBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICAvLyAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gCiAgICAvLyAgICAgLy8gVHJhbnNmZXIgcmV3YXJkcyB0byB1c2VyCiAgICAvLyAgICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgICAgaXR4bgogICAgLy8gICAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICAgIH0pCiAgICAvLyAgICAgICAuc3VibWl0KCkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIElmIHdpdGhkcmF3aW5nIGFsbCwgbm8gbmVlZCB0byBjaGVjayBtaW5pbXVtIHJlbWFpbmluZwogICAgLy8gICAvLyBJZiBwYXJ0aWFsIHdpdGhkcmF3YWwsIGVuc3VyZSByZW1haW5pbmcgc3Rha2UgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoYW1vdW50IDwgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUpIHsKICAgIC8vICAgICBjb25zdCByZW1haW5pbmdTdGFrZTogdWludDY0ID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICBjb25zdCBtaW5pbXVtU3Rha2UgPSB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZQogICAgLy8gICAgIGFzc2VydChyZW1haW5pbmdTdGFrZSA+PSBtaW5pbXVtU3Rha2UsICdSZW1haW5pbmcgc3Rha2Ugd291bGQgYmUgYmVsb3cgbWluaW11bScpCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgc3Rha2UgaW5mbwogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIGRlYnQKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlIC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgdG9rZW5zIGJhY2sgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENsYWltIHBlbmRpbmcgcmV3YXJkcyB3aXRob3V0IGNoYW5naW5nIHN0YWtlCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGNsYWltUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIGNsYWltaW5nCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHVzZXIgaGFzIHN0YWtlCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgYXNzZXJ0KHBlbmRpbmdSZXdhcmRzID4gMCwgJ05vIHBlbmRpbmcgcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMsICdJbnN1ZmZpY2llbnQgcmV3YXJkIHBvb2wnKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB1c2VyIHN0YXRzCiAgICAvLyAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgcmV3YXJkcyB0byB1c2VyCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgY3VycmVudCBBUFkgYmFzZWQgb24gdG90YWwgc3Rha2VkIGFtb3VudAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDdXJyZW50QVBZKCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHRvdGFsU3Rha2VkID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZQogICAgLy8gCiAgICAvLyAgIGlmICh0b3RhbFN0YWtlZCA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwIC8vIFJldHVybiAwIGlmIG5vIHRva2VucyBzdGFrZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBhbm51YWwgcmV3YXJkczogNTIgd2Vla3MgKiB3ZWVrbHlSZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFubnVhbFJld2FyZHM6IHVpbnQ2NCA9IDUyICogdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQVBZID0gKGFubnVhbFJld2FyZHMgLyB0b3RhbFN0YWtlZCkgKiAxMDAwMCAoaW4gYmFzaXMgcG9pbnRzKQogICAgLy8gICBjb25zdCBhcHk6IHVpbnQ2NCA9IChhbm51YWxSZXdhcmRzICogMTAwMDApIC8gdG90YWxTdGFrZWQKICAgIC8vIAogICAgLy8gICByZXR1cm4gYXB5CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IHBlbmRpbmcgcmV3YXJkcyBmb3IgYSBzcGVjaWZpYyB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVHJpZ2dlciByZXdhcmQgZGlzdHJpYnV0aW9uIG1hbnVhbGx5IChhZG1pbiBvbmx5KQogICAgLy8gICogVXBkYXRlcyBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZSBpZiBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB0cmlnZ2VyUmV3YXJkRGlzdHJpYnV0aW9uKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdHJpZ2dlciBkaXN0cmlidXRpb24KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcwogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICogT25seSB0aGUgY3VycmVudCBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFkbWluKG5ld0FkbWluQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gbmV3QWRtaW5BZGRyZXNzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGN1cnJlbnQgc3Rha2luZyBzdGF0aXN0aWNzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YXRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyAgICAgcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBjdXJyZW50QVBZID0gdGhpcy5nZXRDdXJyZW50QVBZKCkKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICBjdXJyZW50QVBZLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU1CiAgICAvLyBwdWJsaWMgbGFzdFJld2FyZFRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICB1bmNvdmVyIDUKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQtNDg0CiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbGFzdFJld2FyZFRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIC8vIENvbnN0YW50cyBmb3IgZml4ZWQgcmV3YXJkIHN5c3RlbSAtIG5vdyBhcyBHbG9iYWxTdGF0ZSBmb3IgZmxleGliaWxpdHkKICAgIC8vIHB1YmxpYyB3ZWVrbHlSZXdhcmRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBlcmlvZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBwcmVjaXNpb24gPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBmaXJzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGxhc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICB0b3RhbFJld2FyZHNFYXJuZWQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICByZXdhcmREZWJ0OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgIH0pCiAgICAvLyAgIH0KICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gc3RvcmUgdXNlciBzdGFrZSBpbmZvIGluIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBzdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQsIHN0YWtlSW5mbzogVXNlclN0YWtlSW5mbyk6IHZvaWQgewogICAgLy8gICB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpLnZhbHVlID0gc3Rha2VJbmZvLmNvcHkoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZSBpZiByZXdhcmQgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAqLwogICAgLy8gcHJpdmF0ZSB1cGRhdGVSZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICBjb25zdCBjdXJyZW50VGltZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vICAgY29uc3QgbGFzdFJld2FyZCA9IHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUKICAgIC8vICAgY29uc3QgcmV3YXJkUGVyaW9kID0gdGhpcy5yZXdhcmRQZXJpb2QudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiBhIGZ1bGwgcmV3YXJkIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgIGlmIChjdXJyZW50VGltZSA+PSBsYXN0UmV3YXJkICsgcmV3YXJkUGVyaW9kICYmIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPiAwKSB7CiAgICAvLyAgICAgLy8gQ2FsY3VsYXRlIGhvdyBtYW55IGNvbXBsZXRlIHBlcmlvZHMgaGF2ZSBwYXNzZWQKICAgIC8vICAgICBjb25zdCBwZXJpb2RzUGFzc2VkOiB1aW50NjQgPSAoY3VycmVudFRpbWUgLSBsYXN0UmV3YXJkKSAvIHJld2FyZFBlcmlvZAogICAgLy8gCiAgICAvLyAgICAgLy8gVXBkYXRlIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlCiAgICAvLyAgICAgY29uc3QgcmV3YXJkUGVyUGVyaW9kID0gdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlCiAgICAvLyAgICAgY29uc3QgdG90YWxSZXdhcmRzOiB1aW50NjQgPSByZXdhcmRQZXJQZXJpb2QgKiBwZXJpb2RzUGFzc2VkCiAgICAvLyAKICAgIC8vICAgICAvLyBBdm9pZCBvdmVyZmxvdyBieSBjYWxjdWxhdGluZzogKHRvdGFsUmV3YXJkcyAvIHRvdGFsU3Rha2VkKSAqIHByZWNpc2lvbgogICAgLy8gICAgIGNvbnN0IHRvdGFsU3Rha2VkID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZQogICAgLy8gICAgIGNvbnN0IHByZWNpc2lvbiA9IHRoaXMucHJlY2lzaW9uLnZhbHVlCiAgICAvLyAgICAgY29uc3QgcmV3YXJkUGVyU2hhcmU6IHVpbnQ2NCA9ICh0b3RhbFJld2FyZHMgKiBwcmVjaXNpb24pIC8gdG90YWxTdGFrZWQKICAgIC8vIAogICAgLy8gICAgIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgPSB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlICsgcmV3YXJkUGVyU2hhcmUKICAgIC8vIAogICAgLy8gICAgIC8vIFVwZGF0ZSBsYXN0IHJld2FyZCB0aW1lIHRvIHRoZSBtb3N0IHJlY2VudCBjb21wbGV0ZSBwZXJpb2QKICAgIC8vICAgICB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlID0gbGFzdFJld2FyZCArIChwZXJpb2RzUGFzc2VkICogcmV3YXJkUGVyaW9kKQogICAgLy8gCiAgICAvLyAgICAgLy8gRGVkdWN0IHJld2FyZHMgZnJvbSBwb29sCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gdG90YWxSZXdhcmRzCiAgICAvLyAgIH0KICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gcHJpdmF0ZSBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgY29uc3QgdXNlclN0YWtlID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUKICAgIC8vICAgY29uc3QgYWNjUmV3YXJkc1BlclNoYXJlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZQogICAgLy8gICBjb25zdCB1c2VyUmV3YXJkRGVidCA9IHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZQogICAgLy8gICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbi52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIEF2b2lkIG92ZXJmbG93OiBjYWxjdWxhdGUgdG90YWwgZWFybmVkIGNhcmVmdWxseQogICAgLy8gICBjb25zdCB0b3RhbEVhcm5lZDogdWludDY0ID0gKHVzZXJTdGFrZSAqIGFjY1Jld2FyZHNQZXJTaGFyZSkgLyBwcmVjaXNpb24KICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHM6IHVpbnQ2NCA9IHRvdGFsRWFybmVkID4gdXNlclJld2FyZERlYnQgPyB0b3RhbEVhcm5lZCAtIHVzZXJSZXdhcmREZWJ0IDogMAogICAgLy8gCiAgICAvLyAgIHJldHVybiBwZW5kaW5nUmV3YXJkcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEluaXRpYWxpemUgdGhlIGNvbnRyYWN0IHdpdGggdGhlIEFTQSB0b2tlbiBJRCBhbmQgb3RoZXIgcGFyYW1ldGVycwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBpbml0aWFsaXplKAogICAgLy8gICBhc3NldDogQXNzZXQsCiAgICAvLyAgIGFkbWluQWRkcmVzczogQWNjb3VudCwKICAgIC8vICAgbWluaW11bVN0YWtlOiB1aW50NjQsCiAgICAvLyAgIHdlZWtseVJld2FyZHM6IHVpbnQ2NCwKICAgIC8vICAgcmV3YXJkUGVyaW9kOiB1aW50NjQsCiAgICAvLyApOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgaXMgb25seSBjYWxsZWQgZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlID09PSBBc3NldCgpLCAnQWxyZWFkeSBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3IgY2FuIGluaXRpYWxpemUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcywgJ09ubHkgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZScpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdGhlIGluaXRpYWwgcGFyYW1ldGVycwogICAgLy8gICB0aGlzLmFzc2V0LnZhbHVlID0gYXNzZXQKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBhZG1pbkFkZHJlc3MKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUgPSBtaW5pbXVtU3Rha2UKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gMAogICAgLy8gICB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gMAogICAgLy8gCiAgICAvLyAgIC8vIFNldCByZXdhcmQgc3lzdGVtIHBhcmFtZXRlcnMgd2l0aCBkZWZhdWx0cwogICAgLy8gICB0aGlzLndlZWtseVJld2FyZHMudmFsdWUgPSB3ZWVrbHlSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUGVyaW9kLnZhbHVlID0gcmV3YXJkUGVyaW9kCiAgICAvLyAgIHRoaXMucHJlY2lzaW9uLnZhbHVlID0gMV8wMDBfMDAwIC8vIFJlZHVjZWQgcHJlY2lzaW9uIGZyb20gMWUxMiB0byAxZTYgdG8gYXZvaWQgb3ZlcmZsb3cKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKiBBdXRvbWF0aWNhbGx5IGNsYWltcyBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgc3Rha2UoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGUgY29udHJhY3QgaGFzIG9wdGVkIGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgIT09IEFzc2V0KCksICdDb250cmFjdCBub3QgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgcHJvY2Vzc2luZyBzdGFrZQogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgc3Rha2UgYW1vdW50IGZyb20gdGhlIHRyYW5zYWN0aW9uCiAgICAvLyAgIGNvbnN0IHN0YWtlQW1vdW50ID0geGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gICBjb25zdCBtaW5pbXVtU3Rha2UgPSB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZQogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgY3VycmVudCB1c2VyIHN0YWtlIGluZm8KICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gQ2xhaW0gcGVuZGluZyByZXdhcmRzIGlmIHVzZXIgaGFzIGV4aXN0aW5nIHN0YWtlCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDApIHsKICAgIC8vICAgICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgICBpZiAocGVuZGluZ1Jld2FyZHMgPiAwICYmIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgICAgLy8gQXV0by1jb21wb3VuZCByZXdhcmRzIHRvIHN0YWtlCiAgICAvLyAgICAgICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgICAgfQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gSWYgdGhpcyBpcyBhIG5ldyBzdGFrZSwgZW5zdXJlIGl0IG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgYXNzZXJ0KHN0YWtlQW1vdW50ID49IG1pbmltdW1TdGFrZSwgJ0luaXRpYWwgc3Rha2UgYmVsb3cgbWluaW11bScpCiAgICAvLyAgICAgLy8gU2V0IHRoZSBmaXJzdCBzdGFrZSB0aW1lICh0aGlzIG5ldmVyIGNoYW5nZXMgYWZ0ZXIgaW5pdGlhbCBzdGFrZSkKICAgIC8vICAgICBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgc3Rha2UgaW5mbwogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHN0YWtlQW1vdW50KQogICAgLy8gICBzdGFrZUluZm8ubGFzdFN0YWtlVGltZSA9IG5ldyBhcmM0LlVpbnRONjQoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCkKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIGRlYnQKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBXaXRoZHJhdyBzdGFrZWQgdG9rZW5zCiAgICAvLyAgKiBBdXRvbWF0aWNhbGx5IGNsYWltcyBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgd2l0aGRyYXcoYW1vdW50OiB1aW50NjQpOiB2b2lkIHsKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIHByb2Nlc3Npbmcgd2l0aGRyYXdhbAogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBlbm91Z2ggc3Rha2VkCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPD0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsICdXaXRoZHJhd2FsIGFtb3VudCBleGNlZWRzIHN0YWtlJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA+IDAsICdXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlJykKICAgIC8vIAogICAgLy8gICAvLyBDbGFpbSBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICAvLyAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gCiAgICAvLyAgICAgLy8gVHJhbnNmZXIgcmV3YXJkcyB0byB1c2VyCiAgICAvLyAgICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgICAgaXR4bgogICAgLy8gICAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICAgIH0pCiAgICAvLyAgICAgICAuc3VibWl0KCkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIElmIHdpdGhkcmF3aW5nIGFsbCwgbm8gbmVlZCB0byBjaGVjayBtaW5pbXVtIHJlbWFpbmluZwogICAgLy8gICAvLyBJZiBwYXJ0aWFsIHdpdGhkcmF3YWwsIGVuc3VyZSByZW1haW5pbmcgc3Rha2UgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoYW1vdW50IDwgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUpIHsKICAgIC8vICAgICBjb25zdCByZW1haW5pbmdTdGFrZTogdWludDY0ID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQKICAgIC8vICAgICBjb25zdCBtaW5pbXVtU3Rha2UgPSB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZQogICAgLy8gICAgIGFzc2VydChyZW1haW5pbmdTdGFrZSA+PSBtaW5pbXVtU3Rha2UsICdSZW1haW5pbmcgc3Rha2Ugd291bGQgYmUgYmVsb3cgbWluaW11bScpCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgc3Rha2UgaW5mbwogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudCkKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIGRlYnQKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlIC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgdG9rZW5zIGJhY2sgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENsYWltIHBlbmRpbmcgcmV3YXJkcyB3aXRob3V0IGNoYW5naW5nIHN0YWtlCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGNsYWltUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIGNsYWltaW5nCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHVzZXIgaGFzIHN0YWtlCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgYXNzZXJ0KHBlbmRpbmdSZXdhcmRzID4gMCwgJ05vIHBlbmRpbmcgcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMsICdJbnN1ZmZpY2llbnQgcmV3YXJkIHBvb2wnKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB1c2VyIHN0YXRzCiAgICAvLyAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgcmV3YXJkcyB0byB1c2VyCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgY3VycmVudCBBUFkgYmFzZWQgb24gdG90YWwgc3Rha2VkIGFtb3VudAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDdXJyZW50QVBZKCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHRvdGFsU3Rha2VkID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZQogICAgLy8gCiAgICAvLyAgIGlmICh0b3RhbFN0YWtlZCA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwIC8vIFJldHVybiAwIGlmIG5vIHRva2VucyBzdGFrZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBhbm51YWwgcmV3YXJkczogNTIgd2Vla3MgKiB3ZWVrbHlSZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFubnVhbFJld2FyZHM6IHVpbnQ2NCA9IDUyICogdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQVBZID0gKGFubnVhbFJld2FyZHMgLyB0b3RhbFN0YWtlZCkgKiAxMDAwMCAoaW4gYmFzaXMgcG9pbnRzKQogICAgLy8gICBjb25zdCBhcHk6IHVpbnQ2NCA9IChhbm51YWxSZXdhcmRzICogMTAwMDApIC8gdG90YWxTdGFrZWQKICAgIC8vIAogICAgLy8gICByZXR1cm4gYXB5CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IHBlbmRpbmcgcmV3YXJkcyBmb3IgYSBzcGVjaWZpYyB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgcmV0dXJuIHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVHJpZ2dlciByZXdhcmQgZGlzdHJpYnV0aW9uIG1hbnVhbGx5IChhZG1pbiBvbmx5KQogICAgLy8gICogVXBkYXRlcyBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZSBpZiBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB0cmlnZ2VyUmV3YXJkRGlzdHJpYnV0aW9uKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdHJpZ2dlciBkaXN0cmlidXRpb24KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcwogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICogT25seSB0aGUgY3VycmVudCBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFkbWluKG5ld0FkbWluQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gbmV3QWRtaW5BZGRyZXNzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGN1cnJlbnQgc3Rha2luZyBzdGF0aXN0aWNzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YXRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyAgICAgcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBjdXJyZW50QVBZID0gdGhpcy5nZXRDdXJyZW50QVBZKCkKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICBjdXJyZW50QVBZLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYyCiAgICAvLyBwdWJsaWMgcmV3YXJkUGVyaW9kID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciA0CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0LTQ4NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3RSZXdhcmRUaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyAvLyBDb25zdGFudHMgZm9yIGZpeGVkIHJld2FyZCBzeXN0ZW0gLSBub3cgYXMgR2xvYmFsU3RhdGUgZm9yIGZsZXhpYmlsaXR5CiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQZXJpb2QgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHJlYWQgdXNlciBzdGFrZSBpbmZvIGZyb20gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIC8vICAgY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAodXNlckJveC5leGlzdHMpIHsKICAgIC8vICAgICByZXR1cm4gdXNlckJveC52YWx1ZS5jb3B5KCkKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICByZXR1cm4gbmV3IFVzZXJTdGFrZUluZm8oewogICAgLy8gICAgICAgc3Rha2VkQW1vdW50OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgZmlyc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgcmV3YXJkRGVidDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICB9KQogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHN0b3JlIHVzZXIgc3Rha2UgaW5mbyBpbiBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIC8vICAgdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKS52YWx1ZSA9IHN0YWtlSW5mby5jb3B5KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcmV3YXJkIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgdXBkYXRlUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgY29uc3QgY3VycmVudFRpbWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIGNvbnN0IGxhc3RSZXdhcmQgPSB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlcmlvZCA9IHRoaXMucmV3YXJkUGVyaW9kLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQ2hlY2sgaWYgYSBmdWxsIHJld2FyZCBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICBpZiAoY3VycmVudFRpbWUgPj0gbGFzdFJld2FyZCArIHJld2FyZFBlcmlvZCAmJiB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID4gMCkgewogICAgLy8gICAgIC8vIENhbGN1bGF0ZSBob3cgbWFueSBjb21wbGV0ZSBwZXJpb2RzIGhhdmUgcGFzc2VkCiAgICAvLyAgICAgY29uc3QgcGVyaW9kc1Bhc3NlZDogdWludDY0ID0gKGN1cnJlbnRUaW1lIC0gbGFzdFJld2FyZCkgLyByZXdhcmRQZXJpb2QKICAgIC8vIAogICAgLy8gICAgIC8vIFVwZGF0ZSBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gICAgIGNvbnN0IHRvdGFsUmV3YXJkczogdWludDY0ID0gcmV3YXJkUGVyUGVyaW9kICogcGVyaW9kc1Bhc3NlZAogICAgLy8gCiAgICAvLyAgICAgLy8gQXZvaWQgb3ZlcmZsb3cgYnkgY2FsY3VsYXRpbmc6ICh0b3RhbFJld2FyZHMgLyB0b3RhbFN0YWtlZCkgKiBwcmVjaXNpb24KICAgIC8vICAgICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbi52YWx1ZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclNoYXJlOiB1aW50NjQgPSAodG90YWxSZXdhcmRzICogcHJlY2lzaW9uKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgICB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSArIHJld2FyZFBlclNoYXJlCiAgICAvLyAKICAgIC8vICAgICAvLyBVcGRhdGUgbGFzdCByZXdhcmQgdGltZSB0byB0aGUgbW9zdCByZWNlbnQgY29tcGxldGUgcGVyaW9kCiAgICAvLyAgICAgdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IGxhc3RSZXdhcmQgKyAocGVyaW9kc1Bhc3NlZCAqIHJld2FyZFBlcmlvZCkKICAgIC8vIAogICAgLy8gICAgIC8vIERlZHVjdCByZXdhcmRzIGZyb20gcG9vbAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHRvdGFsUmV3YXJkcwogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGFjY1Jld2FyZHNQZXJTaGFyZSA9IHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUKICAgIC8vICAgY29uc3QgdXNlclJld2FyZERlYnQgPSBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUKICAgIC8vICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24udmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBBdm9pZCBvdmVyZmxvdzogY2FsY3VsYXRlIHRvdGFsIGVhcm5lZCBjYXJlZnVsbHkKICAgIC8vICAgY29uc3QgdG90YWxFYXJuZWQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBhY2NSZXdhcmRzUGVyU2hhcmUpIC8gcHJlY2lzaW9uCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzOiB1aW50NjQgPSB0b3RhbEVhcm5lZCA+IHVzZXJSZXdhcmREZWJ0ID8gdG90YWxFYXJuZWQgLSB1c2VyUmV3YXJkRGVidCA6IDAKICAgIC8vIAogICAgLy8gICByZXR1cm4gcGVuZGluZ1Jld2FyZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBJbml0aWFsaXplIHRoZSBjb250cmFjdCB3aXRoIHRoZSBBU0EgdG9rZW4gSUQgYW5kIG90aGVyIHBhcmFtZXRlcnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgaW5pdGlhbGl6ZSgKICAgIC8vICAgYXNzZXQ6IEFzc2V0LAogICAgLy8gICBhZG1pbkFkZHJlc3M6IEFjY291bnQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gICB3ZWVrbHlSZXdhcmRzOiB1aW50NjQsCiAgICAvLyAgIHJld2FyZFBlcmlvZDogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSA9IDAKICAgIC8vIAogICAgLy8gICAvLyBTZXQgcmV3YXJkIHN5c3RlbSBwYXJhbWV0ZXJzIHdpdGggZGVmYXVsdHMKICAgIC8vICAgdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlID0gd2Vla2x5UmV3YXJkcwogICAgLy8gICB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZSA9IHJld2FyZFBlcmlvZAogICAgLy8gICB0aGlzLnByZWNpc2lvbi52YWx1ZSA9IDFfMDAwXzAwMCAvLyBSZWR1Y2VkIHByZWNpc2lvbiBmcm9tIDFlMTIgdG8gMWU2IHRvIGF2b2lkIG92ZXJmbG93CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgb3B0SW5Ub0Fzc2V0KCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSB0aGUgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MgfHwgVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogMCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBTdGFrZSB0b2tlbnMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIHByb2Nlc3Npbmcgc3Rha2UKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHN0YWtlIGFtb3VudCBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgLy8gICBjb25zdCBzdGFrZUFtb3VudCA9IHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgdXNlciBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIENsYWltIHBlbmRpbmcgcmV3YXJkcyBpZiB1c2VyIGhhcyBleGlzdGluZyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgICAgaWYgKHBlbmRpbmdSZXdhcmRzID4gMCAmJiB0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICAgIC8vIEF1dG8tY29tcG91bmQgcmV3YXJkcyB0byBzdGFrZQogICAgLy8gICAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIElmIHRoaXMgaXMgYSBuZXcgc3Rha2UsIGVuc3VyZSBpdCBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICAgIC8vIFNldCB0aGUgZmlyc3Qgc3Rha2UgdGltZSAodGhpcyBuZXZlciBjaGFuZ2VzIGFmdGVyIGluaXRpYWwgc3Rha2UpCiAgICAvLyAgICAgc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBwcm9jZXNzaW5nIHdpdGhkcmF3YWwKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gQ2xhaW0gcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICBpZiAocGVuZGluZ1Jld2FyZHMgPiAwICYmIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICAgIGl0eG4KICAgIC8vICAgICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgICB9KQogICAgLy8gICAgICAgLnN1Ym1pdCgpCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBJZiB3aXRoZHJhd2luZyBhbGwsIG5vIG5lZWQgdG8gY2hlY2sgbWluaW11bSByZW1haW5pbmcKICAgIC8vICAgLy8gSWYgcGFydGlhbCB3aXRoZHJhd2FsLCBlbnN1cmUgcmVtYWluaW5nIHN0YWtlIG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICAvLyAgICAgY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgICBhc3NlcnQocmVtYWluaW5nU3Rha2UgPj0gbWluaW11bVN0YWtlLCAnUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDbGFpbSBwZW5kaW5nIHJld2FyZHMgd2l0aG91dCBjaGFuZ2luZyBzdGFrZQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBjbGFpbVJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBjbGFpbWluZwogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBzdGFrZQogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgIGFzc2VydChwZW5kaW5nUmV3YXJkcyA+IDAsICdObyBwZW5kaW5nIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQodGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzLCAnSW5zdWZmaWNpZW50IHJld2FyZCBwb29sJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgdXNlciBzdGF0cwogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQWRkIHJld2FyZHMgdG8gdGhlIHJld2FyZCBwb29sCiAgICAvLyAgKiBPbmx5IHRoZSBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCB0aGUgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBhZGRSZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCByZXdhcmRzCiAgICAvLyAgIGFzc2VydChHbG9iYWwuZ3JvdXBTaXplID09PSAyLCAnRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIEFTQSB0cmFuc2ZlciBkZXRhaWxzCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBwcm92aWRlIG5vbi16ZXJvIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBBZGQgcmV3YXJkcyB0byB0aGUgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgKyB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIGN1cnJlbnQgQVBZIGJhc2VkIG9uIHRvdGFsIHN0YWtlZCBhbW91bnQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudEFQWSgpOiB1aW50NjQgewogICAgLy8gICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vIAogICAgLy8gICBpZiAodG90YWxTdGFrZWQgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMCAvLyBSZXR1cm4gMCBpZiBubyB0b2tlbnMgc3Rha2VkCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgYW5udWFsIHJld2FyZHM6IDUyIHdlZWtzICogd2Vla2x5UmV3YXJkcwogICAgLy8gICBjb25zdCBhbm51YWxSZXdhcmRzOiB1aW50NjQgPSA1MiAqIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIEFQWSA9IChhbm51YWxSZXdhcmRzIC8gdG90YWxTdGFrZWQpICogMTAwMDAgKGluIGJhc2lzIHBvaW50cykKICAgIC8vICAgY29uc3QgYXB5OiB1aW50NjQgPSAoYW5udWFsUmV3YXJkcyAqIDEwMDAwKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIGFweQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBwZW5kaW5nIHJld2FyZHMgZm9yIGEgc3BlY2lmaWMgdXNlcgogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFRyaWdnZXIgcmV3YXJkIGRpc3RyaWJ1dGlvbiBtYW51YWxseSAoYWRtaW4gb25seSkKICAgIC8vICAqIFVwZGF0ZXMgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdHJpZ2dlclJld2FyZERpc3RyaWJ1dGlvbigpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB0cmlnZ2VyIGRpc3RyaWJ1dGlvbicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gICAgIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIC8vICAgXQogICAgLy8gCiAgICAvLyAgIHJldHVybiByZXN1bHQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgY29udHJhY3QgZ2xvYmFsIHN0YXRpc3RpY3MKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q29udHJhY3RTdGF0cygpOiBBcnJheTx1aW50NjQ+IHsKICAgIC8vICAgY29uc3QgY3VycmVudEFQWSA9IHRoaXMuZ2V0Q3VycmVudEFQWSgpCiAgICAvLyAKICAgIC8vICAgY29uc3QgcmVzdWx0OiB1aW50NjRbXSA9IFsKICAgIC8vICAgICB0aGlzLmFzc2V0LnZhbHVlLmlkLAogICAgLy8gICAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUsCiAgICAvLyAgICAgY3VycmVudEFQWSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NgogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIHVuY292ZXIgMwogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NC00ODQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBsYXN0UmV3YXJkVGltZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gLy8gQ29uc3RhbnRzIGZvciBmaXhlZCByZXdhcmQgc3lzdGVtIC0gbm93IGFzIEdsb2JhbFN0YXRlIGZvciBmbGV4aWJpbGl0eQogICAgLy8gcHVibGljIHdlZWtseVJld2FyZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUGVyaW9kID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHByZWNpc2lvbiA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byByZWFkIHVzZXIgc3Rha2UgaW5mbyBmcm9tIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBnZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogVXNlclN0YWtlSW5mbyB7CiAgICAvLyAgIGNvbnN0IHVzZXJCb3ggPSB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHVzZXJCb3guZXhpc3RzKSB7CiAgICAvLyAgICAgcmV0dXJuIHVzZXJCb3gudmFsdWUuY29weSgpCiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgcmV0dXJuIG5ldyBVc2VyU3Rha2VJbmZvKHsKICAgIC8vICAgICAgIHN0YWtlZEFtb3VudDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGZpcnN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIHRvdGFsUmV3YXJkc0Vhcm5lZDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIHJld2FyZERlYnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlIGlmIHJld2FyZCBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICovCiAgICAvLyBwcml2YXRlIHVwZGF0ZVJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIGNvbnN0IGN1cnJlbnRUaW1lID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICBjb25zdCBsYXN0UmV3YXJkID0gdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZQogICAgLy8gICBjb25zdCByZXdhcmRQZXJpb2QgPSB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIENoZWNrIGlmIGEgZnVsbCByZXdhcmQgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAgaWYgKGN1cnJlbnRUaW1lID49IGxhc3RSZXdhcmQgKyByZXdhcmRQZXJpb2QgJiYgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA+IDApIHsKICAgIC8vICAgICAvLyBDYWxjdWxhdGUgaG93IG1hbnkgY29tcGxldGUgcGVyaW9kcyBoYXZlIHBhc3NlZAogICAgLy8gICAgIGNvbnN0IHBlcmlvZHNQYXNzZWQ6IHVpbnQ2NCA9IChjdXJyZW50VGltZSAtIGxhc3RSZXdhcmQpIC8gcmV3YXJkUGVyaW9kCiAgICAvLyAKICAgIC8vICAgICAvLyBVcGRhdGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUKICAgIC8vICAgICBjb25zdCByZXdhcmRQZXJQZXJpb2QgPSB0aGlzLndlZWtseVJld2FyZHMudmFsdWUKICAgIC8vICAgICBjb25zdCB0b3RhbFJld2FyZHM6IHVpbnQ2NCA9IHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNQYXNzZWQKICAgIC8vIAogICAgLy8gICAgIC8vIEF2b2lkIG92ZXJmbG93IGJ5IGNhbGN1bGF0aW5nOiAodG90YWxSZXdhcmRzIC8gdG90YWxTdGFrZWQpICogcHJlY2lzaW9uCiAgICAvLyAgICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24udmFsdWUKICAgIC8vICAgICBjb25zdCByZXdhcmRQZXJTaGFyZTogdWludDY0ID0gKHRvdGFsUmV3YXJkcyAqIHByZWNpc2lvbikgLyB0b3RhbFN0YWtlZAogICAgLy8gCiAgICAvLyAgICAgdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSA9IHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgKyByZXdhcmRQZXJTaGFyZQogICAgLy8gCiAgICAvLyAgICAgLy8gVXBkYXRlIGxhc3QgcmV3YXJkIHRpbWUgdG8gdGhlIG1vc3QgcmVjZW50IGNvbXBsZXRlIHBlcmlvZAogICAgLy8gICAgIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBsYXN0UmV3YXJkICsgKHBlcmlvZHNQYXNzZWQgKiByZXdhcmRQZXJpb2QpCiAgICAvLyAKICAgIC8vICAgICAvLyBEZWR1Y3QgcmV3YXJkcyBmcm9tIHBvb2wKICAgIC8vICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSB0b3RhbFJld2FyZHMKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSBwZW5kaW5nIHJld2FyZHMgZm9yIGEgdXNlcgogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICBjb25zdCB1c2VyU3Rha2UgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZQogICAgLy8gICBjb25zdCBhY2NSZXdhcmRzUGVyU2hhcmUgPSB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlCiAgICAvLyAgIGNvbnN0IHVzZXJSZXdhcmREZWJ0ID0gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IHByZWNpc2lvbiA9IHRoaXMucHJlY2lzaW9uLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQXZvaWQgb3ZlcmZsb3c6IGNhbGN1bGF0ZSB0b3RhbCBlYXJuZWQgY2FyZWZ1bGx5CiAgICAvLyAgIGNvbnN0IHRvdGFsRWFybmVkOiB1aW50NjQgPSAodXNlclN0YWtlICogYWNjUmV3YXJkc1BlclNoYXJlKSAvIHByZWNpc2lvbgogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkczogdWludDY0ID0gdG90YWxFYXJuZWQgPiB1c2VyUmV3YXJkRGVidCA/IHRvdGFsRWFybmVkIC0gdXNlclJld2FyZERlYnQgOiAwCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBtaW5pbXVtU3Rha2U6IHVpbnQ2NCwKICAgIC8vICAgd2Vla2x5UmV3YXJkczogdWludDY0LAogICAgLy8gICByZXdhcmRQZXJpb2Q6IHVpbnQ2NCwKICAgIC8vICk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBpcyBvbmx5IGNhbGxlZCBkdXJpbmcgY29udHJhY3QgY3JlYXRpb24KICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgPT09IEFzc2V0KCksICdBbHJlYWR5IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgb25seSB0aGUgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzLCAnT25seSBjcmVhdG9yIGNhbiBpbml0aWFsaXplJykKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB0aGUgaW5pdGlhbCBwYXJhbWV0ZXJzCiAgICAvLyAgIHRoaXMuYXNzZXQudmFsdWUgPSBhc3NldAogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IGFkbWluQWRkcmVzcwogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gMAogICAgLy8gICB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZSA9IG1pbmltdW1TdGFrZQogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gU2V0IHJld2FyZCBzeXN0ZW0gcGFyYW1ldGVycyB3aXRoIGRlZmF1bHRzCiAgICAvLyAgIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZSA9IHdlZWtseVJld2FyZHMKICAgIC8vICAgdGhpcy5yZXdhcmRQZXJpb2QudmFsdWUgPSByZXdhcmRQZXJpb2QKICAgIC8vICAgdGhpcy5wcmVjaXNpb24udmFsdWUgPSAxXzAwMF8wMDAgLy8gUmVkdWNlZCBwcmVjaXNpb24gZnJvbSAxZTEyIHRvIDFlNiB0byBhdm9pZCBvdmVyZmxvdwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIG9wdEluVG9Bc3NldCgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluJykKICAgIC8vIAogICAgLy8gICAvLyBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogU3Rha2UgdG9rZW5zCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAqIEF1dG9tYXRpY2FsbHkgY2xhaW1zIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBzdGFrZSgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoZSBjb250cmFjdCBoYXMgb3B0ZWQgaW50byB0aGUgQVNBCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSAhPT0gQXNzZXQoKSwgJ0NvbnRyYWN0IG5vdCBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgIGFzc2VydChHbG9iYWwuZ3JvdXBTaXplID09PSAyLCAnRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIEFTQSB0cmFuc2ZlciBkZXRhaWxzCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHN0YWtlIG5vbi16ZXJvIGFtb3VudCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBwcm9jZXNzaW5nIHN0YWtlCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBDbGFpbSBwZW5kaW5nIHJld2FyZHMgaWYgdXNlciBoYXMgZXhpc3Rpbmcgc3Rha2UKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCkgewogICAgLy8gICAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICAgIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICAvLyAgICAgICAvLyBBdXRvLWNvbXBvdW5kIHJld2FyZHMgdG8gc3Rha2UKICAgIC8vICAgICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBwZW5kaW5nUmV3YXJkcwogICAgLy8gICAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgICB9CiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGZpcnN0IHN0YWtlIHRpbWUgKHRoaXMgbmV2ZXIgY2hhbmdlcyBhZnRlciBpbml0aWFsIHN0YWtlKQogICAgLy8gICAgIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZSA9IG5ldyBhcmM0LlVpbnRONjQoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgZGVidAogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBnbG9iYWwgc3RhdGUKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBzdGFrZUFtb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFdpdGhkcmF3IHN0YWtlZCB0b2tlbnMKICAgIC8vICAqIEF1dG9tYXRpY2FsbHkgY2xhaW1zIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgcHJvY2Vzc2luZyB3aXRoZHJhd2FsCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHVzZXIgaGFzIGVub3VnaCBzdGFrZWQKICAgIC8vICAgYXNzZXJ0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCwgJ05vIHN0YWtlIGZvdW5kJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA8PSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwgJ1dpdGhkcmF3YWwgYW1vdW50IGV4Y2VlZHMgc3Rha2UnKQogICAgLy8gICBhc3NlcnQoYW1vdW50ID4gMCwgJ1dpdGhkcmF3YWwgYW1vdW50IG11c3QgYmUgcG9zaXRpdmUnKQogICAgLy8gCiAgICAvLyAgIC8vIENsYWltIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgaWYgKHBlbmRpbmdSZXdhcmRzID4gMCAmJiB0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgICAvLyBUcmFuc2ZlciByZXdhcmRzIHRvIHVzZXIKICAgIC8vICAgICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgICBpdHhuCiAgICAvLyAgICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICAgIGFzc2V0QW1vdW50OiBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgICAgfSkKICAgIC8vICAgICAgIC5zdWJtaXQoKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgZGVidAogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBnbG9iYWwgc3RhdGUKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgLSBhbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBUcmFuc2ZlciB0b2tlbnMgYmFjayB0byB1c2VyCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2xhaW0gcGVuZGluZyByZXdhcmRzIHdpdGhvdXQgY2hhbmdpbmcgc3Rha2UKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgY2xhaW1SZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgY2xhaW1pbmcKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgc3Rha2UKICAgIC8vICAgYXNzZXJ0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCwgJ05vIHN0YWtlIGZvdW5kJykKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICBhc3NlcnQocGVuZGluZ1Jld2FyZHMgPiAwLCAnTm8gcGVuZGluZyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcywgJ0luc3VmZmljaWVudCByZXdhcmQgcG9vbCcpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHVzZXIgc3RhdHMKICAgIC8vICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICAvLyBUcmFuc2ZlciByZXdhcmRzIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEFkZCByZXdhcmRzIHRvIHRoZSByZXdhcmQgcG9vbAogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggdGhlIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgYWRkUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggcmV3YXJkcwogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3QgcHJvdmlkZSBub24temVybyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gQWRkIHJld2FyZHMgdG8gdGhlIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSBjdXJyZW50IEFQWSBiYXNlZCBvbiB0b3RhbCBzdGFrZWQgYW1vdW50CiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldEN1cnJlbnRBUFkoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAgLy8gUmV0dXJuIDAgaWYgbm8gdG9rZW5zIHN0YWtlZAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIGFubnVhbCByZXdhcmRzOiA1MiB3ZWVrcyAqIHdlZWtseVJld2FyZHMKICAgIC8vICAgY29uc3QgYW5udWFsUmV3YXJkczogdWludDY0ID0gNTIgKiB0aGlzLndlZWtseVJld2FyZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBBUFkgPSAoYW5udWFsUmV3YXJkcyAvIHRvdGFsU3Rha2VkKSAqIDEwMDAwIChpbiBiYXNpcyBwb2ludHMpCiAgICAvLyAgIGNvbnN0IGFweTogdWludDY0ID0gKGFubnVhbFJld2FyZHMgKiAxMDAwMCkgLyB0b3RhbFN0YWtlZAogICAgLy8gCiAgICAvLyAgIHJldHVybiBhcHkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgcGVuZGluZyByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0UGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICByZXR1cm4gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBUcmlnZ2VyIHJld2FyZCBkaXN0cmlidXRpb24gbWFudWFsbHkgKGFkbWluIG9ubHkpCiAgICAvLyAgKiBVcGRhdGVzIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlIGlmIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHRyaWdnZXJSZXdhcmREaXN0cmlidXRpb24oKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB0cmlnZ2VyIGRpc3RyaWJ1dGlvbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdHJpZ2dlciBkaXN0cmlidXRpb24nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIHRoZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgKiBPbmx5IHRoZSBjdXJyZW50IGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdXBkYXRlQWRtaW4obmV3QWRtaW5BZGRyZXNzOiBBY2NvdW50KTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGFkbWluIGFkZHJlc3MKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBuZXdBZG1pbkFkZHJlc3MKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgY3VycmVudCBzdGFraW5nIHN0YXRpc3RpY3MgZm9yIGEgdXNlcgogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRVc2VyU3RhdHModXNlckFkZHJlc3M6IEFjY291bnQpOiBBcnJheTx1aW50NjQ+IHsKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgY29uc3QgcmVzdWx0OiB1aW50NjRbXSA9IFsKICAgIC8vICAgICBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUsCiAgICAvLyAgIF0KICAgIC8vIAogICAgLy8gICByZXR1cm4gcmVzdWx0CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGNvbnRyYWN0IGdsb2JhbCBzdGF0aXN0aWNzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldENvbnRyYWN0U3RhdHMoKTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IGN1cnJlbnRBUFkgPSB0aGlzLmdldEN1cnJlbnRBUFkoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgdGhpcy5hc3NldC52YWx1ZS5pZCwKICAgIC8vICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlLAogICAgLy8gICAgIGN1cnJlbnRBUFksCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTcKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciAyCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0LTQ4NAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3RSZXdhcmRUaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyAvLyBDb25zdGFudHMgZm9yIGZpeGVkIHJld2FyZCBzeXN0ZW0gLSBub3cgYXMgR2xvYmFsU3RhdGUgZm9yIGZsZXhpYmlsaXR5CiAgICAvLyBwdWJsaWMgd2Vla2x5UmV3YXJkcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyByZXdhcmRQZXJpb2QgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcHJlY2lzaW9uID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gCiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHJlYWQgdXNlciBzdGFrZSBpbmZvIGZyb20gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIC8vICAgY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAodXNlckJveC5leGlzdHMpIHsKICAgIC8vICAgICByZXR1cm4gdXNlckJveC52YWx1ZS5jb3B5KCkKICAgIC8vICAgfSBlbHNlIHsKICAgIC8vICAgICByZXR1cm4gbmV3IFVzZXJTdGFrZUluZm8oewogICAgLy8gICAgICAgc3Rha2VkQW1vdW50OiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgZmlyc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgcmV3YXJkRGVidDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICB9KQogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHN0b3JlIHVzZXIgc3Rha2UgaW5mbyBpbiBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIC8vICAgdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKS52YWx1ZSA9IHN0YWtlSW5mby5jb3B5KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcmV3YXJkIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgdXBkYXRlUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgY29uc3QgY3VycmVudFRpbWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIGNvbnN0IGxhc3RSZXdhcmQgPSB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlcmlvZCA9IHRoaXMucmV3YXJkUGVyaW9kLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQ2hlY2sgaWYgYSBmdWxsIHJld2FyZCBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICBpZiAoY3VycmVudFRpbWUgPj0gbGFzdFJld2FyZCArIHJld2FyZFBlcmlvZCAmJiB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID4gMCkgewogICAgLy8gICAgIC8vIENhbGN1bGF0ZSBob3cgbWFueSBjb21wbGV0ZSBwZXJpb2RzIGhhdmUgcGFzc2VkCiAgICAvLyAgICAgY29uc3QgcGVyaW9kc1Bhc3NlZDogdWludDY0ID0gKGN1cnJlbnRUaW1lIC0gbGFzdFJld2FyZCkgLyByZXdhcmRQZXJpb2QKICAgIC8vIAogICAgLy8gICAgIC8vIFVwZGF0ZSBhY2N1bXVsYXRlZCByZXdhcmRzIHBlciBzaGFyZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gICAgIGNvbnN0IHRvdGFsUmV3YXJkczogdWludDY0ID0gcmV3YXJkUGVyUGVyaW9kICogcGVyaW9kc1Bhc3NlZAogICAgLy8gCiAgICAvLyAgICAgLy8gQXZvaWQgb3ZlcmZsb3cgYnkgY2FsY3VsYXRpbmc6ICh0b3RhbFJld2FyZHMgLyB0b3RhbFN0YWtlZCkgKiBwcmVjaXNpb24KICAgIC8vICAgICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vICAgICBjb25zdCBwcmVjaXNpb24gPSB0aGlzLnByZWNpc2lvbi52YWx1ZQogICAgLy8gICAgIGNvbnN0IHJld2FyZFBlclNoYXJlOiB1aW50NjQgPSAodG90YWxSZXdhcmRzICogcHJlY2lzaW9uKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgICB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlID0gdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSArIHJld2FyZFBlclNoYXJlCiAgICAvLyAKICAgIC8vICAgICAvLyBVcGRhdGUgbGFzdCByZXdhcmQgdGltZSB0byB0aGUgbW9zdCByZWNlbnQgY29tcGxldGUgcGVyaW9kCiAgICAvLyAgICAgdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZSA9IGxhc3RSZXdhcmQgKyAocGVyaW9kc1Bhc3NlZCAqIHJld2FyZFBlcmlvZCkKICAgIC8vIAogICAgLy8gICAgIC8vIERlZHVjdCByZXdhcmRzIGZyb20gcG9vbAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHRvdGFsUmV3YXJkcwogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGFjY1Jld2FyZHNQZXJTaGFyZSA9IHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUKICAgIC8vICAgY29uc3QgdXNlclJld2FyZERlYnQgPSBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUKICAgIC8vICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24udmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBBdm9pZCBvdmVyZmxvdzogY2FsY3VsYXRlIHRvdGFsIGVhcm5lZCBjYXJlZnVsbHkKICAgIC8vICAgY29uc3QgdG90YWxFYXJuZWQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBhY2NSZXdhcmRzUGVyU2hhcmUpIC8gcHJlY2lzaW9uCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzOiB1aW50NjQgPSB0b3RhbEVhcm5lZCA+IHVzZXJSZXdhcmREZWJ0ID8gdG90YWxFYXJuZWQgLSB1c2VyUmV3YXJkRGVidCA6IDAKICAgIC8vIAogICAgLy8gICByZXR1cm4gcGVuZGluZ1Jld2FyZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBJbml0aWFsaXplIHRoZSBjb250cmFjdCB3aXRoIHRoZSBBU0EgdG9rZW4gSUQgYW5kIG90aGVyIHBhcmFtZXRlcnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgaW5pdGlhbGl6ZSgKICAgIC8vICAgYXNzZXQ6IEFzc2V0LAogICAgLy8gICBhZG1pbkFkZHJlc3M6IEFjY291bnQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gICB3ZWVrbHlSZXdhcmRzOiB1aW50NjQsCiAgICAvLyAgIHJld2FyZFBlcmlvZDogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSA9IDAKICAgIC8vIAogICAgLy8gICAvLyBTZXQgcmV3YXJkIHN5c3RlbSBwYXJhbWV0ZXJzIHdpdGggZGVmYXVsdHMKICAgIC8vICAgdGhpcy53ZWVrbHlSZXdhcmRzLnZhbHVlID0gd2Vla2x5UmV3YXJkcwogICAgLy8gICB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZSA9IHJld2FyZFBlcmlvZAogICAgLy8gICB0aGlzLnByZWNpc2lvbi52YWx1ZSA9IDFfMDAwXzAwMCAvLyBSZWR1Y2VkIHByZWNpc2lvbiBmcm9tIDFlMTIgdG8gMWU2IHRvIGF2b2lkIG92ZXJmbG93CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgb3B0SW5Ub0Fzc2V0KCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSB0aGUgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MgfHwgVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogMCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBTdGFrZSB0b2tlbnMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMgYmVmb3JlIHByb2Nlc3Npbmcgc3Rha2UKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHN0YWtlIGFtb3VudCBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgLy8gICBjb25zdCBzdGFrZUFtb3VudCA9IHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgdXNlciBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIENsYWltIHBlbmRpbmcgcmV3YXJkcyBpZiB1c2VyIGhhcyBleGlzdGluZyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgICAgaWYgKHBlbmRpbmdSZXdhcmRzID4gMCAmJiB0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICAgIC8vIEF1dG8tY29tcG91bmQgcmV3YXJkcyB0byBzdGFrZQogICAgLy8gICAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIElmIHRoaXMgaXMgYSBuZXcgc3Rha2UsIGVuc3VyZSBpdCBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICAgIC8vIFNldCB0aGUgZmlyc3Qgc3Rha2UgdGltZSAodGhpcyBuZXZlciBjaGFuZ2VzIGFmdGVyIGluaXRpYWwgc3Rha2UpCiAgICAvLyAgICAgc3Rha2VJbmZvLmZpcnN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICogQXV0b21hdGljYWxseSBjbGFpbXMgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBwcm9jZXNzaW5nIHdpdGhkcmF3YWwKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gQ2xhaW0gcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICBpZiAocGVuZGluZ1Jld2FyZHMgPiAwICYmIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICAgIGl0eG4KICAgIC8vICAgICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgICB9KQogICAgLy8gICAgICAgLnN1Ym1pdCgpCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBJZiB3aXRoZHJhd2luZyBhbGwsIG5vIG5lZWQgdG8gY2hlY2sgbWluaW11bSByZW1haW5pbmcKICAgIC8vICAgLy8gSWYgcGFydGlhbCB3aXRoZHJhd2FsLCBlbnN1cmUgcmVtYWluaW5nIHN0YWtlIG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICAvLyAgICAgY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgICBhc3NlcnQocmVtYWluaW5nU3Rha2UgPj0gbWluaW11bVN0YWtlLCAnUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZCBkZWJ0CiAgICAvLyAgIHN0YWtlSW5mby5yZXdhcmREZWJ0ID0gbmV3IGFyYzQuVWludE42NCgoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKiB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlKSAvIHRoaXMucHJlY2lzaW9uLnZhbHVlKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDbGFpbSBwZW5kaW5nIHJld2FyZHMgd2l0aG91dCBjaGFuZ2luZyBzdGFrZQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBjbGFpbVJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBjbGFpbWluZwogICAgLy8gICB0aGlzLnVwZGF0ZVJld2FyZHMoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBzdGFrZQogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBwZW5kaW5nIHJld2FyZHMKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHNlbmRlckFkZHJlc3MpCiAgICAvLyAgIGFzc2VydChwZW5kaW5nUmV3YXJkcyA+IDAsICdObyBwZW5kaW5nIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQodGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzLCAnSW5zdWZmaWNpZW50IHJld2FyZCBwb29sJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgdXNlciBzdGF0cwogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBwZW5kaW5nUmV3YXJkcwogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHJld2FyZHMgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogcGVuZGluZ1Jld2FyZHMsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQWRkIHJld2FyZHMgdG8gdGhlIHJld2FyZCBwb29sCiAgICAvLyAgKiBPbmx5IHRoZSBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCB0aGUgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBhZGRSZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24gd2l0aCByZXdhcmRzCiAgICAvLyAgIGFzc2VydChHbG9iYWwuZ3JvdXBTaXplID09PSAyLCAnRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIEFTQSB0cmFuc2ZlciBkZXRhaWxzCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBwcm92aWRlIG5vbi16ZXJvIHJld2FyZHMnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBBZGQgcmV3YXJkcyB0byB0aGUgcG9vbAogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgKyB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIGN1cnJlbnQgQVBZIGJhc2VkIG9uIHRvdGFsIHN0YWtlZCBhbW91bnQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudEFQWSgpOiB1aW50NjQgewogICAgLy8gICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vIAogICAgLy8gICBpZiAodG90YWxTdGFrZWQgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMCAvLyBSZXR1cm4gMCBpZiBubyB0b2tlbnMgc3Rha2VkCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgYW5udWFsIHJld2FyZHM6IDUyIHdlZWtzICogd2Vla2x5UmV3YXJkcwogICAgLy8gICBjb25zdCBhbm51YWxSZXdhcmRzOiB1aW50NjQgPSA1MiAqIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIEFQWSA9IChhbm51YWxSZXdhcmRzIC8gdG90YWxTdGFrZWQpICogMTAwMDAgKGluIGJhc2lzIHBvaW50cykKICAgIC8vICAgY29uc3QgYXB5OiB1aW50NjQgPSAoYW5udWFsUmV3YXJkcyAqIDEwMDAwKSAvIHRvdGFsU3Rha2VkCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIGFweQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBwZW5kaW5nIHJld2FyZHMgZm9yIGEgc3BlY2lmaWMgdXNlcgogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIHJldHVybiB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFRyaWdnZXIgcmV3YXJkIGRpc3RyaWJ1dGlvbiBtYW51YWxseSAoYWRtaW4gb25seSkKICAgIC8vICAqIFVwZGF0ZXMgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUgaWYgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdHJpZ2dlclJld2FyZERpc3RyaWJ1dGlvbigpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHRyaWdnZXIgZGlzdHJpYnV0aW9uCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB0cmlnZ2VyIGRpc3RyaWJ1dGlvbicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHJld2FyZHMKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gICAgIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHN0YWtlSW5mby5yZXdhcmREZWJ0Lm5hdGl2ZSwKICAgIC8vICAgXQogICAgLy8gCiAgICAvLyAgIHJldHVybiByZXN1bHQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgY29udHJhY3QgZ2xvYmFsIHN0YXRpc3RpY3MKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0Q29udHJhY3RTdGF0cygpOiBBcnJheTx1aW50NjQ+IHsKICAgIC8vICAgY29uc3QgY3VycmVudEFQWSA9IHRoaXMuZ2V0Q3VycmVudEFQWSgpCiAgICAvLyAKICAgIC8vICAgY29uc3QgcmVzdWx0OiB1aW50NjRbXSA9IFsKICAgIC8vICAgICB0aGlzLmFzc2V0LnZhbHVlLmlkLAogICAgLy8gICAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUsCiAgICAvLyAgICAgY3VycmVudEFQWSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1OAogICAgLy8gcHVibGljIGFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgc3dhcAogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NC00ODQKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBsYXN0UmV3YXJkVGltZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBhY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gLy8gQ29uc3RhbnRzIGZvciBmaXhlZCByZXdhcmQgc3lzdGVtIC0gbm93IGFzIEdsb2JhbFN0YXRlIGZvciBmbGV4aWJpbGl0eQogICAgLy8gcHVibGljIHdlZWtseVJld2FyZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUGVyaW9kID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHByZWNpc2lvbiA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byByZWFkIHVzZXIgc3Rha2UgaW5mbyBmcm9tIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBnZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogVXNlclN0YWtlSW5mbyB7CiAgICAvLyAgIGNvbnN0IHVzZXJCb3ggPSB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHVzZXJCb3guZXhpc3RzKSB7CiAgICAvLyAgICAgcmV0dXJuIHVzZXJCb3gudmFsdWUuY29weSgpCiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgcmV0dXJuIG5ldyBVc2VyU3Rha2VJbmZvKHsKICAgIC8vICAgICAgIHN0YWtlZEFtb3VudDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGZpcnN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIHRvdGFsUmV3YXJkc0Vhcm5lZDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIHJld2FyZERlYnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlIGlmIHJld2FyZCBwZXJpb2QgaGFzIHBhc3NlZAogICAgLy8gICovCiAgICAvLyBwcml2YXRlIHVwZGF0ZVJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIGNvbnN0IGN1cnJlbnRUaW1lID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICBjb25zdCBsYXN0UmV3YXJkID0gdGhpcy5sYXN0UmV3YXJkVGltZS52YWx1ZQogICAgLy8gICBjb25zdCByZXdhcmRQZXJpb2QgPSB0aGlzLnJld2FyZFBlcmlvZC52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIENoZWNrIGlmIGEgZnVsbCByZXdhcmQgcGVyaW9kIGhhcyBwYXNzZWQKICAgIC8vICAgaWYgKGN1cnJlbnRUaW1lID49IGxhc3RSZXdhcmQgKyByZXdhcmRQZXJpb2QgJiYgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA+IDApIHsKICAgIC8vICAgICAvLyBDYWxjdWxhdGUgaG93IG1hbnkgY29tcGxldGUgcGVyaW9kcyBoYXZlIHBhc3NlZAogICAgLy8gICAgIGNvbnN0IHBlcmlvZHNQYXNzZWQ6IHVpbnQ2NCA9IChjdXJyZW50VGltZSAtIGxhc3RSZXdhcmQpIC8gcmV3YXJkUGVyaW9kCiAgICAvLyAKICAgIC8vICAgICAvLyBVcGRhdGUgYWNjdW11bGF0ZWQgcmV3YXJkcyBwZXIgc2hhcmUKICAgIC8vICAgICBjb25zdCByZXdhcmRQZXJQZXJpb2QgPSB0aGlzLndlZWtseVJld2FyZHMudmFsdWUKICAgIC8vICAgICBjb25zdCB0b3RhbFJld2FyZHM6IHVpbnQ2NCA9IHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNQYXNzZWQKICAgIC8vIAogICAgLy8gICAgIC8vIEF2b2lkIG92ZXJmbG93IGJ5IGNhbGN1bGF0aW5nOiAodG90YWxSZXdhcmRzIC8gdG90YWxTdGFrZWQpICogcHJlY2lzaW9uCiAgICAvLyAgICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgICAgY29uc3QgcHJlY2lzaW9uID0gdGhpcy5wcmVjaXNpb24udmFsdWUKICAgIC8vICAgICBjb25zdCByZXdhcmRQZXJTaGFyZTogdWludDY0ID0gKHRvdGFsUmV3YXJkcyAqIHByZWNpc2lvbikgLyB0b3RhbFN0YWtlZAogICAgLy8gCiAgICAvLyAgICAgdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSA9IHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgKyByZXdhcmRQZXJTaGFyZQogICAgLy8gCiAgICAvLyAgICAgLy8gVXBkYXRlIGxhc3QgcmV3YXJkIHRpbWUgdG8gdGhlIG1vc3QgcmVjZW50IGNvbXBsZXRlIHBlcmlvZAogICAgLy8gICAgIHRoaXMubGFzdFJld2FyZFRpbWUudmFsdWUgPSBsYXN0UmV3YXJkICsgKHBlcmlvZHNQYXNzZWQgKiByZXdhcmRQZXJpb2QpCiAgICAvLyAKICAgIC8vICAgICAvLyBEZWR1Y3QgcmV3YXJkcyBmcm9tIHBvb2wKICAgIC8vICAgICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSB0b3RhbFJld2FyZHMKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSBwZW5kaW5nIHJld2FyZHMgZm9yIGEgdXNlcgogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICBjb25zdCB1c2VyU3Rha2UgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZQogICAgLy8gICBjb25zdCBhY2NSZXdhcmRzUGVyU2hhcmUgPSB0aGlzLmFjY3VtdWxhdGVkUmV3YXJkc1BlclNoYXJlLnZhbHVlCiAgICAvLyAgIGNvbnN0IHVzZXJSZXdhcmREZWJ0ID0gc3Rha2VJbmZvLnJld2FyZERlYnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IHByZWNpc2lvbiA9IHRoaXMucHJlY2lzaW9uLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gQXZvaWQgb3ZlcmZsb3c6IGNhbGN1bGF0ZSB0b3RhbCBlYXJuZWQgY2FyZWZ1bGx5CiAgICAvLyAgIGNvbnN0IHRvdGFsRWFybmVkOiB1aW50NjQgPSAodXNlclN0YWtlICogYWNjUmV3YXJkc1BlclNoYXJlKSAvIHByZWNpc2lvbgogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkczogdWludDY0ID0gdG90YWxFYXJuZWQgPiB1c2VyUmV3YXJkRGVidCA/IHRvdGFsRWFybmVkIC0gdXNlclJld2FyZERlYnQgOiAwCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBtaW5pbXVtU3Rha2U6IHVpbnQ2NCwKICAgIC8vICAgd2Vla2x5UmV3YXJkczogdWludDY0LAogICAgLy8gICByZXdhcmRQZXJpb2Q6IHVpbnQ2NCwKICAgIC8vICk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBpcyBvbmx5IGNhbGxlZCBkdXJpbmcgY29udHJhY3QgY3JlYXRpb24KICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgPT09IEFzc2V0KCksICdBbHJlYWR5IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgb25seSB0aGUgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzLCAnT25seSBjcmVhdG9yIGNhbiBpbml0aWFsaXplJykKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB0aGUgaW5pdGlhbCBwYXJhbWV0ZXJzCiAgICAvLyAgIHRoaXMuYXNzZXQudmFsdWUgPSBhc3NldAogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IGFkbWluQWRkcmVzcwogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gMAogICAgLy8gICB0aGlzLmxhc3RSZXdhcmRUaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZSA9IG1pbmltdW1TdGFrZQogICAgLy8gICB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gU2V0IHJld2FyZCBzeXN0ZW0gcGFyYW1ldGVycyB3aXRoIGRlZmF1bHRzCiAgICAvLyAgIHRoaXMud2Vla2x5UmV3YXJkcy52YWx1ZSA9IHdlZWtseVJld2FyZHMKICAgIC8vICAgdGhpcy5yZXdhcmRQZXJpb2QudmFsdWUgPSByZXdhcmRQZXJpb2QKICAgIC8vICAgdGhpcy5wcmVjaXNpb24udmFsdWUgPSAxXzAwMF8wMDAgLy8gUmVkdWNlZCBwcmVjaXNpb24gZnJvbSAxZTEyIHRvIDFlNiB0byBhdm9pZCBvdmVyZmxvdwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIG9wdEluVG9Bc3NldCgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluJykKICAgIC8vIAogICAgLy8gICAvLyBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogU3Rha2UgdG9rZW5zCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAqIEF1dG9tYXRpY2FsbHkgY2xhaW1zIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBzdGFrZSgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoZSBjb250cmFjdCBoYXMgb3B0ZWQgaW50byB0aGUgQVNBCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSAhPT0gQXNzZXQoKSwgJ0NvbnRyYWN0IG5vdCBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgIGFzc2VydChHbG9iYWwuZ3JvdXBTaXplID09PSAyLCAnRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIEFTQSB0cmFuc2ZlciBkZXRhaWxzCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHN0YWtlIG5vbi16ZXJvIGFtb3VudCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzIGJlZm9yZSBwcm9jZXNzaW5nIHN0YWtlCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBDbGFpbSBwZW5kaW5nIHJld2FyZHMgaWYgdXNlciBoYXMgZXhpc3Rpbmcgc3Rha2UKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCkgewogICAgLy8gICAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICAgIGlmIChwZW5kaW5nUmV3YXJkcyA+IDAgJiYgdGhpcy5yZXdhcmRQb29sLnZhbHVlID49IHBlbmRpbmdSZXdhcmRzKSB7CiAgICAvLyAgICAgICAvLyBBdXRvLWNvbXBvdW5kIHJld2FyZHMgdG8gc3Rha2UKICAgIC8vICAgICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAgICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBwZW5kaW5nUmV3YXJkcwogICAgLy8gICAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgICB9CiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGZpcnN0IHN0YWtlIHRpbWUgKHRoaXMgbmV2ZXIgY2hhbmdlcyBhZnRlciBpbml0aWFsIHN0YWtlKQogICAgLy8gICAgIHN0YWtlSW5mby5maXJzdFN0YWtlVGltZSA9IG5ldyBhcmM0LlVpbnRONjQoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgZGVidAogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBnbG9iYWwgc3RhdGUKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBzdGFrZUFtb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFdpdGhkcmF3IHN0YWtlZCB0b2tlbnMKICAgIC8vICAqIEF1dG9tYXRpY2FsbHkgY2xhaW1zIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgcHJvY2Vzc2luZyB3aXRoZHJhd2FsCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyAKICAgIC8vICAgY29uc3Qgc2VuZGVyQWRkcmVzcyA9IFR4bi5zZW5kZXIKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHVzZXIgaGFzIGVub3VnaCBzdGFrZWQKICAgIC8vICAgYXNzZXJ0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCwgJ05vIHN0YWtlIGZvdW5kJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA8PSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwgJ1dpdGhkcmF3YWwgYW1vdW50IGV4Y2VlZHMgc3Rha2UnKQogICAgLy8gICBhc3NlcnQoYW1vdW50ID4gMCwgJ1dpdGhkcmF3YWwgYW1vdW50IG11c3QgYmUgcG9zaXRpdmUnKQogICAgLy8gCiAgICAvLyAgIC8vIENsYWltIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoc2VuZGVyQWRkcmVzcykKICAgIC8vICAgaWYgKHBlbmRpbmdSZXdhcmRzID4gMCAmJiB0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgICAvLyBUcmFuc2ZlciByZXdhcmRzIHRvIHVzZXIKICAgIC8vICAgICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgICBpdHhuCiAgICAvLyAgICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICAgIGFzc2V0UmVjZWl2ZXI6IHNlbmRlckFkZHJlc3MsCiAgICAvLyAgICAgICAgIGFzc2V0QW1vdW50OiBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgICAgfSkKICAgIC8vICAgICAgIC5zdWJtaXQoKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmQgZGVidAogICAgLy8gICBzdGFrZUluZm8ucmV3YXJkRGVidCA9IG5ldyBhcmM0LlVpbnRONjQoKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICogdGhpcy5hY2N1bXVsYXRlZFJld2FyZHNQZXJTaGFyZS52YWx1ZSkgLyB0aGlzLnByZWNpc2lvbi52YWx1ZSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBnbG9iYWwgc3RhdGUKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgLSBhbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBUcmFuc2ZlciB0b2tlbnMgYmFjayB0byB1c2VyCiAgICAvLyAgIGNvbnN0IGFzc2V0ID0gdGhpcy5hc3NldC52YWx1ZQogICAgLy8gICBpdHhuCiAgICAvLyAgICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgICAgYXNzZXRSZWNlaXZlcjogc2VuZGVyQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgICAgZmVlOiAxMDAwLAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2xhaW0gcGVuZGluZyByZXdhcmRzIHdpdGhvdXQgY2hhbmdpbmcgc3Rha2UKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgY2xhaW1SZXdhcmRzKCk6IHZvaWQgewogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkcyBiZWZvcmUgY2xhaW1pbmcKICAgIC8vICAgdGhpcy51cGRhdGVSZXdhcmRzKCkKICAgIC8vIAogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgc3Rha2UKICAgIC8vICAgYXNzZXJ0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID4gMCwgJ05vIHN0YWtlIGZvdW5kJykKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyhzZW5kZXJBZGRyZXNzKQogICAgLy8gICBhc3NlcnQocGVuZGluZ1Jld2FyZHMgPiAwLCAnTm8gcGVuZGluZyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHRoaXMucmV3YXJkUG9vbC52YWx1ZSA+PSBwZW5kaW5nUmV3YXJkcywgJ0luc3VmZmljaWVudCByZXdhcmQgcG9vbCcpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHVzZXIgc3RhdHMKICAgIC8vICAgc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIC8vICAgc3Rha2VJbmZvLnJld2FyZERlYnQgPSBuZXcgYXJjNC5VaW50TjY0KChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAqIHRoaXMuYWNjdW11bGF0ZWRSZXdhcmRzUGVyU2hhcmUudmFsdWUpIC8gdGhpcy5wcmVjaXNpb24udmFsdWUpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgcmV3YXJkIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICAvLyBUcmFuc2ZlciByZXdhcmRzIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBzZW5kZXJBZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEFkZCByZXdhcmRzIHRvIHRoZSByZXdhcmQgcG9vbAogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggdGhlIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgYWRkUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggcmV3YXJkcwogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3QgcHJvdmlkZSBub24temVybyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gQWRkIHJld2FyZHMgdG8gdGhlIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSBjdXJyZW50IEFQWSBiYXNlZCBvbiB0b3RhbCBzdGFrZWQgYW1vdW50CiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldEN1cnJlbnRBUFkoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAgLy8gUmV0dXJuIDAgaWYgbm8gdG9rZW5zIHN0YWtlZAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIGFubnVhbCByZXdhcmRzOiA1MiB3ZWVrcyAqIHdlZWtseVJld2FyZHMKICAgIC8vICAgY29uc3QgYW5udWFsUmV3YXJkczogdWludDY0ID0gNTIgKiB0aGlzLndlZWtseVJld2FyZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBBUFkgPSAoYW5udWFsUmV3YXJkcyAvIHRvdGFsU3Rha2VkKSAqIDEwMDAwIChpbiBiYXNpcyBwb2ludHMpCiAgICAvLyAgIGNvbnN0IGFweTogdWludDY0ID0gKGFubnVhbFJld2FyZHMgKiAxMDAwMCkgLyB0b3RhbFN0YWtlZAogICAgLy8gCiAgICAvLyAgIHJldHVybiBhcHkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgcGVuZGluZyByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0UGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICByZXR1cm4gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBUcmlnZ2VyIHJld2FyZCBkaXN0cmlidXRpb24gbWFudWFsbHkgKGFkbWluIG9ubHkpCiAgICAvLyAgKiBVcGRhdGVzIGFjY3VtdWxhdGVkIHJld2FyZHMgcGVyIHNoYXJlIGlmIHBlcmlvZCBoYXMgcGFzc2VkCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHRyaWdnZXJSZXdhcmREaXN0cmlidXRpb24oKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB0cmlnZ2VyIGRpc3RyaWJ1dGlvbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdHJpZ2dlciBkaXN0cmlidXRpb24nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSByZXdhcmRzCiAgICAvLyAgIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIHRoZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgKiBPbmx5IHRoZSBjdXJyZW50IGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdXBkYXRlQWRtaW4obmV3QWRtaW5BZGRyZXNzOiBBY2NvdW50KTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGFkbWluIGFkZHJlc3MKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBuZXdBZG1pbkFkZHJlc3MKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgY3VycmVudCBzdGFraW5nIHN0YXRpc3RpY3MgZm9yIGEgdXNlcgogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRVc2VyU3RhdHModXNlckFkZHJlc3M6IEFjY291bnQpOiBBcnJheTx1aW50NjQ+IHsKICAgIC8vICAgY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgY29uc3QgcmVzdWx0OiB1aW50NjRbXSA9IFsKICAgIC8vICAgICBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8uZmlyc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ucmV3YXJkRGVidC5uYXRpdmUsCiAgICAvLyAgIF0KICAgIC8vIAogICAgLy8gICByZXR1cm4gcmVzdWx0CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGNvbnRyYWN0IGdsb2JhbCBzdGF0aXN0aWNzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldENvbnRyYWN0U3RhdHMoKTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IGN1cnJlbnRBUFkgPSB0aGlzLmdldEN1cnJlbnRBUFkoKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgdGhpcy5hc3NldC52YWx1ZS5pZCwKICAgIC8vICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlLAogICAgLy8gICAgIGN1cnJlbnRBUFksCiAgICBjb25jYXQKICAgIGR1cAogICAgbGVuCiAgICBwdXNoaW50IDggLy8gOAogICAgLwogICAgaXRvYgogICAgZXh0cmFjdCA2IDIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OTIKICAgIC8vIHJldHVybiByZXN1bHQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5lbWVyZ2VuY3lXaXRoZHJhd1Jld2FyZHMoYW1vdW50OiB1aW50NjQpIC0+IHZvaWQ6CmVtZXJnZW5jeVdpdGhkcmF3UmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDk4LTQ5OQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzKGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICBwcm90byAxIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTMKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18zIC8vICJhZG1pbkFkZHJlc3MiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MDIKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBlbWVyZ2VuY3kgd2l0aGRyYXcnKQogICAgdHhuIFNlbmRlcgogICAgZGlnIDEKICAgID09CiAgICBhc3NlcnQgLy8gT25seSBhZG1pbiBjYW4gZW1lcmdlbmN5IHdpdGhkcmF3CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTA1CiAgICAvLyBhc3NlcnQodGhpcy5yZXdhcmRQb29sLnZhbHVlID49IGFtb3VudCwgJ0luc3VmZmljaWVudCByZXdhcmQgcG9vbCcpCiAgICBmcmFtZV9kaWcgLTEKICAgID49CiAgICBhc3NlcnQgLy8gSW5zdWZmaWNpZW50IHJld2FyZCBwb29sCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTA4CiAgICAvLyB0aGlzLnJld2FyZFBvb2wudmFsdWUgPSB0aGlzLnJld2FyZFBvb2wudmFsdWUgLSBhbW91bnQKICAgIGZyYW1lX2RpZyAtMQogICAgLQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MDgKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIGFtb3VudAogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTIKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTEyLTUxOQogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogYWRtaW5BZGRyLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9iZWdpbgogICAgaXR4bl9maWVsZCBYZmVyQXNzZXQKICAgIGZyYW1lX2RpZyAtMQogICAgaXR4bl9maWVsZCBBc3NldEFtb3VudAogICAgaXR4bl9maWVsZCBBc3NldFJlY2VpdmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUxMi01MTgKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IGFkbWluQWRkciwKICAgIC8vICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgZmVlOiAxMDAwLAogICAgLy8gICB9KQogICAgaW50Y18yIC8vIDQKICAgIGl0eG5fZmllbGQgVHlwZUVudW0KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTE3CiAgICAvLyBmZWU6IDEwMDAsCiAgICBpbnRjIDQgLy8gMTAwMAogICAgaXR4bl9maWVsZCBGZWUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTEyLTUxOQogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogYWRtaW5BZGRyLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5kZWxldGVVc2VyQm94KHVzZXJBZGRyZXNzOiBieXRlcykgLT4gdm9pZDoKZGVsZXRlVXNlckJveDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTI2LTUyNwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgZGVsZXRlVXNlckJveCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgcHJvdG8gMSAwCiAgICBpbnRjXzAgLy8gMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgZHVwCiAgICBieXRlY18zIC8vICJhZG1pbkFkZHJlc3MiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MzIKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBib3hPd25lciB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGJveCBvd25lciBvciBhZG1pbiBjYW4gZGVsZXRlIGJveCcpCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgLTEKICAgID09CiAgICBibnogZGVsZXRlVXNlckJveF9ib29sX3RydWVAMgogICAgdHhuIFNlbmRlcgogICAgZnJhbWVfZGlnIDEKICAgID09CiAgICBieiBkZWxldGVVc2VyQm94X2Jvb2xfZmFsc2VAMwoKZGVsZXRlVXNlckJveF9ib29sX3RydWVAMjoKICAgIGludGNfMSAvLyAxCgpkZWxldGVVc2VyQm94X2Jvb2xfbWVyZ2VANDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTMyCiAgICAvLyBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYm94T3duZXIgfHwgVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBib3ggb3duZXIgb3IgYWRtaW4gY2FuIGRlbGV0ZSBib3gnKQogICAgYXNzZXJ0IC8vIE9ubHkgYm94IG93bmVyIG9yIGFkbWluIGNhbiBkZWxldGUgYm94CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzNQogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTM2CiAgICAvLyBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDAsICdVc2VyIHN0aWxsIGhhcyBhY3RpdmUgc3Rha2UnKQogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICAhCiAgICBhc3NlcnQgLy8gVXNlciBzdGlsbCBoYXMgYWN0aXZlIHN0YWtlCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjY1CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBieXRlYyAxMSAvLyAic3Rha2VycyIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTM5CiAgICAvLyBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjY1CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTM5CiAgICAvLyBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQwCiAgICAvLyBpZiAodXNlckJveC5leGlzdHMpIHsKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgYnogZGVsZXRlVXNlckJveF9hZnRlcl9pZl9lbHNlQDYKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQxCiAgICAvLyB1c2VyQm94LmRlbGV0ZSgpCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2RlbAogICAgcG9wCgpkZWxldGVVc2VyQm94X2FmdGVyX2lmX2Vsc2VANjoKICAgIHJldHN1YgoKZGVsZXRlVXNlckJveF9ib29sX2ZhbHNlQDM6CiAgICBpbnRjXzAgLy8gMAogICAgYiBkZWxldGVVc2VyQm94X2Jvb2xfbWVyZ2VANAoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC51cGRhdGVXZWVrbHlSZXdhcmRzKG5ld1dlZWtseVJld2FyZHM6IHVpbnQ2NCkgLT4gdm9pZDoKdXBkYXRlV2Vla2x5UmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQ4LTU0OQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdXBkYXRlV2Vla2x5UmV3YXJkcyhuZXdXZWVrbHlSZXdhcmRzOiB1aW50NjQpOiB2b2lkIHsKICAgIHByb3RvIDEgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzMgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU1MgogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHVwZGF0ZSB3ZWVrbHkgcmV3YXJkcycpCiAgICB0eG4gU2VuZGVyCiAgICA9PQogICAgYXNzZXJ0IC8vIE9ubHkgYWRtaW4gY2FuIHVwZGF0ZSB3ZWVrbHkgcmV3YXJkcwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NTUKICAgIC8vIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICBjYWxsc3ViIHVwZGF0ZVJld2FyZHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NjEKICAgIC8vIHB1YmxpYyB3ZWVrbHlSZXdhcmRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgOCAvLyAid2Vla2x5UmV3YXJkcyIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTU4CiAgICAvLyB0aGlzLndlZWtseVJld2FyZHMudmFsdWUgPSBuZXdXZWVrbHlSZXdhcmRzCiAgICBmcmFtZV9kaWcgLTEKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QudXBkYXRlUmV3YXJkUGVyaW9kKG5ld1Jld2FyZFBlcmlvZDogdWludDY0KSAtPiB2b2lkOgp1cGRhdGVSZXdhcmRQZXJpb2Q6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU2NC01NjUKICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZVJld2FyZFBlcmlvZChuZXdSZXdhcmRQZXJpb2Q6IHVpbnQ2NCk6IHZvaWQgewogICAgcHJvdG8gMSAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMyAvLyAiYWRtaW5BZGRyZXNzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTY4CiAgICAvLyBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIHJld2FyZCBwZXJpb2QnKQogICAgdHhuIFNlbmRlcgogICAgPT0KICAgIGFzc2VydCAvLyBPbmx5IGFkbWluIGNhbiB1cGRhdGUgcmV3YXJkIHBlcmlvZAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NzEKICAgIC8vIHRoaXMudXBkYXRlUmV3YXJkcygpCiAgICBjYWxsc3ViIHVwZGF0ZVJld2FyZHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NjIKICAgIC8vIHB1YmxpYyByZXdhcmRQZXJpb2QgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA5IC8vICJyZXdhcmRQZXJpb2QiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3NAogICAgLy8gdGhpcy5yZXdhcmRQZXJpb2QudmFsdWUgPSBuZXdSZXdhcmRQZXJpb2QKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1Ygo=",
        "clear": "I3ByYWdtYSB2ZXJzaW9uIDEwCiNwcmFnbWEgdHlwZXRyYWNrIGZhbHNlCgovLyBAYWxnb3JhbmRmb3VuZGF0aW9uL2FsZ29yYW5kLXR5cGVzY3JpcHQvYmFzZS1jb250cmFjdC5kLnRzOjpCYXNlQ29udHJhY3QuY2xlYXJTdGF0ZVByb2dyYW0oKSAtPiB1aW50NjQ6Cm1haW46CiAgICBwdXNoaW50IDEgLy8gMQogICAgcmV0dXJuCg=="
    },
    "state": {
        "global": {
            "num_byte_slices": 8,
            "num_uints": 9
        },
        "local": {
            "num_byte_slices": 0,
            "num_uints": 0
        }
    },
    "schema": {
        "global": {
            "declared": {
                "accumulatedRewardsPerShare": {
                    "type": "uint64",
                    "key": "accumulatedRewardsPerShare"
                },
                "adminAddress": {
                    "type": "bytes",
                    "key": "adminAddress"
                },
                "asset": {
                    "type": "uint64",
                    "key": "asset"
                },
                "lastRewardTime": {
                    "type": "uint64",
                    "key": "lastRewardTime"
                },
                "minimumStake": {
                    "type": "uint64",
                    "key": "minimumStake"
                },
                "precision": {
                    "type": "uint64",
                    "key": "precision"
                },
                "rewardPeriod": {
                    "type": "uint64",
                    "key": "rewardPeriod"
                },
                "rewardPool": {
                    "type": "uint64",
                    "key": "rewardPool"
                },
                "totalStaked": {
                    "type": "uint64",
                    "key": "totalStaked"
                },
                "weeklyRewards": {
                    "type": "uint64",
                    "key": "weeklyRewards"
                }
            },
            "reserved": {}
        },
        "local": {
            "declared": {},
            "reserved": {}
        }
    },
    "contract": {
        "name": "ASAStakingContract",
        "desc": "ASA Staking Contract for Algorand with Fixed Weekly Reward Pool\n\nThis contract allows users to:\n- Stake an ASA token\n- Earn proportional rewards from a fixed weekly pool of 100,000 tokens\n- Add to their stake at any time\n- Withdraw part or all of their stake at any time\n- Claim rewards at any time\n- Dynamic APY that adjusts based on total staked amount\n\nThis implementation uses box storage to store user staking information\nand an accumulator pattern for gas-efficient reward distribution",
        "methods": [
            {
                "name": "getUserStakeInfo",
                "args": [
                    {
                        "type": "account",
                        "name": "userAddress"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "(uint64,uint64,uint64,uint64,uint64)"
                },
                "desc": "Helper function to read user stake info from box storage"
            },
            {
                "name": "storeUserStakeInfo",
                "args": [
                    {
                        "type": "account",
                        "name": "userAddress"
                    },
                    {
                        "type": "(uint64,uint64,uint64,uint64,uint64)",
                        "name": "stakeInfo"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Helper function to store user stake info in box storage"
            },
            {
                "name": "initialize",
                "args": [
                    {
                        "type": "asset",
                        "name": "asset"
                    },
                    {
                        "type": "account",
                        "name": "adminAddress"
                    },
                    {
                        "type": "uint64",
                        "name": "minimumStake"
                    },
                    {
                        "type": "uint64",
                        "name": "weeklyRewards"
                    },
                    {
                        "type": "uint64",
                        "name": "rewardPeriod"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Initialize the contract with the ASA token ID and other parameters"
            },
            {
                "name": "optInToAsset",
                "args": [],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Opt the contract into the ASA"
            },
            {
                "name": "stake",
                "args": [],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Stake tokens\nRequires a companion ASA transfer transaction\nAutomatically claims pending rewards"
            },
            {
                "name": "withdraw",
                "args": [
                    {
                        "type": "uint64",
                        "name": "amount"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Withdraw staked tokens\nAutomatically claims pending rewards"
            },
            {
                "name": "claimRewards",
                "args": [],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Claim pending rewards without changing stake"
            },
            {
                "name": "addRewards",
                "args": [],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Add rewards to the reward pool\nOnly the admin can call this\nRequires a companion ASA transfer transaction with the rewards"
            },
            {
                "name": "getCurrentAPY",
                "args": [],
                "readonly": true,
                "returns": {
                    "type": "uint64"
                },
                "desc": "Calculate current APY based on total staked amount"
            },
            {
                "name": "getPendingRewards",
                "args": [
                    {
                        "type": "account",
                        "name": "userAddress"
                    }
                ],
                "readonly": true,
                "returns": {
                    "type": "uint64"
                },
                "desc": "Get pending rewards for a specific user"
            },
            {
                "name": "triggerRewardDistribution",
                "args": [],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Trigger reward distribution manually (admin only)\nUpdates accumulated rewards per share if period has passed"
            },
            {
                "name": "updateAdmin",
                "args": [
                    {
                        "type": "account",
                        "name": "newAdminAddress"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Update the admin address\nOnly the current admin can call this"
            },
            {
                "name": "getUserStats",
                "args": [
                    {
                        "type": "account",
                        "name": "userAddress"
                    }
                ],
                "readonly": true,
                "returns": {
                    "type": "uint64[]"
                },
                "desc": "Get current staking statistics for a user"
            },
            {
                "name": "getContractStats",
                "args": [],
                "readonly": true,
                "returns": {
                    "type": "uint64[]"
                },
                "desc": "Get contract global statistics"
            },
            {
                "name": "emergencyWithdrawRewards",
                "args": [
                    {
                        "type": "uint64",
                        "name": "amount"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Emergency withdraw rewards from pool (admin only)"
            },
            {
                "name": "deleteUserBox",
                "args": [
                    {
                        "type": "account",
                        "name": "userAddress"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Delete a user's box (for cleanup)\nCan only be called by the box owner or admin"
            },
            {
                "name": "updateWeeklyRewards",
                "args": [
                    {
                        "type": "uint64",
                        "name": "newWeeklyRewards"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Update weekly rewards amount (admin only)"
            },
            {
                "name": "updateRewardPeriod",
                "args": [
                    {
                        "type": "uint64",
                        "name": "newRewardPeriod"
                    }
                ],
                "readonly": false,
                "returns": {
                    "type": "void"
                },
                "desc": "Update reward period (admin only)"
            }
        ],
        "networks": {}
    },
    "bare_call_config": {
        "no_op": "CREATE"
    }
}