{
    "name": "ASAStakingContract",
    "structs": {
        "UserStakeInfo": [
            {
                "name": "stakedAmount",
                "type": "uint64"
            },
            {
                "name": "lastStakeTime",
                "type": "uint64"
            },
            {
                "name": "totalRewardsEarned",
                "type": "uint64"
            },
            {
                "name": "lastClaimedPeriod",
                "type": "uint64"
            }
        ]
    },
    "methods": [
        {
            "name": "getUserStakeInfo",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                }
            ],
            "returns": {
                "type": "(uint64,uint64,uint64,uint64)",
                "struct": "UserStakeInfo"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Helper function to read user stake info from box storage",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "storeUserStakeInfo",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                },
                {
                    "type": "(uint64,uint64,uint64,uint64)",
                    "struct": "UserStakeInfo",
                    "name": "stakeInfo"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Helper function to store user stake info in box storage",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "getCurrentPeriod",
            "args": [],
            "returns": {
                "type": "uint64"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Calculate the current distribution period",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "initialize",
            "args": [
                {
                    "type": "asset",
                    "name": "asset"
                },
                {
                    "type": "account",
                    "name": "adminAddress"
                },
                {
                    "type": "uint64",
                    "name": "aprBasisPoints"
                },
                {
                    "type": "uint64",
                    "name": "distributionPeriodSeconds"
                },
                {
                    "type": "uint64",
                    "name": "minimumStake"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Initialize the contract with the ASA token ID and other parameters",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "optInToAsset",
            "args": [],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Opt the contract into the ASA",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "stake",
            "args": [],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Stake tokens\nRequires a companion ASA transfer transaction",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "withdraw",
            "args": [
                {
                    "type": "uint64",
                    "name": "amount"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Withdraw staked tokens",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "addRewards",
            "args": [],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Add rewards to the reward pool\nOnly the admin can call this\nRequires a companion ASA transfer transaction with the rewards",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "calculateUserRewardsForPeriod",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                }
            ],
            "returns": {
                "type": "uint64"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": true,
            "desc": "Calculate rewards for a specific user for a given period\nThis calculates rewards per distribution period",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "calculatePendingRewards",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                }
            ],
            "returns": {
                "type": "uint64"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": true,
            "desc": "Calculate pending rewards for a user since their last claim",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "distributeRewards",
            "args": [
                {
                    "type": "address[]",
                    "name": "stakerAddresses"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Distribute and compound rewards for multiple stakers\nThis method is designed to be called by a cron job on a daily basis\nOnly admin can call this method",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "getActiveStakersCount",
            "args": [
                {
                    "type": "address[]",
                    "name": "stakerAddresses"
                }
            ],
            "returns": {
                "type": "uint64"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": true,
            "desc": "Get all non-zero stakers count (for monitoring purposes)\nNote: This doesn't return the actual addresses due to box iteration limitations",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "updateAPR",
            "args": [
                {
                    "type": "uint64",
                    "name": "newAprBasisPoints"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Update the APR basis points\nOnly the admin can call this",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "updateAdmin",
            "args": [
                {
                    "type": "account",
                    "name": "newAdminAddress"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Update the admin address\nOnly the current admin can call this",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "getUserStats",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                }
            ],
            "returns": {
                "type": "uint64[]"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": true,
            "desc": "Get current staking statistics for a user",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "getContractStats",
            "args": [],
            "returns": {
                "type": "uint64[]"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": true,
            "desc": "Get contract global statistics",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "emergencyWithdrawRewards",
            "args": [
                {
                    "type": "uint64",
                    "name": "amount"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Emergency withdraw rewards from pool (admin only)",
            "events": [],
            "recommendations": {}
        },
        {
            "name": "deleteUserBox",
            "args": [
                {
                    "type": "account",
                    "name": "userAddress"
                }
            ],
            "returns": {
                "type": "void"
            },
            "actions": {
                "create": [],
                "call": [
                    "NoOp"
                ]
            },
            "readonly": false,
            "desc": "Delete a user's box (for cleanup)\nCan only be called by the box owner or admin",
            "events": [],
            "recommendations": {}
        }
    ],
    "arcs": [
        22,
        28
    ],
    "desc": "ASA Staking Contract for Algorand with Auto-Compounding\n\nThis contract allows users to:\n- Stake an ASA token\n- Earn rewards that compound automatically when claimed\n- Add to their stake at any time\n- Withdraw part or all of their stake at any time\n- Rewards are calculated based on APR and distributed from a reward pool\n\nThis implementation uses box storage to store user staking information",
    "networks": {},
    "state": {
        "schema": {
            "global": {
                "ints": 7,
                "bytes": 8
            },
            "local": {
                "ints": 0,
                "bytes": 0
            }
        },
        "keys": {
            "global": {
                "asset": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "YXNzZXQ="
                },
                "adminAddress": {
                    "keyType": "AVMString",
                    "valueType": "address",
                    "key": "YWRtaW5BZGRyZXNz"
                },
                "totalStaked": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "dG90YWxTdGFrZWQ="
                },
                "aprBasisPoints": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "YXByQmFzaXNQb2ludHM="
                },
                "lastDistributionTime": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "bGFzdERpc3RyaWJ1dGlvblRpbWU="
                },
                "distributionPeriodSeconds": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "ZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcw=="
                },
                "minimumStake": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "bWluaW11bVN0YWtl"
                },
                "rewardPool": {
                    "keyType": "AVMString",
                    "valueType": "AVMUint64",
                    "key": "cmV3YXJkUG9vbA=="
                }
            },
            "local": {},
            "box": {}
        },
        "maps": {
            "global": {},
            "local": {},
            "box": {
                "stakers": {
                    "keyType": "address",
                    "valueType": "UserStakeInfo",
                    "prefix": "c3Rha2Vycw=="
                }
            }
        }
    },
    "bareActions": {
        "create": [
            "NoOp"
        ],
        "call": []
    },
    "sourceInfo": {
        "approval": {
            "sourceInfo": [
                {
                    "pc": [
                        771
                    ],
                    "errorMessage": "Already initialized"
                },
                {
                    "pc": [
                        899,
                        1112
                    ],
                    "errorMessage": "Asset transfer must be to contract"
                },
                {
                    "pc": [
                        685
                    ],
                    "errorMessage": "Box must have value"
                },
                {
                    "pc": [
                        876
                    ],
                    "errorMessage": "Contract not initialized"
                },
                {
                    "pc": [
                        882,
                        1091
                    ],
                    "errorMessage": "Expected 2 txns in group"
                },
                {
                    "pc": [
                        911,
                        1124
                    ],
                    "errorMessage": "Incorrect asset ID"
                },
                {
                    "pc": [
                        1353,
                        1512
                    ],
                    "errorMessage": "Index access is out of bounds"
                },
                {
                    "pc": [
                        935
                    ],
                    "errorMessage": "Initial stake below minimum"
                },
                {
                    "pc": [
                        1738
                    ],
                    "errorMessage": "Insufficient reward pool"
                },
                {
                    "pc": [
                        1117
                    ],
                    "errorMessage": "Must provide non-zero rewards"
                },
                {
                    "pc": [
                        906
                    ],
                    "errorMessage": "Must stake non-zero amount"
                },
                {
                    "pc": [
                        996
                    ],
                    "errorMessage": "No stake found"
                },
                {
                    "pc": [
                        316,
                        334,
                        350,
                        367,
                        390,
                        408,
                        424,
                        445,
                        460,
                        484,
                        508,
                        520,
                        536,
                        548,
                        560,
                        596,
                        614,
                        636
                    ],
                    "errorMessage": "OnCompletion is not NoOp"
                },
                {
                    "pc": [
                        1085
                    ],
                    "errorMessage": "Only admin can add rewards"
                },
                {
                    "pc": [
                        1321
                    ],
                    "errorMessage": "Only admin can distribute rewards"
                },
                {
                    "pc": [
                        1730
                    ],
                    "errorMessage": "Only admin can emergency withdraw"
                },
                {
                    "pc": [
                        1559
                    ],
                    "errorMessage": "Only admin can update APR"
                },
                {
                    "pc": [
                        1576
                    ],
                    "errorMessage": "Only admin can update admin"
                },
                {
                    "pc": [
                        1797
                    ],
                    "errorMessage": "Only box owner or admin can delete box"
                },
                {
                    "pc": [
                        777
                    ],
                    "errorMessage": "Only creator can initialize"
                },
                {
                    "pc": [
                        837
                    ],
                    "errorMessage": "Only creator or admin can opt in"
                },
                {
                    "pc": [
                        1023
                    ],
                    "errorMessage": "Remaining stake would be below minimum"
                },
                {
                    "pc": [
                        1330
                    ],
                    "errorMessage": "Too many stakers in single batch"
                },
                {
                    "pc": [
                        892,
                        1105
                    ],
                    "errorMessage": "Transaction 0 must be asset transfer"
                },
                {
                    "pc": [
                        1806
                    ],
                    "errorMessage": "User still has active stake"
                },
                {
                    "pc": [
                        1002
                    ],
                    "errorMessage": "Withdrawal amount exceeds stake"
                },
                {
                    "pc": [
                        1005
                    ],
                    "errorMessage": "Withdrawal amount must be positive"
                },
                {
                    "pc": [
                        664
                    ],
                    "errorMessage": "can only call when creating"
                },
                {
                    "pc": [
                        319,
                        337,
                        353,
                        370,
                        393,
                        411,
                        427,
                        448,
                        463,
                        487,
                        511,
                        523,
                        539,
                        551,
                        563,
                        599,
                        617,
                        639
                    ],
                    "errorMessage": "can only call when not creating"
                },
                {
                    "pc": [
                        749,
                        769,
                        819,
                        841,
                        871,
                        875,
                        916,
                        976,
                        1021,
                        1045,
                        1055,
                        1081,
                        1095,
                        1128,
                        1149,
                        1153,
                        1161,
                        1317,
                        1404,
                        1455,
                        1465,
                        1555,
                        1572,
                        1645,
                        1649,
                        1654,
                        1659,
                        1664,
                        1669,
                        1673,
                        1724,
                        1734,
                        1742,
                        1752,
                        1779
                    ],
                    "errorMessage": "check GlobalState exists"
                },
                {
                    "pc": [
                        889,
                        1102
                    ],
                    "errorMessage": "transaction type is axfer"
                }
            ],
            "pcOffsetMethod": "none"
        },
        "clear": {
            "sourceInfo": [],
            "pcOffsetMethod": "none"
        }
    },
    "source": {
        "approval": "I3ByYWdtYSB2ZXJzaW9uIDEwCiNwcmFnbWEgdHlwZXRyYWNrIGZhbHNlCgovLyBAYWxnb3JhbmRmb3VuZGF0aW9uL2FsZ29yYW5kLXR5cGVzY3JpcHQvYXJjNC9pbmRleC5kLnRzOjpDb250cmFjdC5hcHByb3ZhbFByb2dyYW0oKSAtPiB1aW50NjQ6Cm1haW46CiAgICBpbnRjYmxvY2sgMCAxIDQgOAogICAgYnl0ZWNibG9jayAicmV3YXJkUG9vbCIgImFzc2V0IiAiYWRtaW5BZGRyZXNzIiAidG90YWxTdGFrZWQiIDB4MTUxZjdjNzUgImFwckJhc2lzUG9pbnRzIiAibGFzdERpc3RyaWJ1dGlvblRpbWUiICJkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzIiAibWluaW11bVN0YWtlIiAic3Rha2VycyIKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBibnogbWFpbl9hZnRlcl9pZl9lbHNlQDIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDgKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBpbnRjXzAgLy8gMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDkKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIGdsb2JhbCBaZXJvQWRkcmVzcwogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzMgLy8gInRvdGFsU3Rha2VkIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUxCiAgICAvLyBwdWJsaWMgYXByQmFzaXNQb2ludHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA1IC8vICJhcHJCYXNpc1BvaW50cyIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNiAvLyAibGFzdERpc3RyaWJ1dGlvblRpbWUiCiAgICBpbnRjXzAgLy8gMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTMKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNyAvLyAiZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDggLy8gIm1pbmltdW1TdGFrZSIKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgaW50Y18wIC8vIDAKICAgIGFwcF9nbG9iYWxfcHV0CgptYWluX2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYtNDcKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG4gTnVtQXBwQXJncwogICAgYnogbWFpbl9iYXJlX3JvdXRpbmdAMjUKICAgIHB1c2hieXRlc3MgMHgzNmRkMDViNCAweGEwMWE1ZGRjIDB4MGU5M2ZkZTYgMHg2NjdjNWQzMCAweDlmZmQzZTUzIDB4MDg5MGJkNTggMHgyMWYxZGRmZiAweGIzYjcwMTQ2IDB4MGJkOGNmNjAgMHg2OTA0YWM1YSAweDJiODdmNTdjIDB4ZjgzZWViNWQgMHgxZTY2MTJiZCAweDgyYWIxZWM0IDB4MTU3NjZiMDkgMHhiZmUzMTU2NCAweGNlOTYzYjFkIDB4ZGM5YTJhMDUgLy8gbWV0aG9kICJnZXRVc2VyU3Rha2VJbmZvKGFjY291bnQpKHVpbnQ2NCx1aW50NjQsdWludDY0LHVpbnQ2NCkiLCBtZXRob2QgInN0b3JlVXNlclN0YWtlSW5mbyhhY2NvdW50LCh1aW50NjQsdWludDY0LHVpbnQ2NCx1aW50NjQpKXZvaWQiLCBtZXRob2QgImdldEN1cnJlbnRQZXJpb2QoKXVpbnQ2NCIsIG1ldGhvZCAiaW5pdGlhbGl6ZShhc3NldCxhY2NvdW50LHVpbnQ2NCx1aW50NjQsdWludDY0KXZvaWQiLCBtZXRob2QgIm9wdEluVG9Bc3NldCgpdm9pZCIsIG1ldGhvZCAic3Rha2UoKXZvaWQiLCBtZXRob2QgIndpdGhkcmF3KHVpbnQ2NCl2b2lkIiwgbWV0aG9kICJhZGRSZXdhcmRzKCl2b2lkIiwgbWV0aG9kICJjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZChhY2NvdW50KXVpbnQ2NCIsIG1ldGhvZCAiY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMoYWNjb3VudCl1aW50NjQiLCBtZXRob2QgImRpc3RyaWJ1dGVSZXdhcmRzKGFkZHJlc3NbXSl2b2lkIiwgbWV0aG9kICJnZXRBY3RpdmVTdGFrZXJzQ291bnQoYWRkcmVzc1tdKXVpbnQ2NCIsIG1ldGhvZCAidXBkYXRlQVBSKHVpbnQ2NCl2b2lkIiwgbWV0aG9kICJ1cGRhdGVBZG1pbihhY2NvdW50KXZvaWQiLCBtZXRob2QgImdldFVzZXJTdGF0cyhhY2NvdW50KXVpbnQ2NFtdIiwgbWV0aG9kICJnZXRDb250cmFjdFN0YXRzKCl1aW50NjRbXSIsIG1ldGhvZCAiZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzKHVpbnQ2NCl2b2lkIiwgbWV0aG9kICJkZWxldGVVc2VyQm94KGFjY291bnQpdm9pZCIKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDAKICAgIG1hdGNoIG1haW5fZ2V0VXNlclN0YWtlSW5mb19yb3V0ZUA1IG1haW5fc3RvcmVVc2VyU3Rha2VJbmZvX3JvdXRlQDYgbWFpbl9nZXRDdXJyZW50UGVyaW9kX3JvdXRlQDcgbWFpbl9pbml0aWFsaXplX3JvdXRlQDggbWFpbl9vcHRJblRvQXNzZXRfcm91dGVAOSBtYWluX3N0YWtlX3JvdXRlQDEwIG1haW5fd2l0aGRyYXdfcm91dGVAMTEgbWFpbl9hZGRSZXdhcmRzX3JvdXRlQDEyIG1haW5fY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2Rfcm91dGVAMTMgbWFpbl9jYWxjdWxhdGVQZW5kaW5nUmV3YXJkc19yb3V0ZUAxNCBtYWluX2Rpc3RyaWJ1dGVSZXdhcmRzX3JvdXRlQDE1IG1haW5fZ2V0QWN0aXZlU3Rha2Vyc0NvdW50X3JvdXRlQDE2IG1haW5fdXBkYXRlQVBSX3JvdXRlQDE3IG1haW5fdXBkYXRlQWRtaW5fcm91dGVAMTggbWFpbl9nZXRVc2VyU3RhdHNfcm91dGVAMTkgbWFpbl9nZXRDb250cmFjdFN0YXRzX3JvdXRlQDIwIG1haW5fZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzX3JvdXRlQDIxIG1haW5fZGVsZXRlVXNlckJveF9yb3V0ZUAyMgoKbWFpbl9hZnRlcl9pZl9lbHNlQDI5OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIGludGNfMCAvLyAwCiAgICByZXR1cm4KCm1haW5fZGVsZXRlVXNlckJveF9yb3V0ZUAyMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTE3CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUxNwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICBjYWxsc3ViIGRlbGV0ZVVzZXJCb3gKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzX3JvdXRlQDIxOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0ODkKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2LTQ3CiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0ODkKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiBlbWVyZ2VuY3lXaXRoZHJhd1Jld2FyZHMKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fZ2V0Q29udHJhY3RTdGF0c19yb3V0ZUAyMDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDcwCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBnZXRDb250cmFjdFN0YXRzCiAgICBieXRlYyA0IC8vIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2dldFVzZXJTdGF0c19yb3V0ZUAxOToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDUxCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1MQogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICBjYWxsc3ViIGdldFVzZXJTdGF0cwogICAgYnl0ZWMgNCAvLyAweDE1MWY3Yzc1CiAgICBzd2FwCiAgICBjb25jYXQKICAgIGxvZwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl91cGRhdGVBZG1pbl9yb3V0ZUAxODoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDM4CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQzOAogICAgLy8gQGFiaW1ldGhvZCgpCiAgICBjYWxsc3ViIHVwZGF0ZUFkbWluCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX3VwZGF0ZUFQUl9yb3V0ZUAxNzoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDI0CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDI0CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIGNhbGxzdWIgdXBkYXRlQVBSCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2dldEFjdGl2ZVN0YWtlcnNDb3VudF9yb3V0ZUAxNjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDA2CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDA2CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIGNhbGxzdWIgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50CiAgICBpdG9iCiAgICBieXRlYyA0IC8vIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2Rpc3RyaWJ1dGVSZXdhcmRzX3JvdXRlQDE1OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozODEKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2LTQ3CiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozODEKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiBkaXN0cmlidXRlUmV3YXJkcwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9jYWxjdWxhdGVQZW5kaW5nUmV3YXJkc19yb3V0ZUAxNDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzA4CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMwOAogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICBjYWxsc3ViIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzCiAgICBpdG9iCiAgICBieXRlYyA0IC8vIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2NhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kX3JvdXRlQDEzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNjIKICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2LTQ3CiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgdHhuYXMgQWNjb3VudHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjYyCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIGNhbGxzdWIgY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QKICAgIGl0b2IKICAgIGJ5dGVjIDQgLy8gMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fYWRkUmV3YXJkc19yb3V0ZUAxMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjM0CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBhZGRSZXdhcmRzCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX3dpdGhkcmF3X3JvdXRlQDExOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxOTAKICAgIC8vIEBhYmltZXRob2QoKQogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2LTQ3CiAgICAvLyBAY29udHJhY3QoeyBzdGF0ZVRvdGFsczogeyBnbG9iYWxCeXRlczogOCB9IH0pCiAgICAvLyBleHBvcnQgY2xhc3MgQVNBU3Rha2luZ0NvbnRyYWN0IGV4dGVuZHMgQ29udHJhY3QgewogICAgdHhuYSBBcHBsaWNhdGlvbkFyZ3MgMQogICAgYnRvaQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxOTAKICAgIC8vIEBhYmltZXRob2QoKQogICAgY2FsbHN1YiB3aXRoZHJhdwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9zdGFrZV9yb3V0ZUAxMDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTQ1CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBzdGFrZQogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9vcHRJblRvQXNzZXRfcm91dGVAOToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTI0CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgY2FsbHN1YiBvcHRJblRvQXNzZXQKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5faW5pdGlhbGl6ZV9yb3V0ZUA4OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo5NgogICAgLy8gQGFiaW1ldGhvZCgpCiAgICB0eG4gT25Db21wbGV0aW9uCiAgICAhCiAgICBhc3NlcnQgLy8gT25Db21wbGV0aW9uIGlzIG5vdCBOb09wCiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBub3QgY3JlYXRpbmcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYtNDcKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAxCiAgICBidG9pCiAgICB0eG5hcyBBc3NldHMKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDIKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAzCiAgICBidG9pCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA0CiAgICBidG9pCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyA1CiAgICBidG9pCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjk2CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIGNhbGxzdWIgaW5pdGlhbGl6ZQogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKbWFpbl9nZXRDdXJyZW50UGVyaW9kX3JvdXRlQDc6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjg3CiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudFBlcmlvZCgpOiB1aW50NjQgewogICAgdHhuIE9uQ29tcGxldGlvbgogICAgIQogICAgYXNzZXJ0IC8vIE9uQ29tcGxldGlvbiBpcyBub3QgTm9PcAogICAgdHhuIEFwcGxpY2F0aW9uSUQKICAgIGFzc2VydCAvLyBjYW4gb25seSBjYWxsIHdoZW4gbm90IGNyZWF0aW5nCiAgICBjYWxsc3ViIGdldEN1cnJlbnRQZXJpb2QKICAgIGl0b2IKICAgIGJ5dGVjIDQgLy8gMHgxNTFmN2M3NQogICAgc3dhcAogICAgY29uY2F0CiAgICBsb2cKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fc3RvcmVVc2VyU3Rha2VJbmZvX3JvdXRlQDY6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjgwCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICB0eG5hIEFwcGxpY2F0aW9uQXJncyAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjgwCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIGNhbGxzdWIgc3RvcmVVc2VyU3Rha2VJbmZvCiAgICBwb3AKICAgIGludGNfMSAvLyAxCiAgICByZXR1cm4KCm1haW5fZ2V0VXNlclN0YWtlSW5mb19yb3V0ZUA1OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MgogICAgLy8gcHVibGljIGdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQpOiBVc2VyU3Rha2VJbmZvIHsKICAgIHR4biBPbkNvbXBsZXRpb24KICAgICEKICAgIGFzc2VydCAvLyBPbkNvbXBsZXRpb24gaXMgbm90IE5vT3AKICAgIHR4biBBcHBsaWNhdGlvbklECiAgICBhc3NlcnQgLy8gY2FuIG9ubHkgY2FsbCB3aGVuIG5vdCBjcmVhdGluZwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0Ni00NwogICAgLy8gQGNvbnRyYWN0KHsgc3RhdGVUb3RhbHM6IHsgZ2xvYmFsQnl0ZXM6IDggfSB9KQogICAgLy8gZXhwb3J0IGNsYXNzIEFTQVN0YWtpbmdDb250cmFjdCBleHRlbmRzIENvbnRyYWN0IHsKICAgIHR4bmEgQXBwbGljYXRpb25BcmdzIDEKICAgIGJ0b2kKICAgIHR4bmFzIEFjY291bnRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYyCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgY2FsbHN1YiBnZXRVc2VyU3Rha2VJbmZvCiAgICBieXRlYyA0IC8vIDB4MTUxZjdjNzUKICAgIHN3YXAKICAgIGNvbmNhdAogICAgbG9nCiAgICBpbnRjXzEgLy8gMQogICAgcmV0dXJuCgptYWluX2JhcmVfcm91dGluZ0AyNToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYtNDcKICAgIC8vIEBjb250cmFjdCh7IHN0YXRlVG90YWxzOiB7IGdsb2JhbEJ5dGVzOiA4IH0gfSkKICAgIC8vIGV4cG9ydCBjbGFzcyBBU0FTdGFraW5nQ29udHJhY3QgZXh0ZW5kcyBDb250cmFjdCB7CiAgICB0eG4gT25Db21wbGV0aW9uCiAgICBibnogbWFpbl9hZnRlcl9pZl9lbHNlQDI5CiAgICB0eG4gQXBwbGljYXRpb25JRAogICAgIQogICAgYXNzZXJ0IC8vIGNhbiBvbmx5IGNhbGwgd2hlbiBjcmVhdGluZwogICAgaW50Y18xIC8vIDEKICAgIHJldHVybgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBieXRlcykgLT4gYnl0ZXM6CmdldFVzZXJTdGFrZUluZm86CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYyCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgcHJvdG8gMSAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBieXRlYyA5IC8vICJzdGFrZXJzIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2MwogICAgLy8gY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAtMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjYzCiAgICAvLyBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgZHVwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjY1CiAgICAvLyBpZiAodXNlckJveC5leGlzdHMpIHsKICAgIGJveF9sZW4KICAgIGJ1cnkgMQogICAgYnogZ2V0VXNlclN0YWtlSW5mb19lbHNlX2JvZHlAMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo2NgogICAgLy8gcmV0dXJuIHVzZXJCb3gudmFsdWUuY29weSgpCiAgICBmcmFtZV9kaWcgMAogICAgYm94X2dldAogICAgYXNzZXJ0IC8vIEJveCBtdXN0IGhhdmUgdmFsdWUKICAgIHN3YXAKICAgIHJldHN1YgoKZ2V0VXNlclN0YWtlSW5mb19lbHNlX2JvZHlAMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NjgtNzMKICAgIC8vIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgIHN0YWtlZEFtb3VudDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgbGFzdFN0YWtlVGltZTogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICBsYXN0Q2xhaW1lZFBlcmlvZDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vIH0pCiAgICBwdXNoYnl0ZXMgMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwCiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3Quc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBieXRlcywgc3Rha2VJbmZvOiBieXRlcykgLT4gYnl0ZXM6CnN0b3JlVXNlclN0YWtlSW5mbzoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6ODAKICAgIC8vIHB1YmxpYyBzdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3M6IEFjY291bnQsIHN0YWtlSW5mbzogVXNlclN0YWtlSW5mbyk6IHZvaWQgewogICAgcHJvdG8gMiAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU3CiAgICAvLyBwdWJsaWMgc3Rha2VycyA9IEJveE1hcDxBY2NvdW50LCBVc2VyU3Rha2VJbmZvPih7IGtleVByZWZpeDogJ3N0YWtlcnMnIH0pCiAgICBieXRlYyA5IC8vICJzdGFrZXJzIgogICAgZnJhbWVfZGlnIC0yCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6ODEKICAgIC8vIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICBmcmFtZV9kaWcgLTEKICAgIGJveF9wdXQKICAgIGZyYW1lX2RpZyAtMQogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmdldEN1cnJlbnRQZXJpb2QoKSAtPiB1aW50NjQ6CmdldEN1cnJlbnRQZXJpb2Q6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjg3CiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudFBlcmlvZCgpOiB1aW50NjQgewogICAgcHJvdG8gMCAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA3IC8vICJkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIHN3YXAKICAgIGR1cAogICAgdW5jb3ZlciAyCiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjg5CiAgICAvLyBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIGJueiBnZXRDdXJyZW50UGVyaW9kX2FmdGVyX2lmX2Vsc2VAMgogICAgaW50Y18wIC8vIDAKICAgIHN3YXAKICAgIHJldHN1YgoKZ2V0Q3VycmVudFBlcmlvZF9hZnRlcl9pZl9lbHNlQDI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjkwCiAgICAvLyByZXR1cm4gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCAvIHBlcmlvZFNlY29uZHMKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGZyYW1lX2RpZyAwCiAgICAvCiAgICBzd2FwCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QuaW5pdGlhbGl6ZShhc3NldDogdWludDY0LCBhZG1pbkFkZHJlc3M6IGJ5dGVzLCBhcHJCYXNpc1BvaW50czogdWludDY0LCBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsIG1pbmltdW1TdGFrZTogdWludDY0KSAtPiB2b2lkOgppbml0aWFsaXplOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo5Ni0xMDMKICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICBwcm90byA1IDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDgKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTA1CiAgICAvLyBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgIQogICAgYXNzZXJ0IC8vIEFscmVhZHkgaW5pdGlhbGl6ZWQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTA4CiAgICAvLyBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzLCAnT25seSBjcmVhdG9yIGNhbiBpbml0aWFsaXplJykKICAgIHR4biBTZW5kZXIKICAgIGdsb2JhbCBDcmVhdG9yQWRkcmVzcwogICAgPT0KICAgIGFzc2VydCAvLyBPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDgKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjExMQogICAgLy8gdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICBmcmFtZV9kaWcgLTUKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ5CiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBieXRlY18yIC8vICJhZG1pbkFkZHJlc3MiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjExMgogICAgLy8gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBhZG1pbkFkZHJlc3MKICAgIGZyYW1lX2RpZyAtNAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzMgLy8gInRvdGFsU3Rha2VkIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMTMKICAgIC8vIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICBpbnRjXzAgLy8gMAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTEKICAgIC8vIHB1YmxpYyBhcHJCYXNpc1BvaW50cyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDUgLy8gImFwckJhc2lzUG9pbnRzIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMTQKICAgIC8vIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgZnJhbWVfZGlnIC0zCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNiAvLyAibGFzdERpc3RyaWJ1dGlvblRpbWUiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjExNQogICAgLy8gdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDcgLy8gImRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjExNgogICAgLy8gdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlID0gZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcwogICAgZnJhbWVfZGlnIC0yCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NAogICAgLy8gcHVibGljIG1pbmltdW1TdGFrZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjIDggLy8gIm1pbmltdW1TdGFrZSIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTE3CiAgICAvLyB0aGlzLm1pbmltdW1TdGFrZS52YWx1ZSA9IG1pbmltdW1TdGFrZQogICAgZnJhbWVfZGlnIC0xCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxMTgKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIGludGNfMCAvLyAwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0Lm9wdEluVG9Bc3NldCgpIC0+IHZvaWQ6Cm9wdEluVG9Bc3NldDoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTI0LTEyNQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgb3B0SW5Ub0Fzc2V0KCk6IHZvaWQgewogICAgcHJvdG8gMCAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ5CiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMiAvLyAiYWRtaW5BZGRyZXNzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTI4CiAgICAvLyBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluJykKICAgIHR4biBTZW5kZXIKICAgIGdsb2JhbCBDcmVhdG9yQWRkcmVzcwogICAgPT0KICAgIGJueiBvcHRJblRvQXNzZXRfYm9vbF90cnVlQDIKICAgIHR4biBTZW5kZXIKICAgIGZyYW1lX2RpZyAwCiAgICA9PQogICAgYnogb3B0SW5Ub0Fzc2V0X2Jvb2xfZmFsc2VAMwoKb3B0SW5Ub0Fzc2V0X2Jvb2xfdHJ1ZUAyOgogICAgaW50Y18xIC8vIDEKCm9wdEluVG9Bc3NldF9ib29sX21lcmdlQDQ6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEyOAogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICBhc3NlcnQgLy8gT25seSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDgKICAgIC8vIHB1YmxpYyBhc3NldCA9IEdsb2JhbFN0YXRlPEFzc2V0Pih7IGluaXRpYWxWYWx1ZTogQXNzZXQoKSB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTMyLTEzOAogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjEzNAogICAgLy8gYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICBnbG9iYWwgQ3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcwogICAgc3dhcAogICAgaXR4bl9maWVsZCBYZmVyQXNzZXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTM1CiAgICAvLyBhc3NldEFtb3VudDogMCwKICAgIGludGNfMCAvLyAwCiAgICBpdHhuX2ZpZWxkIEFzc2V0QW1vdW50CiAgICBpdHhuX2ZpZWxkIEFzc2V0UmVjZWl2ZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTMyLTEzNwogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgfSkKICAgIGludGNfMiAvLyA0CiAgICBpdHhuX2ZpZWxkIFR5cGVFbnVtCiAgICBpbnRjXzAgLy8gMAogICAgaXR4bl9maWVsZCBGZWUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTMyLTEzOAogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX3N1Ym1pdAogICAgcmV0c3ViCgpvcHRJblRvQXNzZXRfYm9vbF9mYWxzZUAzOgogICAgaW50Y18wIC8vIDAKICAgIGIgb3B0SW5Ub0Fzc2V0X2Jvb2xfbWVyZ2VANAoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5zdGFrZSgpIC0+IHZvaWQ6CnN0YWtlOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNDUtMTQ2CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBzdGFrZSgpOiB2b2lkIHsKICAgIHByb3RvIDAgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OAogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzEgLy8gImFzc2V0IgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTQ5CiAgICAvLyBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSAhPT0gQXNzZXQoKSwgJ0NvbnRyYWN0IG5vdCBpbml0aWFsaXplZCcpCiAgICBhc3NlcnQgLy8gQ29udHJhY3Qgbm90IGluaXRpYWxpemVkCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1MgogICAgLy8gYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgZ2xvYmFsIEdyb3VwU2l6ZQogICAgcHVzaGludCAyIC8vIDIKICAgID09CiAgICBhc3NlcnQgLy8gRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIGd0eG5zIFR5cGVFbnVtCiAgICBkdXAKICAgIGludGNfMiAvLyBheGZlcgogICAgPT0KICAgIGFzc2VydCAvLyB0cmFuc2FjdGlvbiB0eXBlIGlzIGF4ZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1NgogICAgLy8gYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgaW50Y18yIC8vIDQKICAgID09CiAgICBhc3NlcnQgLy8gVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTU3CiAgICAvLyBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgZ3R4bnMgQXNzZXRSZWNlaXZlcgogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgID09CiAgICBhc3NlcnQgLy8gQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNTUKICAgIC8vIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIGludGNfMCAvLyAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1OAogICAgLy8gYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgZ3R4bnMgQXNzZXRBbW91bnQKICAgIGR1cAogICAgY292ZXIgMgogICAgYXNzZXJ0IC8vIE11c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE1NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTU5CiAgICAvLyBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIGd0eG5zIFhmZXJBc3NldAogICAgPT0KICAgIGFzc2VydCAvLyBJbmNvcnJlY3QgYXNzZXQgSUQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWMgOCAvLyAibWluaW11bVN0YWtlIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTY2CiAgICAvLyBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgdHhuIFNlbmRlcgogICAgZHVwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE2NwogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIGR1cG4gMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxNzAKICAgIC8vIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICBibnogc3Rha2VfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3MQogICAgLy8gYXNzZXJ0KHN0YWtlQW1vdW50ID49IG1pbmltdW1TdGFrZSwgJ0luaXRpYWwgc3Rha2UgYmVsb3cgbWluaW11bScpCiAgICBmcmFtZV9kaWcgMAogICAgZnJhbWVfZGlnIDEKICAgID49CiAgICBhc3NlcnQgLy8gSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3MwogICAgLy8gc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIGNhbGxzdWIgZ2V0Q3VycmVudFBlcmlvZAogICAgaXRvYgogICAgZnJhbWVfZGlnIDMKICAgIHN3YXAKICAgIHJlcGxhY2UyIDI0CiAgICBmcmFtZV9idXJ5IDQKCnN0YWtlX2FmdGVyX2lmX2Vsc2VAMjoKICAgIGZyYW1lX2RpZyA0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3NwogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIGR1cAogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDY0CiAgICBmcmFtZV9kaWcgMAogICAgZHVwCiAgICBjb3ZlciAzCiAgICArCiAgICBpdG9iCiAgICByZXBsYWNlMiAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE3OAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICBnbG9iYWwgTGF0ZXN0VGltZXN0YW1wCiAgICBpdG9iCiAgICByZXBsYWNlMiA4CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE4MQogICAgLy8gdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgZnJhbWVfZGlnIDIKICAgIHN3YXAKICAgIGNhbGxzdWIgc3RvcmVVc2VyU3Rha2VJbmZvCiAgICBwb3AKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18zIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE4NAogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBzdGFrZUFtb3VudAogICAgKwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWNfMyAvLyAidG90YWxTdGFrZWQiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE4NAogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBzdGFrZUFtb3VudAogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC53aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCkgLT4gdm9pZDoKd2l0aGRyYXc6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MC0xOTEKICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICBwcm90byAxIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MTkyCiAgICAvLyBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgdHhuIFNlbmRlcgogICAgZHVwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5MwogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MpCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIGR1cAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoxOTYKICAgIC8vIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIGR1cG4gMgogICAgYXNzZXJ0IC8vIE5vIHN0YWtlIGZvdW5kCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5NwogICAgLy8gYXNzZXJ0KGFtb3VudCA8PSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwgJ1dpdGhkcmF3YWwgYW1vdW50IGV4Y2VlZHMgc3Rha2UnKQogICAgZnJhbWVfZGlnIC0xCiAgICBkaWcgMQogICAgPD0KICAgIGFzc2VydCAvLyBXaXRoZHJhd2FsIGFtb3VudCBleGNlZWRzIHN0YWtlCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjE5OAogICAgLy8gYXNzZXJ0KGFtb3VudCA+IDAsICdXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlJykKICAgIGZyYW1lX2RpZyAtMQogICAgYXNzZXJ0IC8vIFdpdGhkcmF3YWwgYW1vdW50IG11c3QgYmUgcG9zaXRpdmUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjAyCiAgICAvLyBpZiAoYW1vdW50IDwgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUpIHsKICAgIGZyYW1lX2RpZyAtMQogICAgPgogICAgYnogd2l0aGRyYXdfYWZ0ZXJfaWZfZWxzZUAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIwMwogICAgLy8gY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICBmcmFtZV9kaWcgMgogICAgZnJhbWVfZGlnIC0xCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0CiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDggLy8gIm1pbmltdW1TdGFrZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIwNQogICAgLy8gYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgID49CiAgICBhc3NlcnQgLy8gUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0KCndpdGhkcmF3X2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjA5CiAgICAvLyBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudCkKICAgIGZyYW1lX2RpZyAyCiAgICBmcmFtZV9kaWcgLTEKICAgIC0KICAgIGl0b2IKICAgIGZyYW1lX2RpZyAxCiAgICBzd2FwCiAgICByZXBsYWNlMiAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxMgogICAgLy8gdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcywgc3Rha2VJbmZvKQogICAgZnJhbWVfZGlnIDAKICAgIHN3YXAKICAgIGNhbGxzdWIgc3RvcmVVc2VyU3Rha2VJbmZvCiAgICBwb3AKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18zIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNQogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgLSBhbW91bnQKICAgIGZyYW1lX2RpZyAtMQogICAgLQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWNfMyAvLyAidG90YWxTdGFrZWQiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxNQogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgLSBhbW91bnQKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4CiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIxOS0yMjYKICAgIC8vIGl0eG4KICAgIC8vICAgLmFzc2V0VHJhbnNmZXIoewogICAgLy8gICAgIGFzc2V0UmVjZWl2ZXI6IFR4bi5zZW5kZXIsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIGZlZTogMTAwMCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjIyMQogICAgLy8gYXNzZXRSZWNlaXZlcjogVHhuLnNlbmRlciwKICAgIHR4biBTZW5kZXIKICAgIHN3YXAKICAgIGl0eG5fZmllbGQgWGZlckFzc2V0CiAgICBmcmFtZV9kaWcgLTEKICAgIGl0eG5fZmllbGQgQXNzZXRBbW91bnQKICAgIGl0eG5fZmllbGQgQXNzZXRSZWNlaXZlcgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMTktMjI1CiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICBpbnRjXzIgLy8gNAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMjQKICAgIC8vIGZlZTogMTAwMCwKICAgIHB1c2hpbnQgMTAwMCAvLyAxMDAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMTktMjI2CiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICAvLyAgIC5zdWJtaXQoKQogICAgaXR4bl9zdWJtaXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5hZGRSZXdhcmRzKCkgLT4gdm9pZDoKYWRkUmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDkKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18yIC8vICJhZG1pbkFkZHJlc3MiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyMzgKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcycpCiAgICB0eG4gU2VuZGVyCiAgICA9PQogICAgYXNzZXJ0IC8vIE9ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0MQogICAgLy8gYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgZ2xvYmFsIEdyb3VwU2l6ZQogICAgcHVzaGludCAyIC8vIDIKICAgID09CiAgICBhc3NlcnQgLy8gRXhwZWN0ZWQgMiB0eG5zIGluIGdyb3VwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4CiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIGd0eG5zIFR5cGVFbnVtCiAgICBkdXAKICAgIGludGNfMiAvLyBheGZlcgogICAgPT0KICAgIGFzc2VydCAvLyB0cmFuc2FjdGlvbiB0eXBlIGlzIGF4ZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0NgogICAgLy8gYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgaW50Y18yIC8vIDQKICAgID09CiAgICBhc3NlcnQgLy8gVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjQ3CiAgICAvLyBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgZ3R4bnMgQXNzZXRSZWNlaXZlcgogICAgZ2xvYmFsIEN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MKICAgID09CiAgICBhc3NlcnQgLy8gQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNDUKICAgIC8vIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIGludGNfMCAvLyAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0OAogICAgLy8gYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBwcm92aWRlIG5vbi16ZXJvIHJld2FyZHMnKQogICAgZ3R4bnMgQXNzZXRBbW91bnQKICAgIGR1cAogICAgYXNzZXJ0IC8vIE11c3QgcHJvdmlkZSBub24temVybyByZXdhcmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI0NQogICAgLy8gY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjQ5CiAgICAvLyBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIGd0eG5zIFhmZXJBc3NldAogICAgdW5jb3ZlciAyCiAgICA9PQogICAgYXNzZXJ0IC8vIEluY29ycmVjdCBhc3NldCBJRAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMCAvLyAicmV3YXJkUG9vbCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI1MgogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgKwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNTIKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIHN3YXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyCiAgICAvLyBwdWJsaWMgbGFzdERpc3RyaWJ1dGlvblRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA2IC8vICJsYXN0RGlzdHJpYnV0aW9uVGltZSIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjU1CiAgICAvLyB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgZ2xvYmFsIExhdGVzdFRpbWVzdGFtcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5jYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogYnl0ZXMpIC0+IHVpbnQ2NDoKY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2Q6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI2Mi0yNjMKICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIHByb3RvIDEgMQogICAgaW50Y18wIC8vIDAKICAgIHB1c2hieXRlcyAiIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDUgLy8gImFwckJhc2lzUG9pbnRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAKICAgIC8vIHB1YmxpYyB0b3RhbFN0YWtlZCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18zIC8vICJ0b3RhbFN0YWtlZCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA3IC8vICJkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIHN3YXAKICAgIGNvdmVyIDIKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MjY5CiAgICAvLyBpZiAodG90YWxTdGFrZWQgPT09IDAgfHwgcGVyaW9kU2Vjb25kcyA9PT0gMCkgewogICAgYnogY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2RfaWZfYm9keUAyCiAgICBmcmFtZV9kaWcgMwogICAgYm56IGNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kX2FmdGVyX2lmX2Vsc2VAMwoKY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2RfaWZfYm9keUAyOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyNzAKICAgIC8vIHJldHVybiAwCiAgICBpbnRjXzAgLy8gMAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCmNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kX2FmdGVyX2lmX2Vsc2VAMzoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjc0CiAgICAvLyBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgZ2V0VXNlclN0YWtlSW5mbwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjc3CiAgICAvLyBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIGludGNfMCAvLyAwCiAgICBleHRyYWN0X3VpbnQ2NAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIGJueiBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZF9hZnRlcl9pZl9lbHNlQDUKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjc4CiAgICAvLyByZXR1cm4gMAogICAgaW50Y18wIC8vIDAKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgpjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZF9hZnRlcl9pZl9lbHNlQDU6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4MwogICAgLy8gY29uc3QgbGFzdFN0YWtlVGltZSA9IHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZQogICAgZnJhbWVfZGlnIDAKICAgIGludGNfMyAvLyA4CiAgICBleHRyYWN0X3VpbnQ2NAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyODcKICAgIC8vIGlmIChHbG9iYWwubGF0ZXN0VGltZXN0YW1wIDwgbGFzdFN0YWtlVGltZSArIG1pbmltdW1TdGFrZVRpbWUpIHsKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIHN3YXAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6Mjg2CiAgICAvLyBjb25zdCBtaW5pbXVtU3Rha2VUaW1lOiB1aW50NjQgPSA4NjQwMCAvLyAyNCBob3VycyBpbiBzZWNvbmRzCiAgICBwdXNoaW50IDg2NDAwIC8vIDg2NDAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4NwogICAgLy8gaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgKwogICAgPAogICAgYnogY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2RfYWZ0ZXJfaWZfZWxzZUA3CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjI4OAogICAgLy8gcmV0dXJuIDAKICAgIGludGNfMCAvLyAwCiAgICBmcmFtZV9idXJ5IDAKICAgIHJldHN1YgoKY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2RfYWZ0ZXJfaWZfZWxzZUA3OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyOTYKICAgIC8vIGNvbnN0IHBlcmlvZFJhdGVOdW1lcmF0b3I6IHVpbnQ2NCA9IGFwciAqIHBlcmlvZFNlY29uZHMKICAgIGZyYW1lX2RpZyAyCiAgICBmcmFtZV9kaWcgMwogICAgKgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMDAKICAgIC8vIGNvbnN0IHJld2FyZDogdWludDY0ID0gKHVzZXJTdGFrZSAqIHBlcmlvZFJhdGVOdW1lcmF0b3IpIC8gcGVyaW9kUmF0ZURlbm9taW5hdG9yCiAgICBmcmFtZV9kaWcgMQogICAgKgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czoyOTcKICAgIC8vIGNvbnN0IHBlcmlvZFJhdGVEZW5vbWluYXRvcjogdWludDY0ID0gMTAwMDAgKiB5ZWFySW5TZWNvbmRzCiAgICBwdXNoaW50IDMxNTM2MDAwMDAwMCAvLyAzMTUzNjAwMDAwMDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzAwCiAgICAvLyBjb25zdCByZXdhcmQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBwZXJpb2RSYXRlTnVtZXJhdG9yKSAvIHBlcmlvZFJhdGVEZW5vbWluYXRvcgogICAgLwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMDIKICAgIC8vIHJldHVybiByZXdhcmQKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzOiBieXRlcykgLT4gdWludDY0OgpjYWxjdWxhdGVQZW5kaW5nUmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzA4LTMwOQogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgcHJvdG8gMSAxCiAgICBwdXNoYnl0ZXMgIiIKICAgIGR1cG4gMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMTAKICAgIC8vIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAtMQogICAgY2FsbHN1YiBnZXRVc2VyU3Rha2VJbmZvCiAgICBkdXAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzEyCiAgICAvLyBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIGludGNfMCAvLyAwCiAgICBleHRyYWN0X3VpbnQ2NAogICAgYm56IGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX2FmdGVyX2lmX2Vsc2VAMgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMTMKICAgIC8vIHJldHVybiAwCiAgICBpbnRjXzAgLy8gMAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX2FmdGVyX2lmX2Vsc2VAMjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzE2CiAgICAvLyBjb25zdCBjdXJyZW50UGVyaW9kID0gdGhpcy5nZXRDdXJyZW50UGVyaW9kKCkKICAgIGNhbGxzdWIgZ2V0Q3VycmVudFBlcmlvZAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzE3CiAgICAvLyBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIGZyYW1lX2RpZyAzCiAgICBwdXNoaW50IDI0IC8vIDI0CiAgICBleHRyYWN0X3VpbnQ2NAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDEKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzIwCiAgICAvLyBjb25zdCBwZXJpb2RzU2luY2VMYXN0Q2xhaW06IHVpbnQ2NCA9IGN1cnJlbnRQZXJpb2QgPiBsYXN0Q2xhaW1lZFBlcmlvZCA/IGN1cnJlbnRQZXJpb2QgLSBsYXN0Q2xhaW1lZFBlcmlvZCA6IDAKICAgID4KICAgIGJ6IGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX3Rlcm5hcnlfZmFsc2VANAogICAgZnJhbWVfZGlnIDAKICAgIGZyYW1lX2RpZyAxCiAgICAtCiAgICBmcmFtZV9idXJ5IDIKCmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX3Rlcm5hcnlfbWVyZ2VANToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzIyCiAgICAvLyBpZiAocGVyaW9kc1NpbmNlTGFzdENsYWltID09PSAwKSB7CiAgICBmcmFtZV9kaWcgMgogICAgYm56IGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX2FmdGVyX2lmX2Vsc2VANwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMjMKICAgIC8vIHJldHVybiAwCiAgICBpbnRjXzAgLy8gMAogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX2FmdGVyX2lmX2Vsc2VANzoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzI3CiAgICAvLyBjb25zdCByZXdhcmRQZXJQZXJpb2QgPSB0aGlzLmNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIGNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMyOQogICAgLy8gcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgZnJhbWVfZGlnIDIKICAgICoKICAgIGZyYW1lX2J1cnkgMAogICAgcmV0c3ViCgpjYWxjdWxhdGVQZW5kaW5nUmV3YXJkc190ZXJuYXJ5X2ZhbHNlQDQ6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjMyMAogICAgLy8gY29uc3QgcGVyaW9kc1NpbmNlTGFzdENsYWltOiB1aW50NjQgPSBjdXJyZW50UGVyaW9kID4gbGFzdENsYWltZWRQZXJpb2QgPyBjdXJyZW50UGVyaW9kIC0gbGFzdENsYWltZWRQZXJpb2QgOiAwCiAgICBpbnRjXzAgLy8gMAogICAgZnJhbWVfYnVyeSAyCiAgICBiIGNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzX3Rlcm5hcnlfbWVyZ2VANQoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5kaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGJ5dGVzKSAtPiB2b2lkOgpkaXN0cmlidXRlUmV3YXJkczoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzgxLTM4MgogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0ZVJld2FyZHMoc3Rha2VyQWRkcmVzc2VzOiBhcmM0LkFkZHJlc3NbXSk6IHZvaWQgewogICAgcHJvdG8gMSAwCiAgICBpbnRjXzAgLy8gMAogICAgZHVwCiAgICBwdXNoYnl0ZXMgIiIKICAgIGR1cAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OQogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM4NQogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICB0eG4gU2VuZGVyCiAgICA9PQogICAgYXNzZXJ0IC8vIE9ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozODgKICAgIC8vIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgZnJhbWVfZGlnIC0xCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50MTYKICAgIGR1cAogICAgcHVzaGludCA1MCAvLyA1MAogICAgPD0KICAgIGFzc2VydCAvLyBUb28gbWFueSBzdGFrZXJzIGluIHNpbmdsZSBiYXRjaAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozOTAKICAgIC8vIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICBpbnRjXzAgLy8gMAogICAgZHVwCgpkaXN0cmlidXRlUmV3YXJkc19mb3JfaGVhZGVyQDE6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM5MwogICAgLy8gZm9yIChjb25zdCBzdGFrZXIgb2Ygc3Rha2VyQWRkcmVzc2VzKSB7CiAgICBmcmFtZV9kaWcgNgogICAgZnJhbWVfZGlnIDQKICAgIDwKICAgIGJ6IGRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2ZvckA0CiAgICBmcmFtZV9kaWcgLTEKICAgIGV4dHJhY3QgMiAwCiAgICBmcmFtZV9kaWcgNgogICAgcHVzaGludCAzMiAvLyAzMgogICAgKgogICAgcHVzaGludCAzMiAvLyAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICBkdXAKICAgIGZyYW1lX2J1cnkgMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozMzcKICAgIC8vIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIGNhbGxzdWIgZ2V0VXNlclN0YWtlSW5mbwogICAgZHVwCiAgICBmcmFtZV9idXJ5IDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzQwCiAgICAvLyBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIGludGNfMCAvLyAwCiAgICBleHRyYWN0X3VpbnQ2NAogICAgZHVwCiAgICBmcmFtZV9idXJ5IDMKICAgIGJueiBkaXN0cmlidXRlUmV3YXJkc19hZnRlcl9pZl9lbHNlQDcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzQxCiAgICAvLyByZXR1cm4gMAogICAgaW50Y18wIC8vIDAKCmRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2lubGluZWRfc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmNvbXBvdW5kUmV3YXJkc0ZvclVzZXJAMTI6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM5NQogICAgLy8gdG90YWxEaXN0cmlidXRlZCA9IHRvdGFsRGlzdHJpYnV0ZWQgKyByZXdhcmRzQ29tcG91bmRlZAogICAgZnJhbWVfZGlnIDUKICAgICsKICAgIGZyYW1lX2J1cnkgNQogICAgZnJhbWVfZGlnIDYKICAgIGludGNfMSAvLyAxCiAgICArCiAgICBmcmFtZV9idXJ5IDYKICAgIGIgZGlzdHJpYnV0ZVJld2FyZHNfZm9yX2hlYWRlckAxCgpkaXN0cmlidXRlUmV3YXJkc19hZnRlcl9pZl9lbHNlQDc6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM0NQogICAgLy8gY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIDEKICAgIGNhbGxzdWIgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMKICAgIGR1cAogICAgZnJhbWVfYnVyeSAyCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM0OAogICAgLy8gaWYgKHBlbmRpbmdSZXdhcmRzID09PSAwKSB7CiAgICBibnogZGlzdHJpYnV0ZVJld2FyZHNfYWZ0ZXJfaWZfZWxzZUA5CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM0OQogICAgLy8gcmV0dXJuIDAKICAgIGludGNfMCAvLyAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM5NAogICAgLy8gY29uc3QgcmV3YXJkc0NvbXBvdW5kZWQgPSB0aGlzLmNvbXBvdW5kUmV3YXJkc0ZvclVzZXIoc3Rha2VyLm5hdGl2ZSkKICAgIGIgZGlzdHJpYnV0ZVJld2FyZHNfYWZ0ZXJfaW5saW5lZF9zbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QuY29tcG91bmRSZXdhcmRzRm9yVXNlckAxMgoKZGlzdHJpYnV0ZVJld2FyZHNfYWZ0ZXJfaWZfZWxzZUA5OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMCAvLyAicmV3YXJkUG9vbCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM1MwogICAgLy8gaWYgKHRoaXMucmV3YXJkUG9vbC52YWx1ZSA8IHBlbmRpbmdSZXdhcmRzKSB7CiAgICBmcmFtZV9kaWcgMgogICAgPAogICAgYnogZGlzdHJpYnV0ZVJld2FyZHNfYWZ0ZXJfaWZfZWxzZUAxMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNTQKICAgIC8vIHJldHVybiAwCiAgICBpbnRjXzAgLy8gMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozOTQKICAgIC8vIGNvbnN0IHJld2FyZHNDb21wb3VuZGVkID0gdGhpcy5jb21wb3VuZFJld2FyZHNGb3JVc2VyKHN0YWtlci5uYXRpdmUpCiAgICBiIGRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2lubGluZWRfc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmNvbXBvdW5kUmV3YXJkc0ZvclVzZXJAMTIKCmRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2lmX2Vsc2VAMTE6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM1OAogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBwZW5kaW5nUmV3YXJkcykKICAgIGZyYW1lX2RpZyAzCiAgICBmcmFtZV9kaWcgMgogICAgZHVwCiAgICBjb3ZlciAyCiAgICArCiAgICBpdG9iCiAgICBmcmFtZV9kaWcgMAogICAgc3dhcAogICAgcmVwbGFjZTIgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNjEKICAgIC8vIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICBkdXAKICAgIHB1c2hpbnQgMTYgLy8gMTYKICAgIGV4dHJhY3RfdWludDY0CiAgICBkaWcgMgogICAgKwogICAgaXRvYgogICAgcmVwbGFjZTIgMTYKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzY0CiAgICAvLyBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QgPSBuZXcgYXJjNC5VaW50TjY0KHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpKQogICAgY2FsbHN1YiBnZXRDdXJyZW50UGVyaW9kCiAgICBpdG9iCiAgICByZXBsYWNlMiAyNAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNjcKICAgIC8vIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICBmcmFtZV9kaWcgMQogICAgc3dhcAogICAgY2FsbHN1YiBzdG9yZVVzZXJTdGFrZUluZm8KICAgIHBvcAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzMgLy8gInRvdGFsU3Rha2VkIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6MzcwCiAgICAvLyB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICBkaWcgMQogICAgKwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWNfMyAvLyAidG90YWxTdGFrZWQiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM3MAogICAgLy8gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUgKyBwZW5kaW5nUmV3YXJkcwogICAgc3dhcAogICAgYXBwX2dsb2JhbF9wdXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNzEKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICBkaWcgMQogICAgLQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlY18wIC8vICJyZXdhcmRQb29sIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozNzEKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICBzd2FwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czozOTQKICAgIC8vIGNvbnN0IHJld2FyZHNDb21wb3VuZGVkID0gdGhpcy5jb21wb3VuZFJld2FyZHNGb3JVc2VyKHN0YWtlci5uYXRpdmUpCiAgICBiIGRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2lubGluZWRfc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmNvbXBvdW5kUmV3YXJkc0ZvclVzZXJAMTIKCmRpc3RyaWJ1dGVSZXdhcmRzX2FmdGVyX2ZvckA0OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgYnl0ZWMgNiAvLyAibGFzdERpc3RyaWJ1dGlvblRpbWUiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjM5OQogICAgLy8gdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIGdsb2JhbCBMYXRlc3RUaW1lc3RhbXAKICAgIGFwcF9nbG9iYWxfcHV0CiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QuZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYnl0ZXMpIC0+IHVpbnQ2NDoKZ2V0QWN0aXZlU3Rha2Vyc0NvdW50OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MDYtNDA3CiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRBY3RpdmVTdGFrZXJzQ291bnQoc3Rha2VyQWRkcmVzc2VzOiBhcmM0LkFkZHJlc3NbXSk6IHVpbnQ2NCB7CiAgICBwcm90byAxIDEKICAgIHB1c2hieXRlcyAiIgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0MDgKICAgIC8vIGxldCBhY3RpdmVDb3VudDogdWludDY0ID0gMAogICAgaW50Y18wIC8vIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDEwCiAgICAvLyBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIGZyYW1lX2RpZyAtMQogICAgaW50Y18wIC8vIDAKICAgIGV4dHJhY3RfdWludDE2CiAgICBpbnRjXzAgLy8gMAoKZ2V0QWN0aXZlU3Rha2Vyc0NvdW50X2Zvcl9oZWFkZXJAMToKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDEwCiAgICAvLyBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIGZyYW1lX2RpZyAzCiAgICBmcmFtZV9kaWcgMgogICAgPAogICAgYnogZ2V0QWN0aXZlU3Rha2Vyc0NvdW50X2FmdGVyX2ZvckA2CiAgICBmcmFtZV9kaWcgLTEKICAgIGV4dHJhY3QgMiAwCiAgICBmcmFtZV9kaWcgMwogICAgcHVzaGludCAzMiAvLyAzMgogICAgKgogICAgcHVzaGludCAzMiAvLyAzMgogICAgZXh0cmFjdDMgLy8gb24gZXJyb3I6IEluZGV4IGFjY2VzcyBpcyBvdXQgb2YgYm91bmRzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQxMQogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHN0YWtlci5uYXRpdmUpCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDEyCiAgICAvLyBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIGZyYW1lX2RpZyAxCiAgICBmcmFtZV9idXJ5IDAKICAgIGJ6IGdldEFjdGl2ZVN0YWtlcnNDb3VudF9hZnRlcl9pZl9lbHNlQDQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDEzCiAgICAvLyBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgZnJhbWVfZGlnIDEKICAgIGludGNfMSAvLyAxCiAgICArCiAgICBmcmFtZV9idXJ5IDAKCmdldEFjdGl2ZVN0YWtlcnNDb3VudF9hZnRlcl9pZl9lbHNlQDQ6CiAgICBmcmFtZV9kaWcgMAogICAgZnJhbWVfYnVyeSAxCiAgICBmcmFtZV9kaWcgMwogICAgaW50Y18xIC8vIDEKICAgICsKICAgIGZyYW1lX2J1cnkgMwogICAgYiBnZXRBY3RpdmVTdGFrZXJzQ291bnRfZm9yX2hlYWRlckAxCgpnZXRBY3RpdmVTdGFrZXJzQ291bnRfYWZ0ZXJfZm9yQDY6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQxNwogICAgLy8gcmV0dXJuIGFjdGl2ZUNvdW50CiAgICBmcmFtZV9kaWcgMQogICAgZnJhbWVfYnVyeSAwCiAgICByZXRzdWIKCgovLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjpBU0FTdGFraW5nQ29udHJhY3QudXBkYXRlQVBSKG5ld0FwckJhc2lzUG9pbnRzOiB1aW50NjQpIC0+IHZvaWQ6CnVwZGF0ZUFQUjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDI0LTQyNQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdXBkYXRlQVBSKG5ld0FwckJhc2lzUG9pbnRzOiB1aW50NjQpOiB2b2lkIHsKICAgIHByb3RvIDEgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OQogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQyOAogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIHVwZGF0ZSBBUFInKQogICAgdHhuIFNlbmRlcgogICAgPT0KICAgIGFzc2VydCAvLyBPbmx5IGFkbWluIGNhbiB1cGRhdGUgQVBSCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUxCiAgICAvLyBwdWJsaWMgYXByQmFzaXNQb2ludHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBieXRlYyA1IC8vICJhcHJCYXNpc1BvaW50cyIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDMxCiAgICAvLyB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIGZyYW1lX2RpZyAtMQogICAgYXBwX2dsb2JhbF9wdXQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC51cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IGJ5dGVzKSAtPiB2b2lkOgp1cGRhdGVBZG1pbjoKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDM4LTQzOQogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgdXBkYXRlQWRtaW4obmV3QWRtaW5BZGRyZXNzOiBBY2NvdW50KTogdm9pZCB7CiAgICBwcm90byAxIDAKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDkKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18yIC8vICJhZG1pbkFkZHJlc3MiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NDIKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4nKQogICAgdHhuIFNlbmRlcgogICAgPT0KICAgIGFzc2VydCAvLyBPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDkKICAgIC8vIHB1YmxpYyBhZG1pbkFkZHJlc3MgPSBHbG9iYWxTdGF0ZTxBY2NvdW50Pih7IGluaXRpYWxWYWx1ZTogQWNjb3VudCgpfSkKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDQ1CiAgICAvLyB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgZnJhbWVfZGlnIC0xCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogYnl0ZXMpIC0+IGJ5dGVzOgpnZXRVc2VyU3RhdHM6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1MS00NTIKICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgcHJvdG8gMSAxCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1MwogICAgLy8gY29uc3Qgc3Rha2VJbmZvID0gdGhpcy5nZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzKQogICAgZnJhbWVfZGlnIC0xCiAgICBjYWxsc3ViIGdldFVzZXJTdGFrZUluZm8KICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU0CiAgICAvLyBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU3CiAgICAvLyBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIGRpZyAxCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU4CiAgICAvLyBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICBkaWcgMgogICAgaW50Y18zIC8vIDgKICAgIGV4dHJhY3RfdWludDY0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1OQogICAgLy8gc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICBkaWcgMwogICAgcHVzaGludCAxNiAvLyAxNgogICAgZXh0cmFjdF91aW50NjQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDYxCiAgICAvLyBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgdW5jb3ZlciA0CiAgICBwdXNoaW50IDI0IC8vIDI0CiAgICBleHRyYWN0X3VpbnQ2NAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NTcKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgdW5jb3ZlciAzCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1OAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgdW5jb3ZlciAzCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1Ny00NjEKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyBwZW5kaW5nUmV3YXJkcywKICAgIC8vIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUsCiAgICBjb25jYXQKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU5CiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIHVuY292ZXIgMgogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NTctNDYxCiAgICAvLyBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gcGVuZGluZ1Jld2FyZHMsCiAgICAvLyBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ2MAogICAgLy8gcGVuZGluZ1Jld2FyZHMsCiAgICB1bmNvdmVyIDIKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NDU3LTQ2MQogICAgLy8gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUsCiAgICAvLyBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kLm5hdGl2ZSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjEKICAgIC8vIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUsCiAgICBzd2FwCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ1Ny00NjEKICAgIC8vIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gc3Rha2VJbmZvLnRvdGFsUmV3YXJkc0Vhcm5lZC5uYXRpdmUsCiAgICAvLyBwZW5kaW5nUmV3YXJkcywKICAgIC8vIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUsCiAgICBjb25jYXQKICAgIGR1cAogICAgbGVuCiAgICBpbnRjXzMgLy8gOAogICAgLwogICAgaXRvYgogICAgZXh0cmFjdCA2IDIKICAgIHN3YXAKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0NjQKICAgIC8vIHJldHVybiByZXN1bHQKICAgIHJldHN1YgoKCi8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6OkFTQVN0YWtpbmdDb250cmFjdC5nZXRDb250cmFjdFN0YXRzKCkgLT4gYnl0ZXM6CmdldENvbnRyYWN0U3RhdHM6CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4CiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlY18xIC8vICJhc3NldCIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwCiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMyAvLyAidG90YWxTdGFrZWQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjIDUgLy8gImFwckJhc2lzUG9pbnRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTIKICAgIC8vIHB1YmxpYyBsYXN0RGlzdHJpYnV0aW9uVGltZSA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA2IC8vICJsYXN0RGlzdHJpYnV0aW9uVGltZSIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGludGNfMCAvLyAwCiAgICBieXRlYyA3IC8vICJkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTQKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWMgOCAvLyAibWluaW11bVN0YWtlIgogICAgYXBwX2dsb2JhbF9nZXRfZXgKICAgIGFzc2VydCAvLyBjaGVjayBHbG9iYWxTdGF0ZSBleGlzdHMKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0ODAKICAgIC8vIHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpLAogICAgY2FsbHN1YiBnZXRDdXJyZW50UGVyaW9kCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4CiAgICAvLyBwdWJsaWMgYXNzZXQgPSBHbG9iYWxTdGF0ZTxBc3NldD4oeyBpbml0aWFsVmFsdWU6IEFzc2V0KCkgfSkKICAgIHVuY292ZXIgNwogICAgaXRvYgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciA3CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTQ4MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdENsYWltZWRQZXJpb2Q6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGRpc3RyaWJ1dGlvbiBwZXJpb2QKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldEN1cnJlbnRQZXJpb2QoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gICBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIC8vICAgcmV0dXJuIEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgLyBwZXJpb2RTZWNvbmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUgPSBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGluaXRpYWwgY2xhaW0gcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgbGFzdCBkaXN0cmlidXRpb24gdGltZQogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIgZm9yIGEgZ2l2ZW4gcGVyaW9kCiAgICAvLyAgKiBUaGlzIGNhbGN1bGF0ZXMgcmV3YXJkcyBwZXIgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IGFwciA9IHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgIGNvbnN0IHBlcmlvZFNlY29uZHMgPSB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBJZiBubyB0b3RhbCBzdGFrZSBvciBubyBwZXJpb2QgZGVmaW5lZCwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwIHx8IHBlcmlvZFNlY29uZHMgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSB1c2VyJ3Mgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgdXNlciBoYXMgbm8gc3Rha2UsIHJldHVybiAwCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdXNlcidzIHN0YWtlIGFtb3VudCBhbmQgbGFzdCBzdGFrZSB0aW1lCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGxhc3RTdGFrZVRpbWUgPSBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiB1c2VyIGhhcyBiZWVuIHN0YWtlZCBmb3IgdGhlIG1pbmltdW0gcGVyaW9kCiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZVRpbWU6IHVpbnQ2NCA9IDg2NDAwIC8vIDI0IGhvdXJzIGluIHNlY29uZHMKICAgIC8vICAgaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHJhdGUgZm9yIHRoZSBwZXJpb2QKICAgIC8vICAgLy8gQVBSIGlzIGluIGJhc2lzIHBvaW50cyAoZS5nLiwgNTAwID0gNSUpCiAgICAvLyAgIC8vIENvbnZlcnQgQVBSIHRvIHBlcmlvZCByYXRlOiAoQVBSIC8gMTAwMDApICogKHBlcmlvZFNlY29uZHMgLyAzMTUzNjAwMCkKICAgIC8vICAgLy8gd2hlcmUgMzE1MzYwMDAgaXMgc2Vjb25kcyBpbiBhIHllYXIKICAgIC8vICAgY29uc3QgeWVhckluU2Vjb25kczogdWludDY0ID0gMzE1MzYwMDAKICAgIC8vICAgY29uc3QgcGVyaW9kUmF0ZU51bWVyYXRvcjogdWludDY0ID0gYXByICogcGVyaW9kU2Vjb25kcwogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlRGVub21pbmF0b3I6IHVpbnQ2NCA9IDEwMDAwICogeWVhckluU2Vjb25kcwogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQ6IHVzZXJTdGFrZSAqIHBlcmlvZFJhdGUKICAgIC8vICAgY29uc3QgcmV3YXJkOiB1aW50NjQgPSAodXNlclN0YWtlICogcGVyaW9kUmF0ZU51bWVyYXRvcikgLyBwZXJpb2RSYXRlRGVub21pbmF0b3IKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyIHNpbmNlIHRoZWlyIGxhc3QgY2xhaW0KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IGN1cnJlbnRQZXJpb2QgPSB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKQogICAgLy8gICBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVyaW9kcyBzaW5jZSBsYXN0IGNsYWltCiAgICAvLyAgIGNvbnN0IHBlcmlvZHNTaW5jZUxhc3RDbGFpbTogdWludDY0ID0gY3VycmVudFBlcmlvZCA+IGxhc3RDbGFpbWVkUGVyaW9kID8gY3VycmVudFBlcmlvZCAtIGxhc3RDbGFpbWVkUGVyaW9kIDogMAogICAgLy8gCiAgICAvLyAgIGlmIChwZXJpb2RzU2luY2VMYXN0Q2xhaW0gPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZCBwZXIgcGVyaW9kCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMuY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QodXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb21wb3VuZCByZXdhcmRzIGZvciBhIHNpbmdsZSB1c2VyCiAgICAvLyAgKiBVc2VkIGJ5IHRoZSBhdXRvbWF0ZWQgZGlzdHJpYnV0aW9uIHN5c3RlbQogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNvbXBvdW5kUmV3YXJkc0ZvclVzZXIodXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiB1c2VyIGhhcyBubyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiBubyByZXdhcmRzIHRvIGNvbXBvdW5kCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHJld2FyZCBwb29sIGhhcyBpbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRoaXMgdXNlcgogICAgLy8gICBpZiAodGhpcy5yZXdhcmRQb29sLnZhbHVlIDwgcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQXV0by1jb21wb3VuZDogQWRkIHJld2FyZHMgdG8gc3Rha2VkIGFtb3VudAogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB0b3RhbCByZXdhcmRzIGVhcm5lZAogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGNsYWltZWQgcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZCA9IG5ldyBhcmM0LlVpbnRONjQodGhpcy5nZXRDdXJyZW50UGVyaW9kKCkpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogRGlzdHJpYnV0ZSBhbmQgY29tcG91bmQgcmV3YXJkcyBmb3IgbXVsdGlwbGUgc3Rha2VycwogICAgLy8gICogVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgY2FsbGVkIGJ5IGEgY3JvbiBqb2Igb24gYSBkYWlseSBiYXNpcwogICAgLy8gICogT25seSBhZG1pbiBjYW4gY2FsbCB0aGlzIG1ldGhvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGFyYzQuQWRkcmVzc1tdKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBkaXN0cmlidXRlIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHdlIGRvbid0IHByb2Nlc3MgdG9vIG1hbnkgc3Rha2VycyBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IHByb3RlY3Rpb24pCiAgICAvLyAgIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgLy8gCiAgICAvLyAgIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gUHJvY2VzcyBlYWNoIHN0YWtlcgogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCByZXdhcmRzQ29tcG91bmRlZCA9IHRoaXMuY29tcG91bmRSZXdhcmRzRm9yVXNlcihzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIHRvdGFsRGlzdHJpYnV0ZWQgPSB0b3RhbERpc3RyaWJ1dGVkICsgcmV3YXJkc0NvbXBvdW5kZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGFsbCBub24temVybyBzdGFrZXJzIGNvdW50IChmb3IgbW9uaXRvcmluZyBwdXJwb3NlcykKICAgIC8vICAqIE5vdGU6IFRoaXMgZG9lc24ndCByZXR1cm4gdGhlIGFjdHVhbCBhZGRyZXNzZXMgZHVlIHRvIGJveCBpdGVyYXRpb24gbGltaXRhdGlvbnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB1aW50NjQgewogICAgLy8gICBsZXQgYWN0aXZlQ291bnQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc3Rha2VyLm5hdGl2ZSkKICAgIC8vICAgICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgICBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIHJldHVybiBhY3RpdmVDb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgQVBSIGJhc2lzIHBvaW50cwogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBUFIobmV3QXByQmFzaXNQb2ludHM6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIEFQUgogICAgLy8gICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUsCiAgICAvLyAgICAgdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlLAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciA2CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTQ4MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdENsYWltZWRQZXJpb2Q6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGRpc3RyaWJ1dGlvbiBwZXJpb2QKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldEN1cnJlbnRQZXJpb2QoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gICBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIC8vICAgcmV0dXJuIEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgLyBwZXJpb2RTZWNvbmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUgPSBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGluaXRpYWwgY2xhaW0gcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgbGFzdCBkaXN0cmlidXRpb24gdGltZQogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIgZm9yIGEgZ2l2ZW4gcGVyaW9kCiAgICAvLyAgKiBUaGlzIGNhbGN1bGF0ZXMgcmV3YXJkcyBwZXIgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IGFwciA9IHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgIGNvbnN0IHBlcmlvZFNlY29uZHMgPSB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBJZiBubyB0b3RhbCBzdGFrZSBvciBubyBwZXJpb2QgZGVmaW5lZCwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwIHx8IHBlcmlvZFNlY29uZHMgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSB1c2VyJ3Mgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgdXNlciBoYXMgbm8gc3Rha2UsIHJldHVybiAwCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdXNlcidzIHN0YWtlIGFtb3VudCBhbmQgbGFzdCBzdGFrZSB0aW1lCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGxhc3RTdGFrZVRpbWUgPSBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiB1c2VyIGhhcyBiZWVuIHN0YWtlZCBmb3IgdGhlIG1pbmltdW0gcGVyaW9kCiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZVRpbWU6IHVpbnQ2NCA9IDg2NDAwIC8vIDI0IGhvdXJzIGluIHNlY29uZHMKICAgIC8vICAgaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHJhdGUgZm9yIHRoZSBwZXJpb2QKICAgIC8vICAgLy8gQVBSIGlzIGluIGJhc2lzIHBvaW50cyAoZS5nLiwgNTAwID0gNSUpCiAgICAvLyAgIC8vIENvbnZlcnQgQVBSIHRvIHBlcmlvZCByYXRlOiAoQVBSIC8gMTAwMDApICogKHBlcmlvZFNlY29uZHMgLyAzMTUzNjAwMCkKICAgIC8vICAgLy8gd2hlcmUgMzE1MzYwMDAgaXMgc2Vjb25kcyBpbiBhIHllYXIKICAgIC8vICAgY29uc3QgeWVhckluU2Vjb25kczogdWludDY0ID0gMzE1MzYwMDAKICAgIC8vICAgY29uc3QgcGVyaW9kUmF0ZU51bWVyYXRvcjogdWludDY0ID0gYXByICogcGVyaW9kU2Vjb25kcwogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlRGVub21pbmF0b3I6IHVpbnQ2NCA9IDEwMDAwICogeWVhckluU2Vjb25kcwogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQ6IHVzZXJTdGFrZSAqIHBlcmlvZFJhdGUKICAgIC8vICAgY29uc3QgcmV3YXJkOiB1aW50NjQgPSAodXNlclN0YWtlICogcGVyaW9kUmF0ZU51bWVyYXRvcikgLyBwZXJpb2RSYXRlRGVub21pbmF0b3IKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyIHNpbmNlIHRoZWlyIGxhc3QgY2xhaW0KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IGN1cnJlbnRQZXJpb2QgPSB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKQogICAgLy8gICBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVyaW9kcyBzaW5jZSBsYXN0IGNsYWltCiAgICAvLyAgIGNvbnN0IHBlcmlvZHNTaW5jZUxhc3RDbGFpbTogdWludDY0ID0gY3VycmVudFBlcmlvZCA+IGxhc3RDbGFpbWVkUGVyaW9kID8gY3VycmVudFBlcmlvZCAtIGxhc3RDbGFpbWVkUGVyaW9kIDogMAogICAgLy8gCiAgICAvLyAgIGlmIChwZXJpb2RzU2luY2VMYXN0Q2xhaW0gPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZCBwZXIgcGVyaW9kCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMuY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QodXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb21wb3VuZCByZXdhcmRzIGZvciBhIHNpbmdsZSB1c2VyCiAgICAvLyAgKiBVc2VkIGJ5IHRoZSBhdXRvbWF0ZWQgZGlzdHJpYnV0aW9uIHN5c3RlbQogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNvbXBvdW5kUmV3YXJkc0ZvclVzZXIodXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiB1c2VyIGhhcyBubyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiBubyByZXdhcmRzIHRvIGNvbXBvdW5kCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHJld2FyZCBwb29sIGhhcyBpbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRoaXMgdXNlcgogICAgLy8gICBpZiAodGhpcy5yZXdhcmRQb29sLnZhbHVlIDwgcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQXV0by1jb21wb3VuZDogQWRkIHJld2FyZHMgdG8gc3Rha2VkIGFtb3VudAogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB0b3RhbCByZXdhcmRzIGVhcm5lZAogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGNsYWltZWQgcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZCA9IG5ldyBhcmM0LlVpbnRONjQodGhpcy5nZXRDdXJyZW50UGVyaW9kKCkpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogRGlzdHJpYnV0ZSBhbmQgY29tcG91bmQgcmV3YXJkcyBmb3IgbXVsdGlwbGUgc3Rha2VycwogICAgLy8gICogVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgY2FsbGVkIGJ5IGEgY3JvbiBqb2Igb24gYSBkYWlseSBiYXNpcwogICAgLy8gICogT25seSBhZG1pbiBjYW4gY2FsbCB0aGlzIG1ldGhvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGFyYzQuQWRkcmVzc1tdKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBkaXN0cmlidXRlIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHdlIGRvbid0IHByb2Nlc3MgdG9vIG1hbnkgc3Rha2VycyBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IHByb3RlY3Rpb24pCiAgICAvLyAgIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgLy8gCiAgICAvLyAgIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gUHJvY2VzcyBlYWNoIHN0YWtlcgogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCByZXdhcmRzQ29tcG91bmRlZCA9IHRoaXMuY29tcG91bmRSZXdhcmRzRm9yVXNlcihzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIHRvdGFsRGlzdHJpYnV0ZWQgPSB0b3RhbERpc3RyaWJ1dGVkICsgcmV3YXJkc0NvbXBvdW5kZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGFsbCBub24temVybyBzdGFrZXJzIGNvdW50IChmb3IgbW9uaXRvcmluZyBwdXJwb3NlcykKICAgIC8vICAqIE5vdGU6IFRoaXMgZG9lc24ndCByZXR1cm4gdGhlIGFjdHVhbCBhZGRyZXNzZXMgZHVlIHRvIGJveCBpdGVyYXRpb24gbGltaXRhdGlvbnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB1aW50NjQgewogICAgLy8gICBsZXQgYWN0aXZlQ291bnQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc3Rha2VyLm5hdGl2ZSkKICAgIC8vICAgICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgICBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIHJldHVybiBhY3RpdmVDb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgQVBSIGJhc2lzIHBvaW50cwogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBUFIobmV3QXByQmFzaXNQb2ludHM6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIEFQUgogICAgLy8gICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUsCiAgICAvLyAgICAgdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlLAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MgogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciA1CiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTQ4MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdENsYWltZWRQZXJpb2Q6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGRpc3RyaWJ1dGlvbiBwZXJpb2QKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldEN1cnJlbnRQZXJpb2QoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gICBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIC8vICAgcmV0dXJuIEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgLyBwZXJpb2RTZWNvbmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUgPSBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGluaXRpYWwgY2xhaW0gcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgbGFzdCBkaXN0cmlidXRpb24gdGltZQogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIgZm9yIGEgZ2l2ZW4gcGVyaW9kCiAgICAvLyAgKiBUaGlzIGNhbGN1bGF0ZXMgcmV3YXJkcyBwZXIgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IGFwciA9IHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgIGNvbnN0IHBlcmlvZFNlY29uZHMgPSB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBJZiBubyB0b3RhbCBzdGFrZSBvciBubyBwZXJpb2QgZGVmaW5lZCwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwIHx8IHBlcmlvZFNlY29uZHMgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSB1c2VyJ3Mgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgdXNlciBoYXMgbm8gc3Rha2UsIHJldHVybiAwCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdXNlcidzIHN0YWtlIGFtb3VudCBhbmQgbGFzdCBzdGFrZSB0aW1lCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGxhc3RTdGFrZVRpbWUgPSBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiB1c2VyIGhhcyBiZWVuIHN0YWtlZCBmb3IgdGhlIG1pbmltdW0gcGVyaW9kCiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZVRpbWU6IHVpbnQ2NCA9IDg2NDAwIC8vIDI0IGhvdXJzIGluIHNlY29uZHMKICAgIC8vICAgaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHJhdGUgZm9yIHRoZSBwZXJpb2QKICAgIC8vICAgLy8gQVBSIGlzIGluIGJhc2lzIHBvaW50cyAoZS5nLiwgNTAwID0gNSUpCiAgICAvLyAgIC8vIENvbnZlcnQgQVBSIHRvIHBlcmlvZCByYXRlOiAoQVBSIC8gMTAwMDApICogKHBlcmlvZFNlY29uZHMgLyAzMTUzNjAwMCkKICAgIC8vICAgLy8gd2hlcmUgMzE1MzYwMDAgaXMgc2Vjb25kcyBpbiBhIHllYXIKICAgIC8vICAgY29uc3QgeWVhckluU2Vjb25kczogdWludDY0ID0gMzE1MzYwMDAKICAgIC8vICAgY29uc3QgcGVyaW9kUmF0ZU51bWVyYXRvcjogdWludDY0ID0gYXByICogcGVyaW9kU2Vjb25kcwogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlRGVub21pbmF0b3I6IHVpbnQ2NCA9IDEwMDAwICogeWVhckluU2Vjb25kcwogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQ6IHVzZXJTdGFrZSAqIHBlcmlvZFJhdGUKICAgIC8vICAgY29uc3QgcmV3YXJkOiB1aW50NjQgPSAodXNlclN0YWtlICogcGVyaW9kUmF0ZU51bWVyYXRvcikgLyBwZXJpb2RSYXRlRGVub21pbmF0b3IKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyIHNpbmNlIHRoZWlyIGxhc3QgY2xhaW0KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IGN1cnJlbnRQZXJpb2QgPSB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKQogICAgLy8gICBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVyaW9kcyBzaW5jZSBsYXN0IGNsYWltCiAgICAvLyAgIGNvbnN0IHBlcmlvZHNTaW5jZUxhc3RDbGFpbTogdWludDY0ID0gY3VycmVudFBlcmlvZCA+IGxhc3RDbGFpbWVkUGVyaW9kID8gY3VycmVudFBlcmlvZCAtIGxhc3RDbGFpbWVkUGVyaW9kIDogMAogICAgLy8gCiAgICAvLyAgIGlmIChwZXJpb2RzU2luY2VMYXN0Q2xhaW0gPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZCBwZXIgcGVyaW9kCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMuY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QodXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb21wb3VuZCByZXdhcmRzIGZvciBhIHNpbmdsZSB1c2VyCiAgICAvLyAgKiBVc2VkIGJ5IHRoZSBhdXRvbWF0ZWQgZGlzdHJpYnV0aW9uIHN5c3RlbQogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNvbXBvdW5kUmV3YXJkc0ZvclVzZXIodXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiB1c2VyIGhhcyBubyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiBubyByZXdhcmRzIHRvIGNvbXBvdW5kCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHJld2FyZCBwb29sIGhhcyBpbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRoaXMgdXNlcgogICAgLy8gICBpZiAodGhpcy5yZXdhcmRQb29sLnZhbHVlIDwgcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQXV0by1jb21wb3VuZDogQWRkIHJld2FyZHMgdG8gc3Rha2VkIGFtb3VudAogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB0b3RhbCByZXdhcmRzIGVhcm5lZAogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGNsYWltZWQgcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZCA9IG5ldyBhcmM0LlVpbnRONjQodGhpcy5nZXRDdXJyZW50UGVyaW9kKCkpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogRGlzdHJpYnV0ZSBhbmQgY29tcG91bmQgcmV3YXJkcyBmb3IgbXVsdGlwbGUgc3Rha2VycwogICAgLy8gICogVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgY2FsbGVkIGJ5IGEgY3JvbiBqb2Igb24gYSBkYWlseSBiYXNpcwogICAgLy8gICogT25seSBhZG1pbiBjYW4gY2FsbCB0aGlzIG1ldGhvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGFyYzQuQWRkcmVzc1tdKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBkaXN0cmlidXRlIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHdlIGRvbid0IHByb2Nlc3MgdG9vIG1hbnkgc3Rha2VycyBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IHByb3RlY3Rpb24pCiAgICAvLyAgIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgLy8gCiAgICAvLyAgIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gUHJvY2VzcyBlYWNoIHN0YWtlcgogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCByZXdhcmRzQ29tcG91bmRlZCA9IHRoaXMuY29tcG91bmRSZXdhcmRzRm9yVXNlcihzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIHRvdGFsRGlzdHJpYnV0ZWQgPSB0b3RhbERpc3RyaWJ1dGVkICsgcmV3YXJkc0NvbXBvdW5kZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGFsbCBub24temVybyBzdGFrZXJzIGNvdW50IChmb3IgbW9uaXRvcmluZyBwdXJwb3NlcykKICAgIC8vICAqIE5vdGU6IFRoaXMgZG9lc24ndCByZXR1cm4gdGhlIGFjdHVhbCBhZGRyZXNzZXMgZHVlIHRvIGJveCBpdGVyYXRpb24gbGltaXRhdGlvbnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB1aW50NjQgewogICAgLy8gICBsZXQgYWN0aXZlQ291bnQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc3Rha2VyLm5hdGl2ZSkKICAgIC8vICAgICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgICBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIHJldHVybiBhY3RpdmVDb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgQVBSIGJhc2lzIHBvaW50cwogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBUFIobmV3QXByQmFzaXNQb2ludHM6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIEFQUgogICAgLy8gICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUsCiAgICAvLyAgICAgdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlLAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MwogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICB1bmNvdmVyIDQKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNDgwCiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgYXByQmFzaXNQb2ludHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbGFzdERpc3RyaWJ1dGlvblRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byByZWFkIHVzZXIgc3Rha2UgaW5mbyBmcm9tIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBnZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogVXNlclN0YWtlSW5mbyB7CiAgICAvLyAgIGNvbnN0IHVzZXJCb3ggPSB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHVzZXJCb3guZXhpc3RzKSB7CiAgICAvLyAgICAgcmV0dXJuIHVzZXJCb3gudmFsdWUuY29weSgpCiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgcmV0dXJuIG5ldyBVc2VyU3Rha2VJbmZvKHsKICAgIC8vICAgICAgIHN0YWtlZEFtb3VudDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGxhc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICB0b3RhbFJld2FyZHNFYXJuZWQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0Q2xhaW1lZFBlcmlvZDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICB9KQogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHN0b3JlIHVzZXIgc3Rha2UgaW5mbyBpbiBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIC8vICAgdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKS52YWx1ZSA9IHN0YWtlSW5mby5jb3B5KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudFBlcmlvZCgpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBwZXJpb2RTZWNvbmRzID0gdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlCiAgICAvLyAgIGlmIChwZXJpb2RTZWNvbmRzID09PSAwKSByZXR1cm4gMAogICAgLy8gICByZXR1cm4gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCAvIHBlcmlvZFNlY29uZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBJbml0aWFsaXplIHRoZSBjb250cmFjdCB3aXRoIHRoZSBBU0EgdG9rZW4gSUQgYW5kIG90aGVyIHBhcmFtZXRlcnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgaW5pdGlhbGl6ZSgKICAgIC8vICAgYXNzZXQ6IEFzc2V0LAogICAgLy8gICBhZG1pbkFkZHJlc3M6IEFjY291bnQsCiAgICAvLyAgIGFwckJhc2lzUG9pbnRzOiB1aW50NjQsCiAgICAvLyAgIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHM6IHVpbnQ2NCwKICAgIC8vICAgbWluaW11bVN0YWtlOiB1aW50NjQsCiAgICAvLyApOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgaXMgb25seSBjYWxsZWQgZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlID09PSBBc3NldCgpLCAnQWxyZWFkeSBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3IgY2FuIGluaXRpYWxpemUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcywgJ09ubHkgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZScpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdGhlIGluaXRpYWwgcGFyYW1ldGVycwogICAgLy8gICB0aGlzLmFzc2V0LnZhbHVlID0gYXNzZXQKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBhZG1pbkFkZHJlc3MKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5hcHJCYXNpc1BvaW50cy52YWx1ZSA9IGFwckJhc2lzUG9pbnRzCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZSA9IGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMKICAgIC8vICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUgPSBtaW5pbXVtU3Rha2UKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gMAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIG9wdEluVG9Bc3NldCgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluJykKICAgIC8vIAogICAgLy8gICAvLyBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogU3Rha2UgdG9rZW5zCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgc3Rha2UoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGUgY29udHJhY3QgaGFzIG9wdGVkIGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgIT09IEFzc2V0KCksICdDb250cmFjdCBub3QgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHN0YWtlIGFtb3VudCBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgLy8gICBjb25zdCBzdGFrZUFtb3VudCA9IHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgdXNlciBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIElmIHRoaXMgaXMgYSBuZXcgc3Rha2UsIGVuc3VyZSBpdCBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICAgIC8vIFNldCB0aGUgaW5pdGlhbCBjbGFpbSBwZXJpb2QgdG8gY3VycmVudCBwZXJpb2QKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QgPSBuZXcgYXJjNC5VaW50TjY0KHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBXaXRoZHJhdyBzdGFrZWQgdG9rZW5zCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBlbm91Z2ggc3Rha2VkCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPD0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsICdXaXRoZHJhd2FsIGFtb3VudCBleGNlZWRzIHN0YWtlJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA+IDAsICdXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlJykKICAgIC8vIAogICAgLy8gICAvLyBJZiB3aXRoZHJhd2luZyBhbGwsIG5vIG5lZWQgdG8gY2hlY2sgbWluaW11bSByZW1haW5pbmcKICAgIC8vICAgLy8gSWYgcGFydGlhbCB3aXRoZHJhd2FsLCBlbnN1cmUgcmVtYWluaW5nIHN0YWtlIG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICAvLyAgICAgY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgICBhc3NlcnQocmVtYWluaW5nU3Rha2UgPj0gbWluaW11bVN0YWtlLCAnUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlIC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgdG9rZW5zIGJhY2sgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEFkZCByZXdhcmRzIHRvIHRoZSByZXdhcmQgcG9vbAogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggdGhlIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgYWRkUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggcmV3YXJkcwogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3QgcHJvdmlkZSBub24temVybyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gQWRkIHJld2FyZHMgdG8gdGhlIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHJld2FyZHMgZm9yIGEgc3BlY2lmaWMgdXNlciBmb3IgYSBnaXZlbiBwZXJpb2QKICAgIC8vICAqIFRoaXMgY2FsY3VsYXRlcyByZXdhcmRzIHBlciBkaXN0cmlidXRpb24gcGVyaW9kCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgY29uc3QgYXByID0gdGhpcy5hcHJCYXNpc1BvaW50cy52YWx1ZQogICAgLy8gICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIElmIG5vIHRvdGFsIHN0YWtlIG9yIG5vIHBlcmlvZCBkZWZpbmVkLCByZXR1cm4gMAogICAgLy8gICBpZiAodG90YWxTdGFrZWQgPT09IDAgfHwgcGVyaW9kU2Vjb25kcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHVzZXIncyBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB1c2VyIGhhcyBubyBzdGFrZSwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB1c2VyJ3Mgc3Rha2UgYW1vdW50IGFuZCBsYXN0IHN0YWtlIHRpbWUKICAgIC8vICAgY29uc3QgdXNlclN0YWtlID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUKICAgIC8vICAgY29uc3QgbGFzdFN0YWtlVGltZSA9IHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGJlZW4gc3Rha2VkIGZvciB0aGUgbWluaW11bSBwZXJpb2QKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlVGltZTogdWludDY0ID0gODY0MDAgLy8gMjQgaG91cnMgaW4gc2Vjb25kcwogICAgLy8gICBpZiAoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCA8IGxhc3RTdGFrZVRpbWUgKyBtaW5pbXVtU3Rha2VUaW1lKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQgcmF0ZSBmb3IgdGhlIHBlcmlvZAogICAgLy8gICAvLyBBUFIgaXMgaW4gYmFzaXMgcG9pbnRzIChlLmcuLCA1MDAgPSA1JSkKICAgIC8vICAgLy8gQ29udmVydCBBUFIgdG8gcGVyaW9kIHJhdGU6IChBUFIgLyAxMDAwMCkgKiAocGVyaW9kU2Vjb25kcyAvIDMxNTM2MDAwKQogICAgLy8gICAvLyB3aGVyZSAzMTUzNjAwMCBpcyBzZWNvbmRzIGluIGEgeWVhcgogICAgLy8gICBjb25zdCB5ZWFySW5TZWNvbmRzOiB1aW50NjQgPSAzMTUzNjAwMAogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlTnVtZXJhdG9yOiB1aW50NjQgPSBhcHIgKiBwZXJpb2RTZWNvbmRzCiAgICAvLyAgIGNvbnN0IHBlcmlvZFJhdGVEZW5vbWluYXRvcjogdWludDY0ID0gMTAwMDAgKiB5ZWFySW5TZWNvbmRzCiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZDogdXNlclN0YWtlICogcGVyaW9kUmF0ZQogICAgLy8gICBjb25zdCByZXdhcmQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBwZXJpb2RSYXRlTnVtZXJhdG9yKSAvIHBlcmlvZFJhdGVEZW5vbWluYXRvcgogICAgLy8gCiAgICAvLyAgIHJldHVybiByZXdhcmQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzIGZvciBhIHVzZXIgc2luY2UgdGhlaXIgbGFzdCBjbGFpbQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgY29uc3QgY3VycmVudFBlcmlvZCA9IHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpCiAgICAvLyAgIGNvbnN0IGxhc3RDbGFpbWVkUGVyaW9kID0gc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBwZXJpb2RzIHNpbmNlIGxhc3QgY2xhaW0KICAgIC8vICAgY29uc3QgcGVyaW9kc1NpbmNlTGFzdENsYWltOiB1aW50NjQgPSBjdXJyZW50UGVyaW9kID4gbGFzdENsYWltZWRQZXJpb2QgPyBjdXJyZW50UGVyaW9kIC0gbGFzdENsYWltZWRQZXJpb2QgOiAwCiAgICAvLyAKICAgIC8vICAgaWYgKHBlcmlvZHNTaW5jZUxhc3RDbGFpbSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHBlciBwZXJpb2QKICAgIC8vICAgY29uc3QgcmV3YXJkUGVyUGVyaW9kID0gdGhpcy5jYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkUGVyUGVyaW9kICogcGVyaW9kc1NpbmNlTGFzdENsYWltCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbXBvdW5kIHJld2FyZHMgZm9yIGEgc2luZ2xlIHVzZXIKICAgIC8vICAqIFVzZWQgYnkgdGhlIGF1dG9tYXRlZCBkaXN0cmlidXRpb24gc3lzdGVtCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgY29tcG91bmRSZXdhcmRzRm9yVXNlcih1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHVzZXIgaGFzIG5vIHN0YWtlCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIG5vIHJld2FyZHMgdG8gY29tcG91bmQKICAgIC8vICAgaWYgKHBlbmRpbmdSZXdhcmRzID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFNraXAgaWYgcmV3YXJkIHBvb2wgaGFzIGluc3VmZmljaWVudCBmdW5kcyBmb3IgdGhpcyB1c2VyCiAgICAvLyAgIGlmICh0aGlzLnJld2FyZFBvb2wudmFsdWUgPCBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBBdXRvLWNvbXBvdW5kOiBBZGQgcmV3YXJkcyB0byBzdGFrZWQgYW1vdW50CiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHRvdGFsIHJld2FyZHMgZWFybmVkCiAgICAvLyAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGxhc3QgY2xhaW1lZCBwZXJpb2QgdG8gY3VycmVudCBwZXJpb2QKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICByZXR1cm4gcGVuZGluZ1Jld2FyZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBEaXN0cmlidXRlIGFuZCBjb21wb3VuZCByZXdhcmRzIGZvciBtdWx0aXBsZSBzdGFrZXJzCiAgICAvLyAgKiBUaGlzIG1ldGhvZCBpcyBkZXNpZ25lZCB0byBiZSBjYWxsZWQgYnkgYSBjcm9uIGpvYiBvbiBhIGRhaWx5IGJhc2lzCiAgICAvLyAgKiBPbmx5IGFkbWluIGNhbiBjYWxsIHRoaXMgbWV0aG9kCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGVSZXdhcmRzKHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gZGlzdHJpYnV0ZSByZXdhcmRzJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgd2UgZG9uJ3QgcHJvY2VzcyB0b28gbWFueSBzdGFrZXJzIGluIG9uZSBjYWxsIChnYXMgbGltaXQgcHJvdGVjdGlvbikKICAgIC8vICAgYXNzZXJ0KHN0YWtlckFkZHJlc3Nlcy5sZW5ndGggPD0gNTAsICdUb28gbWFueSBzdGFrZXJzIGluIHNpbmdsZSBiYXRjaCcpCiAgICAvLyAKICAgIC8vICAgbGV0IHRvdGFsRGlzdHJpYnV0ZWQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICAvLyBQcm9jZXNzIGVhY2ggc3Rha2VyCiAgICAvLyAgIGZvciAoY29uc3Qgc3Rha2VyIG9mIHN0YWtlckFkZHJlc3NlcykgewogICAgLy8gICAgIGNvbnN0IHJld2FyZHNDb21wb3VuZGVkID0gdGhpcy5jb21wb3VuZFJld2FyZHNGb3JVc2VyKHN0YWtlci5uYXRpdmUpCiAgICAvLyAgICAgdG90YWxEaXN0cmlidXRlZCA9IHRvdGFsRGlzdHJpYnV0ZWQgKyByZXdhcmRzQ29tcG91bmRlZAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGxhc3QgZGlzdHJpYnV0aW9uIHRpbWUKICAgIC8vICAgdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgYWxsIG5vbi16ZXJvIHN0YWtlcnMgY291bnQgKGZvciBtb25pdG9yaW5nIHB1cnBvc2VzKQogICAgLy8gICogTm90ZTogVGhpcyBkb2Vzbid0IHJldHVybiB0aGUgYWN0dWFsIGFkZHJlc3NlcyBkdWUgdG8gYm94IGl0ZXJhdGlvbiBsaW1pdGF0aW9ucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRBY3RpdmVTdGFrZXJzQ291bnQoc3Rha2VyQWRkcmVzc2VzOiBhcmM0LkFkZHJlc3NbXSk6IHVpbnQ2NCB7CiAgICAvLyAgIGxldCBhY3RpdmVDb3VudDogdWludDY0ID0gMAogICAgLy8gCiAgICAvLyAgIGZvciAoY29uc3Qgc3Rha2VyIG9mIHN0YWtlckFkZHJlc3NlcykgewogICAgLy8gICAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDApIHsKICAgIC8vICAgICAgIGFjdGl2ZUNvdW50ID0gYWN0aXZlQ291bnQgKyAxCiAgICAvLyAgICAgfQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgcmV0dXJuIGFjdGl2ZUNvdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIHRoZSBBUFIgYmFzaXMgcG9pbnRzCiAgICAvLyAgKiBPbmx5IHRoZSBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFQUihuZXdBcHJCYXNpc1BvaW50czogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB1cGRhdGUgQVBSCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgQVBSJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgQVBSCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBuZXdBcHJCYXNpc1BvaW50cwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICogT25seSB0aGUgY3VycmVudCBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFkbWluKG5ld0FkbWluQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gbmV3QWRtaW5BZGRyZXNzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGN1cnJlbnQgc3Rha2luZyBzdGF0aXN0aWNzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YXRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gICAgIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUsCiAgICAvLyAgIF0KICAgIC8vIAogICAgLy8gICByZXR1cm4gcmVzdWx0CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGNvbnRyYWN0IGdsb2JhbCBzdGF0aXN0aWNzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldENvbnRyYWN0U3RhdHMoKTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgdGhpcy5hc3NldC52YWx1ZS5pZCwKICAgIC8vICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlLAogICAgLy8gICAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUsCiAgICAvLyAgICAgdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSwKICAgIC8vICAgICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUsCiAgICAvLyAgICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUsCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlLAogICAgLy8gICAgIHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU0CiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgdW5jb3ZlciAzCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTQ4MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdENsYWltZWRQZXJpb2Q6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGRpc3RyaWJ1dGlvbiBwZXJpb2QKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldEN1cnJlbnRQZXJpb2QoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gICBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIC8vICAgcmV0dXJuIEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgLyBwZXJpb2RTZWNvbmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUgPSBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGluaXRpYWwgY2xhaW0gcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgbGFzdCBkaXN0cmlidXRpb24gdGltZQogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIgZm9yIGEgZ2l2ZW4gcGVyaW9kCiAgICAvLyAgKiBUaGlzIGNhbGN1bGF0ZXMgcmV3YXJkcyBwZXIgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IGFwciA9IHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgIGNvbnN0IHBlcmlvZFNlY29uZHMgPSB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBJZiBubyB0b3RhbCBzdGFrZSBvciBubyBwZXJpb2QgZGVmaW5lZCwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwIHx8IHBlcmlvZFNlY29uZHMgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSB1c2VyJ3Mgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgdXNlciBoYXMgbm8gc3Rha2UsIHJldHVybiAwCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdXNlcidzIHN0YWtlIGFtb3VudCBhbmQgbGFzdCBzdGFrZSB0aW1lCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGxhc3RTdGFrZVRpbWUgPSBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiB1c2VyIGhhcyBiZWVuIHN0YWtlZCBmb3IgdGhlIG1pbmltdW0gcGVyaW9kCiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZVRpbWU6IHVpbnQ2NCA9IDg2NDAwIC8vIDI0IGhvdXJzIGluIHNlY29uZHMKICAgIC8vICAgaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHJhdGUgZm9yIHRoZSBwZXJpb2QKICAgIC8vICAgLy8gQVBSIGlzIGluIGJhc2lzIHBvaW50cyAoZS5nLiwgNTAwID0gNSUpCiAgICAvLyAgIC8vIENvbnZlcnQgQVBSIHRvIHBlcmlvZCByYXRlOiAoQVBSIC8gMTAwMDApICogKHBlcmlvZFNlY29uZHMgLyAzMTUzNjAwMCkKICAgIC8vICAgLy8gd2hlcmUgMzE1MzYwMDAgaXMgc2Vjb25kcyBpbiBhIHllYXIKICAgIC8vICAgY29uc3QgeWVhckluU2Vjb25kczogdWludDY0ID0gMzE1MzYwMDAKICAgIC8vICAgY29uc3QgcGVyaW9kUmF0ZU51bWVyYXRvcjogdWludDY0ID0gYXByICogcGVyaW9kU2Vjb25kcwogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlRGVub21pbmF0b3I6IHVpbnQ2NCA9IDEwMDAwICogeWVhckluU2Vjb25kcwogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQ6IHVzZXJTdGFrZSAqIHBlcmlvZFJhdGUKICAgIC8vICAgY29uc3QgcmV3YXJkOiB1aW50NjQgPSAodXNlclN0YWtlICogcGVyaW9kUmF0ZU51bWVyYXRvcikgLyBwZXJpb2RSYXRlRGVub21pbmF0b3IKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyIHNpbmNlIHRoZWlyIGxhc3QgY2xhaW0KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IGN1cnJlbnRQZXJpb2QgPSB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKQogICAgLy8gICBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVyaW9kcyBzaW5jZSBsYXN0IGNsYWltCiAgICAvLyAgIGNvbnN0IHBlcmlvZHNTaW5jZUxhc3RDbGFpbTogdWludDY0ID0gY3VycmVudFBlcmlvZCA+IGxhc3RDbGFpbWVkUGVyaW9kID8gY3VycmVudFBlcmlvZCAtIGxhc3RDbGFpbWVkUGVyaW9kIDogMAogICAgLy8gCiAgICAvLyAgIGlmIChwZXJpb2RzU2luY2VMYXN0Q2xhaW0gPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZCBwZXIgcGVyaW9kCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMuY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QodXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb21wb3VuZCByZXdhcmRzIGZvciBhIHNpbmdsZSB1c2VyCiAgICAvLyAgKiBVc2VkIGJ5IHRoZSBhdXRvbWF0ZWQgZGlzdHJpYnV0aW9uIHN5c3RlbQogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNvbXBvdW5kUmV3YXJkc0ZvclVzZXIodXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiB1c2VyIGhhcyBubyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiBubyByZXdhcmRzIHRvIGNvbXBvdW5kCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHJld2FyZCBwb29sIGhhcyBpbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRoaXMgdXNlcgogICAgLy8gICBpZiAodGhpcy5yZXdhcmRQb29sLnZhbHVlIDwgcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQXV0by1jb21wb3VuZDogQWRkIHJld2FyZHMgdG8gc3Rha2VkIGFtb3VudAogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB0b3RhbCByZXdhcmRzIGVhcm5lZAogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGNsYWltZWQgcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZCA9IG5ldyBhcmM0LlVpbnRONjQodGhpcy5nZXRDdXJyZW50UGVyaW9kKCkpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogRGlzdHJpYnV0ZSBhbmQgY29tcG91bmQgcmV3YXJkcyBmb3IgbXVsdGlwbGUgc3Rha2VycwogICAgLy8gICogVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgY2FsbGVkIGJ5IGEgY3JvbiBqb2Igb24gYSBkYWlseSBiYXNpcwogICAgLy8gICogT25seSBhZG1pbiBjYW4gY2FsbCB0aGlzIG1ldGhvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGFyYzQuQWRkcmVzc1tdKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBkaXN0cmlidXRlIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHdlIGRvbid0IHByb2Nlc3MgdG9vIG1hbnkgc3Rha2VycyBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IHByb3RlY3Rpb24pCiAgICAvLyAgIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgLy8gCiAgICAvLyAgIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gUHJvY2VzcyBlYWNoIHN0YWtlcgogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCByZXdhcmRzQ29tcG91bmRlZCA9IHRoaXMuY29tcG91bmRSZXdhcmRzRm9yVXNlcihzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIHRvdGFsRGlzdHJpYnV0ZWQgPSB0b3RhbERpc3RyaWJ1dGVkICsgcmV3YXJkc0NvbXBvdW5kZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGFsbCBub24temVybyBzdGFrZXJzIGNvdW50IChmb3IgbW9uaXRvcmluZyBwdXJwb3NlcykKICAgIC8vICAqIE5vdGU6IFRoaXMgZG9lc24ndCByZXR1cm4gdGhlIGFjdHVhbCBhZGRyZXNzZXMgZHVlIHRvIGJveCBpdGVyYXRpb24gbGltaXRhdGlvbnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB1aW50NjQgewogICAgLy8gICBsZXQgYWN0aXZlQ291bnQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc3Rha2VyLm5hdGl2ZSkKICAgIC8vICAgICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgICBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIHJldHVybiBhY3RpdmVDb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgQVBSIGJhc2lzIHBvaW50cwogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBUFIobmV3QXByQmFzaXNQb2ludHM6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIEFQUgogICAgLy8gICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUsCiAgICAvLyAgICAgdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlLAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSwKICAgIGNvbmNhdAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICB1bmNvdmVyIDIKICAgIGl0b2IKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAtNDgwCiAgICAvLyBwdWJsaWMgdG90YWxTdGFrZWQgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgYXByQmFzaXNQb2ludHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbGFzdERpc3RyaWJ1dGlvblRpbWUgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcyA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIHB1YmxpYyBtaW5pbXVtU3Rha2UgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIC8vIAogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byByZWFkIHVzZXIgc3Rha2UgaW5mbyBmcm9tIGJveCBzdG9yYWdlCiAgICAvLyAgKi8KICAgIC8vIHB1YmxpYyBnZXRVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogVXNlclN0YWtlSW5mbyB7CiAgICAvLyAgIGNvbnN0IHVzZXJCb3ggPSB0aGlzLnN0YWtlcnModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHVzZXJCb3guZXhpc3RzKSB7CiAgICAvLyAgICAgcmV0dXJuIHVzZXJCb3gudmFsdWUuY29weSgpCiAgICAvLyAgIH0gZWxzZSB7CiAgICAvLyAgICAgcmV0dXJuIG5ldyBVc2VyU3Rha2VJbmZvKHsKICAgIC8vICAgICAgIHN0YWtlZEFtb3VudDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICAgIGxhc3RTdGFrZVRpbWU6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICB0b3RhbFJld2FyZHNFYXJuZWQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0Q2xhaW1lZFBlcmlvZDogbmV3IGFyYzQuVWludE42NCgwKSwKICAgIC8vICAgICB9KQogICAgLy8gICB9CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIHN0b3JlIHVzZXIgc3Rha2UgaW5mbyBpbiBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzOiBBY2NvdW50LCBzdGFrZUluZm86IFVzZXJTdGFrZUluZm8pOiB2b2lkIHsKICAgIC8vICAgdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKS52YWx1ZSA9IHN0YWtlSW5mby5jb3B5KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgdGhlIGN1cnJlbnQgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0Q3VycmVudFBlcmlvZCgpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBwZXJpb2RTZWNvbmRzID0gdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlCiAgICAvLyAgIGlmIChwZXJpb2RTZWNvbmRzID09PSAwKSByZXR1cm4gMAogICAgLy8gICByZXR1cm4gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCAvIHBlcmlvZFNlY29uZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBJbml0aWFsaXplIHRoZSBjb250cmFjdCB3aXRoIHRoZSBBU0EgdG9rZW4gSUQgYW5kIG90aGVyIHBhcmFtZXRlcnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgaW5pdGlhbGl6ZSgKICAgIC8vICAgYXNzZXQ6IEFzc2V0LAogICAgLy8gICBhZG1pbkFkZHJlc3M6IEFjY291bnQsCiAgICAvLyAgIGFwckJhc2lzUG9pbnRzOiB1aW50NjQsCiAgICAvLyAgIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHM6IHVpbnQ2NCwKICAgIC8vICAgbWluaW11bVN0YWtlOiB1aW50NjQsCiAgICAvLyApOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgaXMgb25seSBjYWxsZWQgZHVyaW5nIGNvbnRyYWN0IGNyZWF0aW9uCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlID09PSBBc3NldCgpLCAnQWxyZWFkeSBpbml0aWFsaXplZCcpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3IgY2FuIGluaXRpYWxpemUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcywgJ09ubHkgY3JlYXRvciBjYW4gaW5pdGlhbGl6ZScpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdGhlIGluaXRpYWwgcGFyYW1ldGVycwogICAgLy8gICB0aGlzLmFzc2V0LnZhbHVlID0gYXNzZXQKICAgIC8vICAgdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUgPSBhZG1pbkFkZHJlc3MKICAgIC8vICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSA9IDAKICAgIC8vICAgdGhpcy5hcHJCYXNpc1BvaW50cy52YWx1ZSA9IGFwckJhc2lzUG9pbnRzCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyAgIHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZSA9IGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMKICAgIC8vICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUgPSBtaW5pbXVtU3Rha2UKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gMAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIE9wdCB0aGUgY29udHJhY3QgaW50byB0aGUgQVNBCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIG9wdEluVG9Bc3NldCgpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgdGhlIGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gR2xvYmFsLmNyZWF0b3JBZGRyZXNzIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgY3JlYXRvciBvciBhZG1pbiBjYW4gb3B0IGluJykKICAgIC8vIAogICAgLy8gICAvLyBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IDAsCiAgICAvLyAgICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIH0pCiAgICAvLyAgICAgLnN1Ym1pdCgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogU3Rha2UgdG9rZW5zCiAgICAvLyAgKiBSZXF1aXJlcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgc3Rha2UoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGUgY29udHJhY3QgaGFzIG9wdGVkIGludG8gdGhlIEFTQQogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgYXNzZXJ0KHRoaXMuYXNzZXQudmFsdWUgIT09IEFzc2V0KCksICdDb250cmFjdCBub3QgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbgogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCB4ZmVyVHhuID0gZ3R4bi5Bc3NldFRyYW5zZmVyVHhuKDApCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnR5cGUgPT09IFRyYW5zYWN0aW9uVHlwZS5Bc3NldFRyYW5zZmVyLCAnVHJhbnNhY3Rpb24gMCBtdXN0IGJlIGFzc2V0IHRyYW5zZmVyJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRSZWNlaXZlciA9PT0gR2xvYmFsLmN1cnJlbnRBcHBsaWNhdGlvbkFkZHJlc3MsICdBc3NldCB0cmFuc2ZlciBtdXN0IGJlIHRvIGNvbnRyYWN0JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4uYXNzZXRBbW91bnQgPiAwLCAnTXVzdCBzdGFrZSBub24temVybyBhbW91bnQnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi54ZmVyQXNzZXQgPT09IGFzc2V0LCAnSW5jb3JyZWN0IGFzc2V0IElEJykKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHN0YWtlIGFtb3VudCBmcm9tIHRoZSB0cmFuc2FjdGlvbgogICAgLy8gICBjb25zdCBzdGFrZUFtb3VudCA9IHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIGN1cnJlbnQgdXNlciBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIElmIHRoaXMgaXMgYSBuZXcgc3Rha2UsIGVuc3VyZSBpdCBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIGFzc2VydChzdGFrZUFtb3VudCA+PSBtaW5pbXVtU3Rha2UsICdJbml0aWFsIHN0YWtlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICAgIC8vIFNldCB0aGUgaW5pdGlhbCBjbGFpbSBwZXJpb2QgdG8gY3VycmVudCBwZXJpb2QKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QgPSBuZXcgYXJjNC5VaW50TjY0KHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgKyBzdGFrZUFtb3VudCkKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUgPSBuZXcgYXJjNC5VaW50TjY0KEdsb2JhbC5sYXRlc3RUaW1lc3RhbXApCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgc3Rha2VBbW91bnQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBXaXRoZHJhdyBzdGFrZWQgdG9rZW5zCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHdpdGhkcmF3KGFtb3VudDogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIGNvbnN0IHNlbmRlckFkZHJlc3MgPSBUeG4uc2VuZGVyCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB1c2VyIGhhcyBlbm91Z2ggc3Rha2VkCiAgICAvLyAgIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDAsICdObyBzdGFrZSBmb3VuZCcpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPD0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsICdXaXRoZHJhd2FsIGFtb3VudCBleGNlZWRzIHN0YWtlJykKICAgIC8vICAgYXNzZXJ0KGFtb3VudCA+IDAsICdXaXRoZHJhd2FsIGFtb3VudCBtdXN0IGJlIHBvc2l0aXZlJykKICAgIC8vIAogICAgLy8gICAvLyBJZiB3aXRoZHJhd2luZyBhbGwsIG5vIG5lZWQgdG8gY2hlY2sgbWluaW11bSByZW1haW5pbmcKICAgIC8vICAgLy8gSWYgcGFydGlhbCB3aXRoZHJhd2FsLCBlbnN1cmUgcmVtYWluaW5nIHN0YWtlIG1lZXRzIG1pbmltdW0KICAgIC8vICAgaWYgKGFtb3VudCA8IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlKSB7CiAgICAvLyAgICAgY29uc3QgcmVtYWluaW5nU3Rha2U6IHVpbnQ2NCA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50CiAgICAvLyAgICAgY29uc3QgbWluaW11bVN0YWtlID0gdGhpcy5taW5pbXVtU3Rha2UudmFsdWUKICAgIC8vICAgICBhc3NlcnQocmVtYWluaW5nU3Rha2UgPj0gbWluaW11bVN0YWtlLCAnUmVtYWluaW5nIHN0YWtlIHdvdWxkIGJlIGJlbG93IG1pbmltdW0nKQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHN0YWtlIGluZm8KICAgIC8vICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudCA9IG5ldyBhcmM0LlVpbnRONjQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgLSBhbW91bnQpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHNlbmRlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlIC0gYW1vdW50CiAgICAvLyAKICAgIC8vICAgLy8gVHJhbnNmZXIgdG9rZW5zIGJhY2sgdG8gdXNlcgogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgaXR4bgogICAgLy8gICAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICAgIGFzc2V0UmVjZWl2ZXI6IFR4bi5zZW5kZXIsCiAgICAvLyAgICAgICBhc3NldEFtb3VudDogYW1vdW50LAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICAgIGZlZTogMTAwMCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEFkZCByZXdhcmRzIHRvIHRoZSByZXdhcmQgcG9vbAogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggdGhlIHJld2FyZHMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCgpCiAgICAvLyBwdWJsaWMgYWRkUmV3YXJkcygpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGFkZCByZXdhcmRzCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHRoaXMgY2FsbCBoYXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uIHdpdGggcmV3YXJkcwogICAgLy8gICBhc3NlcnQoR2xvYmFsLmdyb3VwU2l6ZSA9PT0gMiwgJ0V4cGVjdGVkIDIgdHhucyBpbiBncm91cCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBBU0EgdHJhbnNmZXIgZGV0YWlscwogICAgLy8gICBjb25zdCBhc3NldCA9IHRoaXMuYXNzZXQudmFsdWUKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3QgcHJvdmlkZSBub24temVybyByZXdhcmRzJykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gQWRkIHJld2FyZHMgdG8gdGhlIHBvb2wKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlICsgeGZlclR4bi5hc3NldEFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHJld2FyZHMgZm9yIGEgc3BlY2lmaWMgdXNlciBmb3IgYSBnaXZlbiBwZXJpb2QKICAgIC8vICAqIFRoaXMgY2FsY3VsYXRlcyByZXdhcmRzIHBlciBkaXN0cmlidXRpb24gcGVyaW9kCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGNhbGN1bGF0ZVVzZXJSZXdhcmRzRm9yUGVyaW9kKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdWludDY0IHsKICAgIC8vICAgY29uc3QgYXByID0gdGhpcy5hcHJCYXNpc1BvaW50cy52YWx1ZQogICAgLy8gICBjb25zdCB0b3RhbFN0YWtlZCA9IHRoaXMudG90YWxTdGFrZWQudmFsdWUKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gCiAgICAvLyAgIC8vIElmIG5vIHRvdGFsIHN0YWtlIG9yIG5vIHBlcmlvZCBkZWZpbmVkLCByZXR1cm4gMAogICAgLy8gICBpZiAodG90YWxTdGFrZWQgPT09IDAgfHwgcGVyaW9kU2Vjb25kcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdGhlIHVzZXIncyBzdGFrZSBpbmZvCiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB1c2VyIGhhcyBubyBzdGFrZSwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB1c2VyJ3Mgc3Rha2UgYW1vdW50IGFuZCBsYXN0IHN0YWtlIHRpbWUKICAgIC8vICAgY29uc3QgdXNlclN0YWtlID0gc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUKICAgIC8vICAgY29uc3QgbGFzdFN0YWtlVGltZSA9IHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgIC8vIENoZWNrIGlmIHVzZXIgaGFzIGJlZW4gc3Rha2VkIGZvciB0aGUgbWluaW11bSBwZXJpb2QKICAgIC8vICAgY29uc3QgbWluaW11bVN0YWtlVGltZTogdWludDY0ID0gODY0MDAgLy8gMjQgaG91cnMgaW4gc2Vjb25kcwogICAgLy8gICBpZiAoR2xvYmFsLmxhdGVzdFRpbWVzdGFtcCA8IGxhc3RTdGFrZVRpbWUgKyBtaW5pbXVtU3Rha2VUaW1lKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQgcmF0ZSBmb3IgdGhlIHBlcmlvZAogICAgLy8gICAvLyBBUFIgaXMgaW4gYmFzaXMgcG9pbnRzIChlLmcuLCA1MDAgPSA1JSkKICAgIC8vICAgLy8gQ29udmVydCBBUFIgdG8gcGVyaW9kIHJhdGU6IChBUFIgLyAxMDAwMCkgKiAocGVyaW9kU2Vjb25kcyAvIDMxNTM2MDAwKQogICAgLy8gICAvLyB3aGVyZSAzMTUzNjAwMCBpcyBzZWNvbmRzIGluIGEgeWVhcgogICAgLy8gICBjb25zdCB5ZWFySW5TZWNvbmRzOiB1aW50NjQgPSAzMTUzNjAwMAogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlTnVtZXJhdG9yOiB1aW50NjQgPSBhcHIgKiBwZXJpb2RTZWNvbmRzCiAgICAvLyAgIGNvbnN0IHBlcmlvZFJhdGVEZW5vbWluYXRvcjogdWludDY0ID0gMTAwMDAgKiB5ZWFySW5TZWNvbmRzCiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZDogdXNlclN0YWtlICogcGVyaW9kUmF0ZQogICAgLy8gICBjb25zdCByZXdhcmQ6IHVpbnQ2NCA9ICh1c2VyU3Rha2UgKiBwZXJpb2RSYXRlTnVtZXJhdG9yKSAvIHBlcmlvZFJhdGVEZW5vbWluYXRvcgogICAgLy8gCiAgICAvLyAgIHJldHVybiByZXdhcmQKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzIGZvciBhIHVzZXIgc2luY2UgdGhlaXIgbGFzdCBjbGFpbQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgY29uc3QgY3VycmVudFBlcmlvZCA9IHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpCiAgICAvLyAgIGNvbnN0IGxhc3RDbGFpbWVkUGVyaW9kID0gc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kLm5hdGl2ZQogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSBwZXJpb2RzIHNpbmNlIGxhc3QgY2xhaW0KICAgIC8vICAgY29uc3QgcGVyaW9kc1NpbmNlTGFzdENsYWltOiB1aW50NjQgPSBjdXJyZW50UGVyaW9kID4gbGFzdENsYWltZWRQZXJpb2QgPyBjdXJyZW50UGVyaW9kIC0gbGFzdENsYWltZWRQZXJpb2QgOiAwCiAgICAvLyAKICAgIC8vICAgaWYgKHBlcmlvZHNTaW5jZUxhc3RDbGFpbSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHBlciBwZXJpb2QKICAgIC8vICAgY29uc3QgcmV3YXJkUGVyUGVyaW9kID0gdGhpcy5jYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkUGVyUGVyaW9kICogcGVyaW9kc1NpbmNlTGFzdENsYWltCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSGVscGVyIGZ1bmN0aW9uIHRvIGNvbXBvdW5kIHJld2FyZHMgZm9yIGEgc2luZ2xlIHVzZXIKICAgIC8vICAqIFVzZWQgYnkgdGhlIGF1dG9tYXRlZCBkaXN0cmlidXRpb24gc3lzdGVtCiAgICAvLyAgKi8KICAgIC8vIHByaXZhdGUgY29tcG91bmRSZXdhcmRzRm9yVXNlcih1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHVzZXIgaGFzIG5vIHN0YWtlCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVuZGluZyByZXdhcmRzCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIG5vIHJld2FyZHMgdG8gY29tcG91bmQKICAgIC8vICAgaWYgKHBlbmRpbmdSZXdhcmRzID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFNraXAgaWYgcmV3YXJkIHBvb2wgaGFzIGluc3VmZmljaWVudCBmdW5kcyBmb3IgdGhpcyB1c2VyCiAgICAvLyAgIGlmICh0aGlzLnJld2FyZFBvb2wudmFsdWUgPCBwZW5kaW5nUmV3YXJkcykgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBBdXRvLWNvbXBvdW5kOiBBZGQgcmV3YXJkcyB0byBzdGFrZWQgYW1vdW50CiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIHRvdGFsIHJld2FyZHMgZWFybmVkCiAgICAvLyAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlICsgcGVuZGluZ1Jld2FyZHMpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGxhc3QgY2xhaW1lZCBwZXJpb2QgdG8gY3VycmVudCBwZXJpb2QKICAgIC8vICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vIAogICAgLy8gICAvLyBTdG9yZSB1cGRhdGVkIHN0YWtlIGluZm8KICAgIC8vICAgdGhpcy5zdG9yZVVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MsIHN0YWtlSW5mbykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgZ2xvYmFsIHN0YXRlCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlICsgcGVuZGluZ1Jld2FyZHMKICAgIC8vICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gcGVuZGluZ1Jld2FyZHMKICAgIC8vIAogICAgLy8gICByZXR1cm4gcGVuZGluZ1Jld2FyZHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBEaXN0cmlidXRlIGFuZCBjb21wb3VuZCByZXdhcmRzIGZvciBtdWx0aXBsZSBzdGFrZXJzCiAgICAvLyAgKiBUaGlzIG1ldGhvZCBpcyBkZXNpZ25lZCB0byBiZSBjYWxsZWQgYnkgYSBjcm9uIGpvYiBvbiBhIGRhaWx5IGJhc2lzCiAgICAvLyAgKiBPbmx5IGFkbWluIGNhbiBjYWxsIHRoaXMgbWV0aG9kCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGVSZXdhcmRzKHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gZGlzdHJpYnV0ZSByZXdhcmRzJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgd2UgZG9uJ3QgcHJvY2VzcyB0b28gbWFueSBzdGFrZXJzIGluIG9uZSBjYWxsIChnYXMgbGltaXQgcHJvdGVjdGlvbikKICAgIC8vICAgYXNzZXJ0KHN0YWtlckFkZHJlc3Nlcy5sZW5ndGggPD0gNTAsICdUb28gbWFueSBzdGFrZXJzIGluIHNpbmdsZSBiYXRjaCcpCiAgICAvLyAKICAgIC8vICAgbGV0IHRvdGFsRGlzdHJpYnV0ZWQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICAvLyBQcm9jZXNzIGVhY2ggc3Rha2VyCiAgICAvLyAgIGZvciAoY29uc3Qgc3Rha2VyIG9mIHN0YWtlckFkZHJlc3NlcykgewogICAgLy8gICAgIGNvbnN0IHJld2FyZHNDb21wb3VuZGVkID0gdGhpcy5jb21wb3VuZFJld2FyZHNGb3JVc2VyKHN0YWtlci5uYXRpdmUpCiAgICAvLyAgICAgdG90YWxEaXN0cmlidXRlZCA9IHRvdGFsRGlzdHJpYnV0ZWQgKyByZXdhcmRzQ29tcG91bmRlZAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGxhc3QgZGlzdHJpYnV0aW9uIHRpbWUKICAgIC8vICAgdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSA9IEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBHZXQgYWxsIG5vbi16ZXJvIHN0YWtlcnMgY291bnQgKGZvciBtb25pdG9yaW5nIHB1cnBvc2VzKQogICAgLy8gICogTm90ZTogVGhpcyBkb2Vzbid0IHJldHVybiB0aGUgYWN0dWFsIGFkZHJlc3NlcyBkdWUgdG8gYm94IGl0ZXJhdGlvbiBsaW1pdGF0aW9ucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRBY3RpdmVTdGFrZXJzQ291bnQoc3Rha2VyQWRkcmVzc2VzOiBhcmM0LkFkZHJlc3NbXSk6IHVpbnQ2NCB7CiAgICAvLyAgIGxldCBhY3RpdmVDb3VudDogdWludDY0ID0gMAogICAgLy8gCiAgICAvLyAgIGZvciAoY29uc3Qgc3Rha2VyIG9mIHN0YWtlckFkZHJlc3NlcykgewogICAgLy8gICAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyhzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA+IDApIHsKICAgIC8vICAgICAgIGFjdGl2ZUNvdW50ID0gYWN0aXZlQ291bnQgKyAxCiAgICAvLyAgICAgfQogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgcmV0dXJuIGFjdGl2ZUNvdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogVXBkYXRlIHRoZSBBUFIgYmFzaXMgcG9pbnRzCiAgICAvLyAgKiBPbmx5IHRoZSBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFQUihuZXdBcHJCYXNpc1BvaW50czogdWludDY0KTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiB1cGRhdGUgQVBSCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgQVBSJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgQVBSCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBuZXdBcHJCYXNpc1BvaW50cwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICogT25seSB0aGUgY3VycmVudCBhZG1pbiBjYW4gY2FsbCB0aGlzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHVwZGF0ZUFkbWluKG5ld0FkbWluQWRkcmVzczogQWNjb3VudCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluCiAgICAvLyAgIGNvbnN0IGFkbWluQWRkciA9IHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGFkbWluIGNhbiB1cGRhdGUgYWRtaW4nKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBhZG1pbiBhZGRyZXNzCiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gbmV3QWRtaW5BZGRyZXNzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGN1cnJlbnQgc3Rha2luZyBzdGF0aXN0aWNzIGZvciBhIHVzZXIKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YXRzKHVzZXJBZGRyZXNzOiBBY2NvdW50KTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHN0YWtlSW5mbyA9IHRoaXMuZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzcykKICAgIC8vICAgY29uc3QgcGVuZGluZ1Jld2FyZHMgPSB0aGlzLmNhbGN1bGF0ZVBlbmRpbmdSZXdhcmRzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUsCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RTdGFrZVRpbWUubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby50b3RhbFJld2FyZHNFYXJuZWQubmF0aXZlLAogICAgLy8gICAgIHBlbmRpbmdSZXdhcmRzLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUsCiAgICAvLyAgIF0KICAgIC8vIAogICAgLy8gICByZXR1cm4gcmVzdWx0CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGNvbnRyYWN0IGdsb2JhbCBzdGF0aXN0aWNzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldENvbnRyYWN0U3RhdHMoKTogQXJyYXk8dWludDY0PiB7CiAgICAvLyAgIGNvbnN0IHJlc3VsdDogdWludDY0W10gPSBbCiAgICAvLyAgICAgdGhpcy5hc3NldC52YWx1ZS5pZCwKICAgIC8vICAgICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlLAogICAgLy8gICAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUsCiAgICAvLyAgICAgdGhpcy5sYXN0RGlzdHJpYnV0aW9uVGltZS52YWx1ZSwKICAgIC8vICAgICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUsCiAgICAvLyAgICAgdGhpcy5taW5pbXVtU3Rha2UudmFsdWUsCiAgICAvLyAgICAgdGhpcy5yZXdhcmRQb29sLnZhbHVlLAogICAgLy8gICAgIHRoaXMuZ2V0Q3VycmVudFBlcmlvZCgpLAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4MAogICAgLy8gdGhpcy5nZXRDdXJyZW50UGVyaW9kKCksCiAgICBzd2FwCiAgICBpdG9iCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUwLTQ4MAogICAgLy8gcHVibGljIHRvdGFsU3Rha2VkID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGFwckJhc2lzUG9pbnRzID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGxhc3REaXN0cmlidXRpb25UaW1lID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIGRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyBwdWJsaWMgbWluaW11bVN0YWtlID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgLy8gcHVibGljIHJld2FyZFBvb2wgPSBHbG9iYWxTdGF0ZTx1aW50NjQ+KHsgaW5pdGlhbFZhbHVlOiAwIH0pCiAgICAvLyAKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBIZWxwZXIgZnVuY3Rpb24gdG8gcmVhZCB1c2VyIHN0YWtlIGluZm8gZnJvbSBib3ggc3RvcmFnZQogICAgLy8gICovCiAgICAvLyBwdWJsaWMgZ2V0VXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCk6IFVzZXJTdGFrZUluZm8gewogICAgLy8gICBjb25zdCB1c2VyQm94ID0gdGhpcy5zdGFrZXJzKHVzZXJBZGRyZXNzKQogICAgLy8gCiAgICAvLyAgIGlmICh1c2VyQm94LmV4aXN0cykgewogICAgLy8gICAgIHJldHVybiB1c2VyQm94LnZhbHVlLmNvcHkoKQogICAgLy8gICB9IGVsc2UgewogICAgLy8gICAgIHJldHVybiBuZXcgVXNlclN0YWtlSW5mbyh7CiAgICAvLyAgICAgICBzdGFrZWRBbW91bnQ6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgICBsYXN0U3Rha2VUaW1lOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgdG90YWxSZXdhcmRzRWFybmVkOiBuZXcgYXJjNC5VaW50TjY0KDApLAogICAgLy8gICAgICAgbGFzdENsYWltZWRQZXJpb2Q6IG5ldyBhcmM0LlVpbnRONjQoMCksCiAgICAvLyAgICAgfSkKICAgIC8vICAgfQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBzdG9yZSB1c2VyIHN0YWtlIGluZm8gaW4gYm94IHN0b3JhZ2UKICAgIC8vICAqLwogICAgLy8gcHVibGljIHN0b3JlVXNlclN0YWtlSW5mbyh1c2VyQWRkcmVzczogQWNjb3VudCwgc3Rha2VJbmZvOiBVc2VyU3Rha2VJbmZvKTogdm9pZCB7CiAgICAvLyAgIHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykudmFsdWUgPSBzdGFrZUluZm8uY29weSgpCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHRoZSBjdXJyZW50IGRpc3RyaWJ1dGlvbiBwZXJpb2QKICAgIC8vICAqLwogICAgLy8gcHVibGljIGdldEN1cnJlbnRQZXJpb2QoKTogdWludDY0IHsKICAgIC8vICAgY29uc3QgcGVyaW9kU2Vjb25kcyA9IHRoaXMuZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcy52YWx1ZQogICAgLy8gICBpZiAocGVyaW9kU2Vjb25kcyA9PT0gMCkgcmV0dXJuIDAKICAgIC8vICAgcmV0dXJuIEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgLyBwZXJpb2RTZWNvbmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogSW5pdGlhbGl6ZSB0aGUgY29udHJhY3Qgd2l0aCB0aGUgQVNBIHRva2VuIElEIGFuZCBvdGhlciBwYXJhbWV0ZXJzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGluaXRpYWxpemUoCiAgICAvLyAgIGFzc2V0OiBBc3NldCwKICAgIC8vICAgYWRtaW5BZGRyZXNzOiBBY2NvdW50LAogICAgLy8gICBhcHJCYXNpc1BvaW50czogdWludDY0LAogICAgLy8gICBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzOiB1aW50NjQsCiAgICAvLyAgIG1pbmltdW1TdGFrZTogdWludDY0LAogICAgLy8gKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGlzIG9ubHkgY2FsbGVkIGR1cmluZyBjb250cmFjdCBjcmVhdGlvbgogICAgLy8gICBhc3NlcnQodGhpcy5hc3NldC52YWx1ZSA9PT0gQXNzZXQoKSwgJ0FscmVhZHkgaW5pdGlhbGl6ZWQnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIGNhbiBpbml0aWFsaXplCiAgICAvLyAgIGFzc2VydChUeG4uc2VuZGVyID09PSBHbG9iYWwuY3JlYXRvckFkZHJlc3MsICdPbmx5IGNyZWF0b3IgY2FuIGluaXRpYWxpemUnKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHRoZSBpbml0aWFsIHBhcmFtZXRlcnMKICAgIC8vICAgdGhpcy5hc3NldC52YWx1ZSA9IGFzc2V0CiAgICAvLyAgIHRoaXMuYWRtaW5BZGRyZXNzLnZhbHVlID0gYWRtaW5BZGRyZXNzCiAgICAvLyAgIHRoaXMudG90YWxTdGFrZWQudmFsdWUgPSAwCiAgICAvLyAgIHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUgPSBhcHJCYXNpc1BvaW50cwogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gICB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUgPSBkaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzCiAgICAvLyAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlID0gbWluaW11bVN0YWtlCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IDAKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBPcHQgdGhlIGNvbnRyYWN0IGludG8gdGhlIEFTQQogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBvcHRJblRvQXNzZXQoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IHRoZSBjcmVhdG9yIG9yIGFkbWluIGNhbiBvcHQgaW4KICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IEdsb2JhbC5jcmVhdG9yQWRkcmVzcyB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGNyZWF0b3Igb3IgYWRtaW4gY2FuIG9wdCBpbicpCiAgICAvLyAKICAgIC8vICAgLy8gT3B0IHRoZSBjb250cmFjdCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywKICAgIC8vICAgICAgIGFzc2V0QW1vdW50OiAwLAogICAgLy8gICAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICB9KQogICAgLy8gICAgIC5zdWJtaXQoKQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFN0YWtlIHRva2VucwogICAgLy8gICogUmVxdWlyZXMgYSBjb21wYW5pb24gQVNBIHRyYW5zZmVyIHRyYW5zYWN0aW9uCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIHN0YWtlKCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgdGhlIGNvbnRyYWN0IGhhcyBvcHRlZCBpbnRvIHRoZSBBU0EKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGFzc2VydCh0aGlzLmFzc2V0LnZhbHVlICE9PSBBc3NldCgpLCAnQ29udHJhY3Qgbm90IGluaXRpYWxpemVkJykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdGhpcyBjYWxsIGhhcyBhIGNvbXBhbmlvbiBBU0EgdHJhbnNmZXIgdHJhbnNhY3Rpb24KICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgeGZlclR4biA9IGd0eG4uQXNzZXRUcmFuc2ZlclR4bigwKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi50eXBlID09PSBUcmFuc2FjdGlvblR5cGUuQXNzZXRUcmFuc2ZlciwgJ1RyYW5zYWN0aW9uIDAgbXVzdCBiZSBhc3NldCB0cmFuc2ZlcicpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0UmVjZWl2ZXIgPT09IEdsb2JhbC5jdXJyZW50QXBwbGljYXRpb25BZGRyZXNzLCAnQXNzZXQgdHJhbnNmZXIgbXVzdCBiZSB0byBjb250cmFjdCcpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLmFzc2V0QW1vdW50ID4gMCwgJ011c3Qgc3Rha2Ugbm9uLXplcm8gYW1vdW50JykKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4ueGZlckFzc2V0ID09PSBhc3NldCwgJ0luY29ycmVjdCBhc3NldCBJRCcpCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBzdGFrZSBhbW91bnQgZnJvbSB0aGUgdHJhbnNhY3Rpb24KICAgIC8vICAgY29uc3Qgc3Rha2VBbW91bnQgPSB4ZmVyVHhuLmFzc2V0QW1vdW50CiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSBjdXJyZW50IHVzZXIgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBJZiB0aGlzIGlzIGEgbmV3IHN0YWtlLCBlbnN1cmUgaXQgbWVldHMgbWluaW11bQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICBhc3NlcnQoc3Rha2VBbW91bnQgPj0gbWluaW11bVN0YWtlLCAnSW5pdGlhbCBzdGFrZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgICAvLyBTZXQgdGhlIGluaXRpYWwgY2xhaW0gcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgICAgc3Rha2VJbmZvLmxhc3RDbGFpbWVkUGVyaW9kID0gbmV3IGFyYzQuVWludE42NCh0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSkKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlICsgc3Rha2VBbW91bnQpCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lID0gbmV3IGFyYzQuVWludE42NChHbG9iYWwubGF0ZXN0VGltZXN0YW1wKQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHN0YWtlQW1vdW50CiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogV2l0aGRyYXcgc3Rha2VkIHRva2VucwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB3aXRoZHJhdyhhbW91bnQ6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICBjb25zdCBzZW5kZXJBZGRyZXNzID0gVHhuLnNlbmRlcgogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc2VuZGVyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICAvLyBFbnN1cmUgdXNlciBoYXMgZW5vdWdoIHN0YWtlZAogICAgLy8gICBhc3NlcnQoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwLCAnTm8gc3Rha2UgZm91bmQnKQogICAgLy8gICBhc3NlcnQoYW1vdW50IDw9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLCAnV2l0aGRyYXdhbCBhbW91bnQgZXhjZWVkcyBzdGFrZScpCiAgICAvLyAgIGFzc2VydChhbW91bnQgPiAwLCAnV2l0aGRyYXdhbCBhbW91bnQgbXVzdCBiZSBwb3NpdGl2ZScpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgd2l0aGRyYXdpbmcgYWxsLCBubyBuZWVkIHRvIGNoZWNrIG1pbmltdW0gcmVtYWluaW5nCiAgICAvLyAgIC8vIElmIHBhcnRpYWwgd2l0aGRyYXdhbCwgZW5zdXJlIHJlbWFpbmluZyBzdGFrZSBtZWV0cyBtaW5pbXVtCiAgICAvLyAgIGlmIChhbW91bnQgPCBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSkgewogICAgLy8gICAgIGNvbnN0IHJlbWFpbmluZ1N0YWtlOiB1aW50NjQgPSBzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSAtIGFtb3VudAogICAgLy8gICAgIGNvbnN0IG1pbmltdW1TdGFrZSA9IHRoaXMubWluaW11bVN0YWtlLnZhbHVlCiAgICAvLyAgICAgYXNzZXJ0KHJlbWFpbmluZ1N0YWtlID49IG1pbmltdW1TdGFrZSwgJ1JlbWFpbmluZyBzdGFrZSB3b3VsZCBiZSBiZWxvdyBtaW5pbXVtJykKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBzdGFrZSBpbmZvCiAgICAvLyAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQgPSBuZXcgYXJjNC5VaW50TjY0KHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlIC0gYW1vdW50KQogICAgLy8gCiAgICAvLyAgIC8vIFN0b3JlIHVwZGF0ZWQgc3Rha2UgaW5mbwogICAgLy8gICB0aGlzLnN0b3JlVXNlclN0YWtlSW5mbyhzZW5kZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSAtIGFtb3VudAogICAgLy8gCiAgICAvLyAgIC8vIFRyYW5zZmVyIHRva2VucyBiYWNrIHRvIHVzZXIKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGl0eG4KICAgIC8vICAgICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgICBhc3NldFJlY2VpdmVyOiBUeG4uc2VuZGVyLAogICAgLy8gICAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICAgIHhmZXJBc3NldDogYXNzZXQsCiAgICAvLyAgICAgICBmZWU6IDEwMDAsCiAgICAvLyAgICAgfSkKICAgIC8vICAgICAuc3VibWl0KCkKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBBZGQgcmV3YXJkcyB0byB0aGUgcmV3YXJkIHBvb2wKICAgIC8vICAqIE9ubHkgdGhlIGFkbWluIGNhbiBjYWxsIHRoaXMKICAgIC8vICAqIFJlcXVpcmVzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHRoZSByZXdhcmRzCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoKQogICAgLy8gcHVibGljIGFkZFJld2FyZHMoKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBhZGQgcmV3YXJkcwogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gYWRkIHJld2FyZHMnKQogICAgLy8gCiAgICAvLyAgIC8vIEVuc3VyZSB0aGlzIGNhbGwgaGFzIGEgY29tcGFuaW9uIEFTQSB0cmFuc2ZlciB0cmFuc2FjdGlvbiB3aXRoIHJld2FyZHMKICAgIC8vICAgYXNzZXJ0KEdsb2JhbC5ncm91cFNpemUgPT09IDIsICdFeHBlY3RlZCAyIHR4bnMgaW4gZ3JvdXAnKQogICAgLy8gCiAgICAvLyAgIC8vIEdldCB0aGUgQVNBIHRyYW5zZmVyIGRldGFpbHMKICAgIC8vICAgY29uc3QgYXNzZXQgPSB0aGlzLmFzc2V0LnZhbHVlCiAgICAvLyAgIGNvbnN0IHhmZXJUeG4gPSBndHhuLkFzc2V0VHJhbnNmZXJUeG4oMCkKICAgIC8vICAgYXNzZXJ0KHhmZXJUeG4udHlwZSA9PT0gVHJhbnNhY3Rpb25UeXBlLkFzc2V0VHJhbnNmZXIsICdUcmFuc2FjdGlvbiAwIG11c3QgYmUgYXNzZXQgdHJhbnNmZXInKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldFJlY2VpdmVyID09PSBHbG9iYWwuY3VycmVudEFwcGxpY2F0aW9uQWRkcmVzcywgJ0Fzc2V0IHRyYW5zZmVyIG11c3QgYmUgdG8gY29udHJhY3QnKQogICAgLy8gICBhc3NlcnQoeGZlclR4bi5hc3NldEFtb3VudCA+IDAsICdNdXN0IHByb3ZpZGUgbm9uLXplcm8gcmV3YXJkcycpCiAgICAvLyAgIGFzc2VydCh4ZmVyVHhuLnhmZXJBc3NldCA9PT0gYXNzZXQsICdJbmNvcnJlY3QgYXNzZXQgSUQnKQogICAgLy8gCiAgICAvLyAgIC8vIEFkZCByZXdhcmRzIHRvIHRoZSBwb29sCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSArIHhmZXJUeG4uYXNzZXRBbW91bnQKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgbGFzdCBkaXN0cmlidXRpb24gdGltZQogICAgLy8gICB0aGlzLmxhc3REaXN0cmlidXRpb25UaW1lLnZhbHVlID0gR2xvYmFsLmxhdGVzdFRpbWVzdGFtcAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIENhbGN1bGF0ZSByZXdhcmRzIGZvciBhIHNwZWNpZmljIHVzZXIgZm9yIGEgZ2l2ZW4gcGVyaW9kCiAgICAvLyAgKiBUaGlzIGNhbGN1bGF0ZXMgcmV3YXJkcyBwZXIgZGlzdHJpYnV0aW9uIHBlcmlvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBjYWxjdWxhdGVVc2VyUmV3YXJkc0ZvclBlcmlvZCh1c2VyQWRkcmVzczogQWNjb3VudCk6IHVpbnQ2NCB7CiAgICAvLyAgIGNvbnN0IGFwciA9IHRoaXMuYXByQmFzaXNQb2ludHMudmFsdWUKICAgIC8vICAgY29uc3QgdG90YWxTdGFrZWQgPSB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlCiAgICAvLyAgIGNvbnN0IHBlcmlvZFNlY29uZHMgPSB0aGlzLmRpc3RyaWJ1dGlvblBlcmlvZFNlY29uZHMudmFsdWUKICAgIC8vIAogICAgLy8gICAvLyBJZiBubyB0b3RhbCBzdGFrZSBvciBubyBwZXJpb2QgZGVmaW5lZCwgcmV0dXJuIDAKICAgIC8vICAgaWYgKHRvdGFsU3Rha2VkID09PSAwIHx8IHBlcmlvZFNlY29uZHMgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gR2V0IHRoZSB1c2VyJ3Mgc3Rha2UgaW5mbwogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gSWYgdXNlciBoYXMgbm8gc3Rha2UsIHJldHVybiAwCiAgICAvLyAgIGlmIChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBHZXQgdXNlcidzIHN0YWtlIGFtb3VudCBhbmQgbGFzdCBzdGFrZSB0aW1lCiAgICAvLyAgIGNvbnN0IHVzZXJTdGFrZSA9IHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlCiAgICAvLyAgIGNvbnN0IGxhc3RTdGFrZVRpbWUgPSBzdGFrZUluZm8ubGFzdFN0YWtlVGltZS5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDaGVjayBpZiB1c2VyIGhhcyBiZWVuIHN0YWtlZCBmb3IgdGhlIG1pbmltdW0gcGVyaW9kCiAgICAvLyAgIGNvbnN0IG1pbmltdW1TdGFrZVRpbWU6IHVpbnQ2NCA9IDg2NDAwIC8vIDI0IGhvdXJzIGluIHNlY29uZHMKICAgIC8vICAgaWYgKEdsb2JhbC5sYXRlc3RUaW1lc3RhbXAgPCBsYXN0U3Rha2VUaW1lICsgbWluaW11bVN0YWtlVGltZSkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcmV3YXJkIHJhdGUgZm9yIHRoZSBwZXJpb2QKICAgIC8vICAgLy8gQVBSIGlzIGluIGJhc2lzIHBvaW50cyAoZS5nLiwgNTAwID0gNSUpCiAgICAvLyAgIC8vIENvbnZlcnQgQVBSIHRvIHBlcmlvZCByYXRlOiAoQVBSIC8gMTAwMDApICogKHBlcmlvZFNlY29uZHMgLyAzMTUzNjAwMCkKICAgIC8vICAgLy8gd2hlcmUgMzE1MzYwMDAgaXMgc2Vjb25kcyBpbiBhIHllYXIKICAgIC8vICAgY29uc3QgeWVhckluU2Vjb25kczogdWludDY0ID0gMzE1MzYwMDAKICAgIC8vICAgY29uc3QgcGVyaW9kUmF0ZU51bWVyYXRvcjogdWludDY0ID0gYXByICogcGVyaW9kU2Vjb25kcwogICAgLy8gICBjb25zdCBwZXJpb2RSYXRlRGVub21pbmF0b3I6IHVpbnQ2NCA9IDEwMDAwICogeWVhckluU2Vjb25kcwogICAgLy8gCiAgICAvLyAgIC8vIENhbGN1bGF0ZSByZXdhcmQ6IHVzZXJTdGFrZSAqIHBlcmlvZFJhdGUKICAgIC8vICAgY29uc3QgcmV3YXJkOiB1aW50NjQgPSAodXNlclN0YWtlICogcGVyaW9kUmF0ZU51bWVyYXRvcikgLyBwZXJpb2RSYXRlRGVub21pbmF0b3IKICAgIC8vIAogICAgLy8gICByZXR1cm4gcmV3YXJkCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcyBmb3IgYSB1c2VyIHNpbmNlIHRoZWlyIGxhc3QgY2xhaW0KICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgaWYgKHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlID09PSAwKSB7CiAgICAvLyAgICAgcmV0dXJuIDAKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIGNvbnN0IGN1cnJlbnRQZXJpb2QgPSB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKQogICAgLy8gICBjb25zdCBsYXN0Q2xhaW1lZFBlcmlvZCA9IHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZC5uYXRpdmUKICAgIC8vIAogICAgLy8gICAvLyBDYWxjdWxhdGUgcGVyaW9kcyBzaW5jZSBsYXN0IGNsYWltCiAgICAvLyAgIGNvbnN0IHBlcmlvZHNTaW5jZUxhc3RDbGFpbTogdWludDY0ID0gY3VycmVudFBlcmlvZCA+IGxhc3RDbGFpbWVkUGVyaW9kID8gY3VycmVudFBlcmlvZCAtIGxhc3RDbGFpbWVkUGVyaW9kIDogMAogICAgLy8gCiAgICAvLyAgIGlmIChwZXJpb2RzU2luY2VMYXN0Q2xhaW0gPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHJld2FyZCBwZXIgcGVyaW9kCiAgICAvLyAgIGNvbnN0IHJld2FyZFBlclBlcmlvZCA9IHRoaXMuY2FsY3VsYXRlVXNlclJld2FyZHNGb3JQZXJpb2QodXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJld2FyZFBlclBlcmlvZCAqIHBlcmlvZHNTaW5jZUxhc3RDbGFpbQogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEhlbHBlciBmdW5jdGlvbiB0byBjb21wb3VuZCByZXdhcmRzIGZvciBhIHNpbmdsZSB1c2VyCiAgICAvLyAgKiBVc2VkIGJ5IHRoZSBhdXRvbWF0ZWQgZGlzdHJpYnV0aW9uIHN5c3RlbQogICAgLy8gICovCiAgICAvLyBwcml2YXRlIGNvbXBvdW5kUmV3YXJkc0ZvclVzZXIodXNlckFkZHJlc3M6IEFjY291bnQpOiB1aW50NjQgewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiB1c2VyIGhhcyBubyBzdGFrZQogICAgLy8gICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPT09IDApIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQ2FsY3VsYXRlIHBlbmRpbmcgcmV3YXJkcwogICAgLy8gICBjb25zdCBwZW5kaW5nUmV3YXJkcyA9IHRoaXMuY2FsY3VsYXRlUGVuZGluZ1Jld2FyZHModXNlckFkZHJlc3MpCiAgICAvLyAKICAgIC8vICAgLy8gU2tpcCBpZiBubyByZXdhcmRzIHRvIGNvbXBvdW5kCiAgICAvLyAgIGlmIChwZW5kaW5nUmV3YXJkcyA9PT0gMCkgewogICAgLy8gICAgIHJldHVybiAwCiAgICAvLyAgIH0KICAgIC8vIAogICAgLy8gICAvLyBTa2lwIGlmIHJld2FyZCBwb29sIGhhcyBpbnN1ZmZpY2llbnQgZnVuZHMgZm9yIHRoaXMgdXNlcgogICAgLy8gICBpZiAodGhpcy5yZXdhcmRQb29sLnZhbHVlIDwgcGVuZGluZ1Jld2FyZHMpIHsKICAgIC8vICAgICByZXR1cm4gMAogICAgLy8gICB9CiAgICAvLyAKICAgIC8vICAgLy8gQXV0by1jb21wb3VuZDogQWRkIHJld2FyZHMgdG8gc3Rha2VkIGFtb3VudAogICAgLy8gICBzdGFrZUluZm8uc3Rha2VkQW1vdW50ID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSB0b3RhbCByZXdhcmRzIGVhcm5lZAogICAgLy8gICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkID0gbmV3IGFyYzQuVWludE42NChzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSArIHBlbmRpbmdSZXdhcmRzKQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGNsYWltZWQgcGVyaW9kIHRvIGN1cnJlbnQgcGVyaW9kCiAgICAvLyAgIHN0YWtlSW5mby5sYXN0Q2xhaW1lZFBlcmlvZCA9IG5ldyBhcmM0LlVpbnRONjQodGhpcy5nZXRDdXJyZW50UGVyaW9kKCkpCiAgICAvLyAKICAgIC8vICAgLy8gU3RvcmUgdXBkYXRlZCBzdGFrZSBpbmZvCiAgICAvLyAgIHRoaXMuc3RvcmVVc2VyU3Rha2VJbmZvKHVzZXJBZGRyZXNzLCBzdGFrZUluZm8pCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIGdsb2JhbCBzdGF0ZQogICAgLy8gICB0aGlzLnRvdGFsU3Rha2VkLnZhbHVlID0gdGhpcy50b3RhbFN0YWtlZC52YWx1ZSArIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIHBlbmRpbmdSZXdhcmRzCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHBlbmRpbmdSZXdhcmRzCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogRGlzdHJpYnV0ZSBhbmQgY29tcG91bmQgcmV3YXJkcyBmb3IgbXVsdGlwbGUgc3Rha2VycwogICAgLy8gICogVGhpcyBtZXRob2QgaXMgZGVzaWduZWQgdG8gYmUgY2FsbGVkIGJ5IGEgY3JvbiBqb2Igb24gYSBkYWlseSBiYXNpcwogICAgLy8gICogT25seSBhZG1pbiBjYW4gY2FsbCB0aGlzIG1ldGhvZAogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkaXN0cmlidXRlUmV3YXJkcyhzdGFrZXJBZGRyZXNzZXM6IGFyYzQuQWRkcmVzc1tdKTogdm9pZCB7CiAgICAvLyAgIC8vIEVuc3VyZSBvbmx5IGFkbWluIGNhbiBkaXN0cmlidXRlIHJld2FyZHMKICAgIC8vICAgY29uc3QgYWRtaW5BZGRyID0gdGhpcy5hZG1pbkFkZHJlc3MudmFsdWUKICAgIC8vICAgYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGRpc3RyaWJ1dGUgcmV3YXJkcycpCiAgICAvLyAKICAgIC8vICAgLy8gRW5zdXJlIHdlIGRvbid0IHByb2Nlc3MgdG9vIG1hbnkgc3Rha2VycyBpbiBvbmUgY2FsbCAoZ2FzIGxpbWl0IHByb3RlY3Rpb24pCiAgICAvLyAgIGFzc2VydChzdGFrZXJBZGRyZXNzZXMubGVuZ3RoIDw9IDUwLCAnVG9vIG1hbnkgc3Rha2VycyBpbiBzaW5nbGUgYmF0Y2gnKQogICAgLy8gCiAgICAvLyAgIGxldCB0b3RhbERpc3RyaWJ1dGVkOiB1aW50NjQgPSAwCiAgICAvLyAKICAgIC8vICAgLy8gUHJvY2VzcyBlYWNoIHN0YWtlcgogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCByZXdhcmRzQ29tcG91bmRlZCA9IHRoaXMuY29tcG91bmRSZXdhcmRzRm9yVXNlcihzdGFrZXIubmF0aXZlKQogICAgLy8gICAgIHRvdGFsRGlzdHJpYnV0ZWQgPSB0b3RhbERpc3RyaWJ1dGVkICsgcmV3YXJkc0NvbXBvdW5kZWQKICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIC8vIFVwZGF0ZSBsYXN0IGRpc3RyaWJ1dGlvbiB0aW1lCiAgICAvLyAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUgPSBHbG9iYWwubGF0ZXN0VGltZXN0YW1wCiAgICAvLyB9CiAgICAvLyAKICAgIC8vIC8qKgogICAgLy8gICogR2V0IGFsbCBub24temVybyBzdGFrZXJzIGNvdW50IChmb3IgbW9uaXRvcmluZyBwdXJwb3NlcykKICAgIC8vICAqIE5vdGU6IFRoaXMgZG9lc24ndCByZXR1cm4gdGhlIGFjdHVhbCBhZGRyZXNzZXMgZHVlIHRvIGJveCBpdGVyYXRpb24gbGltaXRhdGlvbnMKICAgIC8vICAqLwogICAgLy8gQGFiaW1ldGhvZCh7IHJlYWRvbmx5OiB0cnVlIH0pCiAgICAvLyBwdWJsaWMgZ2V0QWN0aXZlU3Rha2Vyc0NvdW50KHN0YWtlckFkZHJlc3NlczogYXJjNC5BZGRyZXNzW10pOiB1aW50NjQgewogICAgLy8gICBsZXQgYWN0aXZlQ291bnQ6IHVpbnQ2NCA9IDAKICAgIC8vIAogICAgLy8gICBmb3IgKGNvbnN0IHN0YWtlciBvZiBzdGFrZXJBZGRyZXNzZXMpIHsKICAgIC8vICAgICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8oc3Rha2VyLm5hdGl2ZSkKICAgIC8vICAgICBpZiAoc3Rha2VJbmZvLnN0YWtlZEFtb3VudC5uYXRpdmUgPiAwKSB7CiAgICAvLyAgICAgICBhY3RpdmVDb3VudCA9IGFjdGl2ZUNvdW50ICsgMQogICAgLy8gICAgIH0KICAgIC8vICAgfQogICAgLy8gCiAgICAvLyAgIHJldHVybiBhY3RpdmVDb3VudAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIFVwZGF0ZSB0aGUgQVBSIGJhc2lzIHBvaW50cwogICAgLy8gICogT25seSB0aGUgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBUFIobmV3QXByQmFzaXNQb2ludHM6IHVpbnQ2NCk6IHZvaWQgewogICAgLy8gICAvLyBFbnN1cmUgb25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIEFQUicpCiAgICAvLyAKICAgIC8vICAgLy8gVXBkYXRlIEFQUgogICAgLy8gICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlID0gbmV3QXByQmFzaXNQb2ludHMKICAgIC8vIH0KICAgIC8vIAogICAgLy8gLyoqCiAgICAvLyAgKiBVcGRhdGUgdGhlIGFkbWluIGFkZHJlc3MKICAgIC8vICAqIE9ubHkgdGhlIGN1cnJlbnQgYWRtaW4gY2FuIGNhbGwgdGhpcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyB1cGRhdGVBZG1pbihuZXdBZG1pbkFkZHJlc3M6IEFjY291bnQpOiB2b2lkIHsKICAgIC8vICAgLy8gRW5zdXJlIG9ubHkgYWRtaW4gY2FuIHVwZGF0ZSBhZG1pbgogICAgLy8gICBjb25zdCBhZG1pbkFkZHIgPSB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZQogICAgLy8gICBhc3NlcnQoVHhuLnNlbmRlciA9PT0gYWRtaW5BZGRyLCAnT25seSBhZG1pbiBjYW4gdXBkYXRlIGFkbWluJykKICAgIC8vIAogICAgLy8gICAvLyBVcGRhdGUgYWRtaW4gYWRkcmVzcwogICAgLy8gICB0aGlzLmFkbWluQWRkcmVzcy52YWx1ZSA9IG5ld0FkbWluQWRkcmVzcwogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjdXJyZW50IHN0YWtpbmcgc3RhdGlzdGljcyBmb3IgYSB1c2VyCiAgICAvLyAgKi8KICAgIC8vIEBhYmltZXRob2QoeyByZWFkb25seTogdHJ1ZSB9KQogICAgLy8gcHVibGljIGdldFVzZXJTdGF0cyh1c2VyQWRkcmVzczogQWNjb3VudCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICAvLyAgIGNvbnN0IHBlbmRpbmdSZXdhcmRzID0gdGhpcy5jYWxjdWxhdGVQZW5kaW5nUmV3YXJkcyh1c2VyQWRkcmVzcykKICAgIC8vIAogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHN0YWtlSW5mby5zdGFrZWRBbW91bnQubmF0aXZlLAogICAgLy8gICAgIHN0YWtlSW5mby5sYXN0U3Rha2VUaW1lLm5hdGl2ZSwKICAgIC8vICAgICBzdGFrZUluZm8udG90YWxSZXdhcmRzRWFybmVkLm5hdGl2ZSwKICAgIC8vICAgICBwZW5kaW5nUmV3YXJkcywKICAgIC8vICAgICBzdGFrZUluZm8ubGFzdENsYWltZWRQZXJpb2QubmF0aXZlLAogICAgLy8gICBdCiAgICAvLyAKICAgIC8vICAgcmV0dXJuIHJlc3VsdAogICAgLy8gfQogICAgLy8gCiAgICAvLyAvKioKICAgIC8vICAqIEdldCBjb250cmFjdCBnbG9iYWwgc3RhdGlzdGljcwogICAgLy8gICovCiAgICAvLyBAYWJpbWV0aG9kKHsgcmVhZG9ubHk6IHRydWUgfSkKICAgIC8vIHB1YmxpYyBnZXRDb250cmFjdFN0YXRzKCk6IEFycmF5PHVpbnQ2ND4gewogICAgLy8gICBjb25zdCByZXN1bHQ6IHVpbnQ2NFtdID0gWwogICAgLy8gICAgIHRoaXMuYXNzZXQudmFsdWUuaWQsCiAgICAvLyAgICAgdGhpcy50b3RhbFN0YWtlZC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmFwckJhc2lzUG9pbnRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubGFzdERpc3RyaWJ1dGlvblRpbWUudmFsdWUsCiAgICAvLyAgICAgdGhpcy5kaXN0cmlidXRpb25QZXJpb2RTZWNvbmRzLnZhbHVlLAogICAgLy8gICAgIHRoaXMubWluaW11bVN0YWtlLnZhbHVlLAogICAgLy8gICAgIHRoaXMucmV3YXJkUG9vbC52YWx1ZSwKICAgIC8vICAgICB0aGlzLmdldEN1cnJlbnRQZXJpb2QoKSwKICAgIGNvbmNhdAogICAgZHVwCiAgICBsZW4KICAgIGludGNfMyAvLyA4CiAgICAvCiAgICBpdG9iCiAgICBleHRyYWN0IDYgMgogICAgc3dhcAogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ4MwogICAgLy8gcmV0dXJuIHJlc3VsdAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmVtZXJnZW5jeVdpdGhkcmF3UmV3YXJkcyhhbW91bnQ6IHVpbnQ2NCkgLT4gdm9pZDoKZW1lcmdlbmN5V2l0aGRyYXdSZXdhcmRzOgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0ODktNDkwCiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBlbWVyZ2VuY3lXaXRoZHJhd1Jld2FyZHMoYW1vdW50OiB1aW50NjQpOiB2b2lkIHsKICAgIHByb3RvIDEgMAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OQogICAgLy8gcHVibGljIGFkbWluQWRkcmVzcyA9IEdsb2JhbFN0YXRlPEFjY291bnQ+KHsgaW5pdGlhbFZhbHVlOiBBY2NvdW50KCl9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ5MwogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYWRtaW4gY2FuIGVtZXJnZW5jeSB3aXRoZHJhdycpCiAgICB0eG4gU2VuZGVyCiAgICBkaWcgMQogICAgPT0KICAgIGFzc2VydCAvLyBPbmx5IGFkbWluIGNhbiBlbWVyZ2VuY3kgd2l0aGRyYXcKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OTYKICAgIC8vIGFzc2VydCh0aGlzLnJld2FyZFBvb2wudmFsdWUgPj0gYW1vdW50LCAnSW5zdWZmaWNpZW50IHJld2FyZCBwb29sJykKICAgIGZyYW1lX2RpZyAtMQogICAgPj0KICAgIGFzc2VydCAvLyBJbnN1ZmZpY2llbnQgcmV3YXJkIHBvb2wKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTUKICAgIC8vIHB1YmxpYyByZXdhcmRQb29sID0gR2xvYmFsU3RhdGU8dWludDY0Pih7IGluaXRpYWxWYWx1ZTogMCB9KQogICAgaW50Y18wIC8vIDAKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OTkKICAgIC8vIHRoaXMucmV3YXJkUG9vbC52YWx1ZSA9IHRoaXMucmV3YXJkUG9vbC52YWx1ZSAtIGFtb3VudAogICAgZnJhbWVfZGlnIC0xCiAgICAtCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjU1CiAgICAvLyBwdWJsaWMgcmV3YXJkUG9vbCA9IEdsb2JhbFN0YXRlPHVpbnQ2ND4oeyBpbml0aWFsVmFsdWU6IDAgfSkKICAgIGJ5dGVjXzAgLy8gInJld2FyZFBvb2wiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ5OQogICAgLy8gdGhpcy5yZXdhcmRQb29sLnZhbHVlID0gdGhpcy5yZXdhcmRQb29sLnZhbHVlIC0gYW1vdW50CiAgICBzd2FwCiAgICBhcHBfZ2xvYmFsX3B1dAogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo0OAogICAgLy8gcHVibGljIGFzc2V0ID0gR2xvYmFsU3RhdGU8QXNzZXQ+KHsgaW5pdGlhbFZhbHVlOiBBc3NldCgpIH0pCiAgICBpbnRjXzAgLy8gMAogICAgYnl0ZWNfMSAvLyAiYXNzZXQiCiAgICBhcHBfZ2xvYmFsX2dldF9leAogICAgYXNzZXJ0IC8vIGNoZWNrIEdsb2JhbFN0YXRlIGV4aXN0cwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MDMtNTEwCiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBhZG1pbkFkZHIsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIGZlZTogMTAwMCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX2JlZ2luCiAgICBpdHhuX2ZpZWxkIFhmZXJBc3NldAogICAgZnJhbWVfZGlnIC0xCiAgICBpdHhuX2ZpZWxkIEFzc2V0QW1vdW50CiAgICBpdHhuX2ZpZWxkIEFzc2V0UmVjZWl2ZXIKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTAzLTUwOQogICAgLy8gaXR4bgogICAgLy8gICAuYXNzZXRUcmFuc2Zlcih7CiAgICAvLyAgICAgYXNzZXRSZWNlaXZlcjogYWRtaW5BZGRyLAogICAgLy8gICAgIGFzc2V0QW1vdW50OiBhbW91bnQsCiAgICAvLyAgICAgeGZlckFzc2V0OiBhc3NldCwKICAgIC8vICAgICBmZWU6IDEwMDAsCiAgICAvLyAgIH0pCiAgICBpbnRjXzIgLy8gNAogICAgaXR4bl9maWVsZCBUeXBlRW51bQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MDgKICAgIC8vIGZlZTogMTAwMCwKICAgIHB1c2hpbnQgMTAwMCAvLyAxMDAwCiAgICBpdHhuX2ZpZWxkIEZlZQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MDMtNTEwCiAgICAvLyBpdHhuCiAgICAvLyAgIC5hc3NldFRyYW5zZmVyKHsKICAgIC8vICAgICBhc3NldFJlY2VpdmVyOiBhZG1pbkFkZHIsCiAgICAvLyAgICAgYXNzZXRBbW91bnQ6IGFtb3VudCwKICAgIC8vICAgICB4ZmVyQXNzZXQ6IGFzc2V0LAogICAgLy8gICAgIGZlZTogMTAwMCwKICAgIC8vICAgfSkKICAgIC8vICAgLnN1Ym1pdCgpCiAgICBpdHhuX3N1Ym1pdAogICAgcmV0c3ViCgoKLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo6QVNBU3Rha2luZ0NvbnRyYWN0LmRlbGV0ZVVzZXJCb3godXNlckFkZHJlc3M6IGJ5dGVzKSAtPiB2b2lkOgpkZWxldGVVc2VyQm94OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MTctNTE4CiAgICAvLyBAYWJpbWV0aG9kKCkKICAgIC8vIHB1YmxpYyBkZWxldGVVc2VyQm94KHVzZXJBZGRyZXNzOiBBY2NvdW50KTogdm9pZCB7CiAgICBwcm90byAxIDAKICAgIGludGNfMCAvLyAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjQ5CiAgICAvLyBwdWJsaWMgYWRtaW5BZGRyZXNzID0gR2xvYmFsU3RhdGU8QWNjb3VudD4oeyBpbml0aWFsVmFsdWU6IEFjY291bnQoKX0pCiAgICBkdXAKICAgIGJ5dGVjXzIgLy8gImFkbWluQWRkcmVzcyIKICAgIGFwcF9nbG9iYWxfZ2V0X2V4CiAgICBhc3NlcnQgLy8gY2hlY2sgR2xvYmFsU3RhdGUgZXhpc3RzCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUyMwogICAgLy8gYXNzZXJ0KFR4bi5zZW5kZXIgPT09IGJveE93bmVyIHx8IFR4bi5zZW5kZXIgPT09IGFkbWluQWRkciwgJ09ubHkgYm94IG93bmVyIG9yIGFkbWluIGNhbiBkZWxldGUgYm94JykKICAgIHR4biBTZW5kZXIKICAgIGZyYW1lX2RpZyAtMQogICAgPT0KICAgIGJueiBkZWxldGVVc2VyQm94X2Jvb2xfdHJ1ZUAyCiAgICB0eG4gU2VuZGVyCiAgICBmcmFtZV9kaWcgMQogICAgPT0KICAgIGJ6IGRlbGV0ZVVzZXJCb3hfYm9vbF9mYWxzZUAzCgpkZWxldGVVc2VyQm94X2Jvb2xfdHJ1ZUAyOgogICAgaW50Y18xIC8vIDEKCmRlbGV0ZVVzZXJCb3hfYm9vbF9tZXJnZUA0OgogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MjMKICAgIC8vIGFzc2VydChUeG4uc2VuZGVyID09PSBib3hPd25lciB8fCBUeG4uc2VuZGVyID09PSBhZG1pbkFkZHIsICdPbmx5IGJveCBvd25lciBvciBhZG1pbiBjYW4gZGVsZXRlIGJveCcpCiAgICBhc3NlcnQgLy8gT25seSBib3ggb3duZXIgb3IgYWRtaW4gY2FuIGRlbGV0ZSBib3gKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTI2CiAgICAvLyBjb25zdCBzdGFrZUluZm8gPSB0aGlzLmdldFVzZXJTdGFrZUluZm8odXNlckFkZHJlc3MpCiAgICBmcmFtZV9kaWcgLTEKICAgIGNhbGxzdWIgZ2V0VXNlclN0YWtlSW5mbwogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1MjcKICAgIC8vIGFzc2VydChzdGFrZUluZm8uc3Rha2VkQW1vdW50Lm5hdGl2ZSA9PT0gMCwgJ1VzZXIgc3RpbGwgaGFzIGFjdGl2ZSBzdGFrZScpCiAgICBpbnRjXzAgLy8gMAogICAgZXh0cmFjdF91aW50NjQKICAgICEKICAgIGFzc2VydCAvLyBVc2VyIHN0aWxsIGhhcyBhY3RpdmUgc3Rha2UKICAgIC8vIHNtYXJ0X2NvbnRyYWN0cy9zdGFraW5nL2NvbnRyYWN0LmFsZ28udHM6NTcKICAgIC8vIHB1YmxpYyBzdGFrZXJzID0gQm94TWFwPEFjY291bnQsIFVzZXJTdGFrZUluZm8+KHsga2V5UHJlZml4OiAnc3Rha2VycycgfSkKICAgIGJ5dGVjIDkgLy8gInN0YWtlcnMiCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzMAogICAgLy8gY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIGZyYW1lX2RpZyAtMQogICAgLy8gc21hcnRfY29udHJhY3RzL3N0YWtpbmcvY29udHJhY3QuYWxnby50czo1NwogICAgLy8gcHVibGljIHN0YWtlcnMgPSBCb3hNYXA8QWNjb3VudCwgVXNlclN0YWtlSW5mbz4oeyBrZXlQcmVmaXg6ICdzdGFrZXJzJyB9KQogICAgY29uY2F0CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzMAogICAgLy8gY29uc3QgdXNlckJveCA9IHRoaXMuc3Rha2Vycyh1c2VyQWRkcmVzcykKICAgIGR1cAogICAgZnJhbWVfYnVyeSAwCiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzMQogICAgLy8gaWYgKHVzZXJCb3guZXhpc3RzKSB7CiAgICBib3hfbGVuCiAgICBidXJ5IDEKICAgIGJ6IGRlbGV0ZVVzZXJCb3hfYWZ0ZXJfaWZfZWxzZUA2CiAgICAvLyBzbWFydF9jb250cmFjdHMvc3Rha2luZy9jb250cmFjdC5hbGdvLnRzOjUzMgogICAgLy8gdXNlckJveC5kZWxldGUoKQogICAgZnJhbWVfZGlnIDAKICAgIGJveF9kZWwKICAgIHBvcAoKZGVsZXRlVXNlckJveF9hZnRlcl9pZl9lbHNlQDY6CiAgICByZXRzdWIKCmRlbGV0ZVVzZXJCb3hfYm9vbF9mYWxzZUAzOgogICAgaW50Y18wIC8vIDAKICAgIGIgZGVsZXRlVXNlckJveF9ib29sX21lcmdlQDQK",
        "clear": "I3ByYWdtYSB2ZXJzaW9uIDEwCiNwcmFnbWEgdHlwZXRyYWNrIGZhbHNlCgovLyBAYWxnb3JhbmRmb3VuZGF0aW9uL2FsZ29yYW5kLXR5cGVzY3JpcHQvYmFzZS1jb250cmFjdC5kLnRzOjpCYXNlQ29udHJhY3QuY2xlYXJTdGF0ZVByb2dyYW0oKSAtPiB1aW50NjQ6Cm1haW46CiAgICBwdXNoaW50IDEgLy8gMQogICAgcmV0dXJuCg=="
    },
    "byteCode": {
        "approval": "CiAEAAEECCYKCnJld2FyZFBvb2wFYXNzZXQMYWRtaW5BZGRyZXNzC3RvdGFsU3Rha2VkBBUffHUOYXByQmFzaXNQb2ludHMUbGFzdERpc3RyaWJ1dGlvblRpbWUZZGlzdHJpYnV0aW9uUGVyaW9kU2Vjb25kcwxtaW5pbXVtU3Rha2UHc3Rha2VyczEYQAAdKSJnKjIDZysiZycFImcnBiJnJwciZycIImcoImcxG0EB3oISBDbdBbQEoBpd3AQOk/3mBGZ8XTAEn/0+UwQIkL1YBCHx3f8Es7cBRgQL2M9gBGkErFoEK4f1fAT4PutdBB5mEr0EgqsexAQVdmsJBL/jFWQEzpY7HQTcmioFNhoAjhIBQgEsARoA9gDqAN4AzgDCAKoAkgCDAG4AXgBMADUAJAAUAAIiQzEZFEQxGEQ2GgEXwByIBaMjQzEZFEQxGEQ2GgEXiAVdI0MxGRREMRhEiAUFJwRMULAjQzEZFEQxGEQ2GgEXwByIBLInBExQsCNDMRkURDEYRDYaARfAHIgEiyNDMRkURDEYRDYaAReIBGojQzEZFEQxGEQ2GgGIBBcWJwRMULAjQzEZFEQxGEQ2GgGIA1MjQzEZFEQxGEQ2GgEXwByIAvgWJwRMULAjQzEZFEQxGEQ2GgEXwByIAoIWJwRMULAjQzEZFEQxGESIAjMjQzEZFEQxGEQ2GgEXiAHDI0MxGRREMRhEiAFCI0MxGRREMRhEiAECI0MxGRREMRhENhoBF8AwNhoCF8AcNhoDFzYaBBc2GgUXiACsI0MxGRREMRhEiACHFicETFCwI0MxGRREMRhENhoBF8AcNhoCiABeSCNDMRkURDEYRDYaARfAHIgAEicETFCwI0MxGUD+ojEYFEQjQ4oBAScJi/9QSb1FAUEABosAvkRMiYAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABMiYoCAScJi/5Qi/+/i/+JigABIicHZUxJTwJEQAADIkyJMgeLAApMiYoFACIpZUQURDEAMgkSRCmL+2cqi/xnKyJnJwWL/WcnBjIHZycHi/5nJwiL/2coImeJigAAIiplRDEAMgkSQAAIMQCLABJBABkjRCIpZUSxMgpMshEishKyFCSyECKyAbOJIkL/5IoAACIpZUQiKWVERDIEgQISRCI4EEkkEkQkEkQiOBQyChJEIjgSSU4CRCI4ERJEIicIZUQxAEmI/wBHAiJbQAARiwCLAQ9EiP83FosDTFwYjASLBEkiW4sASU4DCBZcADIHFlwIiwJMiP8ISCIrZUQIK0xniYoBADEASYj+vEkiW0cCRIv/SwEORIv/RIv/DUEADIsCi/8JIicIZUQPRIsCi/8JFosBTFwAiwBMiP7DSCIrZUSL/wkrTGciKWVEsTEATLIRi/+yErIUJLIQgegHsgGziSIqZUQxABJEMgSBAhJEIillRCI4EEkkEkQkEkQiOBQyChJEIjgSSUQiOBFPAhJEIihlRAgoTGcnBjIHZ4mKAQEigAAiJwVlRCIrZUQiJwdlTE4CREEABYsDQAAEIowAiYv/iP4ASYwAIltJjAFAAAQijACJiwAlWzIHTIGAowUIDEEABCKMAImLAosDC4sBC4GA8K7nlgkKjACJigEBgABHAov/iP2+SSJbQAAEIowAiYj9+EmMAIsDgRhbSYwBDUEAG4sAiwEJjAKLAkAABCKMAImL/4j/ZYsCC4wAiSKMAkL/5ooBACJJgABJIiplRDEAEkSL/yJZSYEyDkQiSYsGiwQMQQCGi/9XAgCLBoEgC4EgWEmMAYj9S0mMACJbSYwDQAAPIosFCIwFiwYjCIwGQv/LiwGI/2JJjAJAAAQiQv/jIihlRIsCDEEABCJC/9WLA4sCSU4CCBaLAExcAEmBEFtLAggWXBCI/UAWXBiLAUyI/SlIIitlREsBCCtMZyIoZURLAQkoTGdC/5knBjIHZ4mKAQGAACKL/yJZIosDiwIMQQAsi/9XAgCLA4EgC4EgWIj8ryJbiwGMAEEABosBIwiMAIsAjAGLAyMIjANC/8yLAYwAiYoBACIqZUQxABJEJwWL/2eJigEAIiplRDEAEkQqi/9niYoBAYv/iPxli/+I/pZLASJbSwIlW0sDgRBbTwSBGFtPAxZPAxZQTwIWUE8CFlBMFlBJFSUKFlcGAkxQiSIpZUQiK2VEIicFZUQiJwZlRCInB2VEIicIZUQiKGVEiPxVTwcWTwcWUE8GFlBPBRZQTwQWUE8DFlBPAhZQTBZQSRUlChZXBgJMUImKAQAiKmVEMQBLARJEIihlRIv/D0QiKGVEi/8JKExnIillRLGyEYv/shKyFCSyEIHoB7IBs4mKAQAiSSplRDEAi/8SQAAIMQCLARJBAB4jRIv/iPuQIlsURCcJi/9QSYwAvUUBQQAEiwC8SIkiQv/f",
        "clear": "CoEBQw=="
    },
    "compilerInfo": {
        "compiler": "puya",
        "compilerVersion": {
            "major": 4,
            "minor": 7,
            "patch": 0
        }
    },
    "events": [],
    "templateVariables": {}
}